{
  "id": 3973,
  "slug": "3973",
  "title": "Create secure interactive applications with WhatsApp flows end-to-end encryption",
  "description": "# WhatsApp Flows Encrypted Data Exchange Workflow\n\n## Summary\nThis workflow enables secure end-to-end encrypted data exchange with WhatsApp Flows for interactive applications inside Whatsapp.  It implements the WhatsApp Business Encryption protocol using RSA for key exchange and AES-GCM for payload encryption, providing a secure channel for sensitive data transmission while interfacing with WhatsApp's Business API. This follows the official WhatsApp Business Encryption specifications to establish an encrypted GraphQL-powered data exchange channel between your business and the WhatsApp consumer client.\n\n## How It Works\n\n### Encryption Flow\n1. **Webhook Reception**: Receives encrypted data from WhatsApp containing:\n   - `encrypted_flow_data`: The AES-encrypted payload\n   - `encrypted_aes_key`: The RSA-encrypted AES key\n   - `initial_vector`: Initialization vector for AES decryption\n\n2. **Decryption Process**:\n   - The workflow decrypts the AES key using an RSA private key\n   - Then uses this AES key to decrypt the payload data\n   - The inverted IV is used for response encryption\n\n3. **Data Processing**:\n   - The workflow parses the decrypted JSON data\n   - Routes requests based on the `screen` parameter.\n \n\n4. **Response Generation**:\n   - Generates appropriate response data based on the request type\n   - Encrypts the response using the same AES key and inverted IV\n   - Returns the base64-encoded encrypted response\n\n### Key Components\n- **Webhook Endpoint**: Entry point for encrypted WhatsApp requests\n- **Decryption Pipeline**: RSA and AES decryption components\n- **Business Logic Router**: Screen-based routing for different functionality\n- **Encryption Pipeline**: Secure response encryption\n\n## How to Use\n\n1. **Deploy the Workflow**:\n   - Import the workflow JSON into your n8n instance\n\n2. **Set Up WhatsApp Integration**:\n   - Configure your WhatsApp Business API to send requests to your n8n webhook URL\n   - Ensure your WhatsApp integration is set up to encrypt data using the public key pair of the private key used in this workflow\n\n3. **Test the Flow**:\n   - Send an encrypted test message from WhatsApp to verify connectivity\n   - Check if appointment data is being retrieved correctly\n   - Validate that seat selection is functioning as expected\n\n4. **Production Use**:\n   - Monitor the workflow performance in production\n   - Set up error notification if needed\n\n## Requirements\n\nAuthentication Keys\n\nRSA Private Key: Required for decrypting the AES key (included in the workflow)\nWhatsApp Business Public Key: Must be registered with the WhatsApp Business API\nPostgreSQL Credentials: For accessing appointment data from the database\n\nWhatsApp Business Encryption Setup\nAs specified in the WhatsApp Business Encryption documentation:\n\nGenerate a 2048-bit RSA Key Pair:\n\nThe private key remains with your business (used in this workflow)\nThe public key is shared with WhatsApp\n\n\nRegister the Public Key with WhatsApp:\n\nUse the WhatsApp Cloud API to register your public key\nSet up the public key using the /v17.0/{WhatsApp-Business-Account-ID}/whatsapp_business_encryption endpoint\n\n\nKey Registration API Call:\nPOST /v17.0/{WhatsApp-Business-Account-ID}/whatsapp_business_encryption\n{\n  \"business_public_key\": \"YOUR_PUBLIC_KEY\"\n}\n\nVerification:\n\nVerify your public key is registered using a GET request to the same endpoint\nEnsure the key status is \"active\"\n\n",
  "featuredImage": "/data/workflows/3973/3973.webp",
  "author": {
    "id": 101,
    "slug": "flavioangeleu",
    "name": "Flavio Angeleu",
    "avatar": ""
  },
  "categories": [
    "Support Chatbot"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 972,
  "downloads": 97,
  "createdAt": "2025-05-10T16:32:23.891Z",
  "updatedAt": "2026-01-16T08:32:26.525Z",
  "publishedAt": "2025-05-10T16:32:23.891Z",
  "nodes": 12,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/3973"
}