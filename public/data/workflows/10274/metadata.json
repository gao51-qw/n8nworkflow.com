{
  "id": 10274,
  "slug": "10274",
  "title": "Process sales CSVs into invoices with data tables and email notifications",
  "description": "# üßæ Smart Sales Invoice Processor (Data tables Edition)\n\nTransform uploaded **sales CSV files** into validated, enriched invoices, all handled natively inside **n8n** using **Data tables**, validation logic, enrichment, duplicate detection, and automated email notifications.\n\nThis workflow demonstrates a full **ETL + business automation** pattern, turning raw CSV data into structured, auditable records ready for storage and customer notifications.\n\n---\n\n## ‚ú® Features\n- ‚úÖ Multi-format CSV input (file upload or raw text)  \n- ‚úÖ Validation for email, quantity, date, and required fields  \n- ‚úÖ Automatic error handling with **400 Bad Request** JSON response for invalid CSVs  \n- ‚úÖ Product enrichment from `Products` Datatable  \n- ‚úÖ Invoice creation and storage in `Invoices` Datatable  \n- ‚úÖ Automated subtotal, tax, and total calculation  \n- ‚úÖ Duplicate order detection with **409 Conflict** response  \n- ‚úÖ Ready-to-send email confirmations (simulated in this version)  \n- ‚úÖ Fully native, no external integrations required  \n\n---\n\n## üß© Use Cases\n- E-commerce order and invoice automation  \n- Internal accounting or ERP data ingestion  \n- Migrating CSV-based legacy systems into n8n  \n- Automated business logic for B2B integrations  \n\n---\n\n## ‚öôÔ∏è Setup Instructions\n\n### 1Ô∏è‚É£ Create two n8n Data tables\n\n#### Products\nStores your product catalog with SKU-based pricing and tax details.\n\n| Column   | Type   | Example        |\n| -------- | ------ | -------------- |\n| sku      | String | PROD-001       |\n| name     | String | Premium Widget |\n| price    | Number | 49.99          |\n| tax_rate | Number | 0.10           |\n\n![image.png](fileId:3163)\n\n---\n\n#### Invoices\nStores validated, calculated invoices created by this workflow.\n\n| Column         | Type     | Example                                     |\n| -------------- | -------- | ------------------------------------------- |\n| invoice_id     | String   | INV-20251103-001                            |\n| customer_email | String   | [john@example.com](mailto:john@example.com) |\n| order_date     | Date     | 2025-01-15                                  |\n| subtotal       | Number   | 99.98                                       |\n| total_tax      | Number   | 10.00                                       |\n| grand_total    | Number   | 109.98                                      |\n| created_at     | DateTime | 2025-11-03T08:00:00Z                        |\n\n![image.png](fileId:3162)\n\n---\n\n### 2Ô∏è‚É£ Import Workflow\nImport the provided workflow JSON file into your n8n instance.\n\n### 3Ô∏è‚É£ Test the Workflow\nUse cURL or Postman to send a test CSV to your endpoint.\n\n```bash\ncurl -X POST \\\n  -H \"Content-Type: text/csv\" \\\n  --data-binary $'sku,quantity,customer_email,order_date\\nPROD-001,2,john@example.com,2025-01-15\\nPROD-002,1,jane@example.com,2025-01-15' \\\n  https://&lt;your-n8n-url&gt;/webhook/process-sales\n```\n\n#### üì¶ Example Responses\n##### ‚úÖ Success (HTTP 200)\n\n```json\n{\n  \"success\": true,\n  \"processed_at\": \"2025-11-04T15:36:52.899Z\",\n  \"invoice_count\": 1,\n  \"invoices\": {\n    \"to\": \"john@example.com\",\n    \"subject\": \"Invoice INV-1762270612772-1 - Order Confirmation\",\n    \"body\": \"Dear Customer,\\n\\nThank you for your order!\\n\\nInvoice ID: INV-1762270612772-1\\nOrder Date: 1/14/2025\\n\\nSubtotal: $99.98\\nTax: $10.00\\nGrand Total: $109.98\\n\\nThank you for your business!\\n\\nBest regards,\\nSales Team\"\n  },\n  \"email_notifications\": [\n    {\n      \"to\": \"jane@example.com\",\n      \"subject\": \"Invoice INV-1762270612772-2 - Order Confirmation\",\n      \"body\": \"Dear Customer,\\n\\nThank you for your order!\\n\\nInvoice ID: INV-1762270612772-2\\nOrder Date: 1/14/2025\\n\\nSubtotal: $89.99\\nTax: $9.00\\nGrand Total: $98.99\\n\\nThank you for your business!\\n\\nBest regards,\\nSales Team\"\n    }\n  ],\n  \"message\": \"All invoices processed and customers notified\"\n}\n```\n\n##### ‚ùå Validation Error (HTTP 400)\n\nOccurs when the CSV file is missing required columns or contains invalid data.\n```json\n{\n  \"success\": false,\n  \"message\": \"CSV validation failed\",\n  \"error\": \"Validation failed: [ { \\\"row\\\": 2, \\\"errors\\\": [\\\"Valid email is required\\\"] } ]\"\n}\n```\n\n## üß† How It Works\n\n1. **Webhook** receives uploaded CSV or raw text  \n2. **Code node** parses and validates data  \n3. **Data table node** loads product info (price, tax rate)  \n4. **Calculation node** generates invoice totals per customer  \n5. **Duplicate check** prevents reprocessing  \n6. **Data table insert** saves invoices  \n7. **Email preparation** creates personalized confirmations  \n8. **Webhook response** returns structured JSON (200 / 400 / 409)  \n\n---\n\n## üîê Requirements\n\n- n8n version ‚â• **1.41.0**  \n- **Data tables** feature enabled  \n- Publicly accessible webhook URL (for testing)  \n- *(Optional)* Connect a real email node (Gmail or SMTP) to send messages  \n\n---\n\n## üèÅ Result Highlights\n\n- Full **CSV ‚Üí Validation ‚Üí Data tables ‚Üí Email ‚Üí JSON Response** pipeline  \n- Includes built-in structured error handling (**400 / 409**)  \n- **100% native n8n functionality**  \n- Perfect example of **Data tables + logic-based automation** for business use cases  \n\n",
  "featuredImage": "/data/workflows/10274/10274.webp",
  "author": {
    "id": 101,
    "slug": "patrickn8n",
    "name": "Patrick Siewert",
    "avatar": ""
  },
  "categories": [
    "Invoice Processing"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 152,
  "downloads": 15,
  "createdAt": "2025-10-29T13:10:59.604Z",
  "updatedAt": "2026-01-16T09:04:13.891Z",
  "publishedAt": "2025-10-29T13:10:59.604Z",
  "nodes": 21,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/10274"
}