{
  "workflow": {
    "id": 4559,
    "name": "Intelligent web & local search with Brave Search API and Google Gemini MCP Server",
    "views": 1701,
    "recentViews": 0,
    "totalViews": 1701,
    "createdAt": "2025-06-01T12:10:43.912Z",
    "description": "## Summary\nThis n8n workflow implements an AI-powered agent that intelligently uses the Brave Search API (via an external MCP service like Smithery) to perform both web and local searches. It understands natural language queries, selects the appropriate search tool, and exposes this enhanced capability as a single, callable MCP tool.\n\n## Key Features\n*   ü§ñ **Intelligent Tool Selection:** AI agent decides between Brave's web search and local search tools based on user query context.\n*   üåê **MCP Microservice:** Exposes complex search logic as a single, easy-to-integrate MCP tool (`call_brave_search_agent`).\n*   üß† **Powered by Google Gemini:** Utilizes the `gemini-2.5-flash-preview-05-20` LLM for advanced reasoning.\n*   üó£Ô∏è **Conversational Memory:** Remembers context within a single execution flow.\n*   üìù **Customizable System Prompt:** Tailor the AI's behavior and responses.\n*   üß© **Modular Design:** Connects to external Brave Search MCP tools (e.g., from Smithery).\n\n## Benefits\n*   üîå **Simplified Integration:** Easily add advanced, AI-driven search capabilities to other applications or agent systems.\n*   üí∏ **Reduced Client-Side LLM Costs:** Offloads complex prompting and tool orchestration to n8n, minimizing token usage for client-side LLMs.\n*   üîß **Centralized Logic:** Manage and update search strategies and AI behavior in one place.\n*   üöÄ **Extensible:** Can be adapted to use other search tools or incorporate more complex decision-making.\n\n## Nodes Used\n*   `@n8n/n8n-nodes-langchain.mcpTrigger` (MCP Server Trigger)\n*   `@n8n/n8n-nodes-langchain.toolWorkflow`\n*   `@n8n/n8n-nodes-langchain.agent` (AI Agent)\n*   `@n8n/n8n-nodes-langchain.lmChatGoogleGemini` (Google Gemini Chat Model)\n*   `n8n-nodes-mcp.mcpClientTool` (MCP Client Tool - for Brave Search)\n*   `@n8n/n8n-nodes-langchain.memoryBufferWindow` (Simple Memory)\n*   `n8n-nodes-base.executeWorkflowTrigger` (Workflow Start - for direct execution/testing)\n\n## Prerequisites\n*   An active n8n instance (v1.22.5+ recommended).\n*   A Google AI API key for using the Gemini LLM.\n*   Access to an external MCP service that provides Brave Search tools (e.g., a Smithery account configured with their Brave Search MCP). This includes the MCP endpoint URL and any necessary authentication (like an API key for Smithery).\n\n## Setup Instructions\n1.  **Import Workflow:** Download the `Brave_Search_Smithery_AI_Agent_MCP_Server.json` file and import it into your n8n instance.\n2.  **Configure LLM Credential:**\n    *   Locate the **'Google Gemini Chat Model'** node.\n    *   Select or create an n8n credential for \"Google Palm API\" (used for Gemini), providing your Google AI API key.\n3.  **Configure Brave Search MCP Credential:**\n    *   Locate the **'brave_web_search'** and **'brave_local_search'** (MCP Client) nodes.\n    *   Create a new n8n credential of type \"MCP Client HTTP API\".\n        *   **Name:** e.g., `Smithery Brave Search Access`\n        *   **Base URL:** Enter the URL of your Brave Search MCP endpoint from your provider (e.g., `https://server.smithery.ai/@YOUR_PROFILE/brave-search/mcp`).\n        *   **Authentication:** If your MCP provider requires an API key, select \"Header Auth\". Add a header with the name (e.g., `X-API-Key`) and value provided by your MCP service.\n    *   Assign this newly created credential to both the 'brave_web_search' and 'brave_local_search' nodes.\n4.  **Note MCP Trigger Path:**\n    *   Open the **'Brave Search MCP Server Trigger'** node.\n    *   Copy its unique 'Path' (e.g., `/cc8cc827-3e72-4029-8a9d-76519d1c136d`). You will combine this with your n8n instance's base URL to get the full endpoint URL for clients.\n\n## How to Use\nThis workflow exposes an MCP tool named `call_brave_search_agent`. External clients can call this tool via the URL derived from the 'Brave Search MCP Server Trigger'.\n\n**Example Client MCP Configuration (e.g., for Roo Code):**\n```json\n\"n8n-brave-search-agent\": {\n  \"url\": \"https://YOUR_N8N_INSTANCE/mcp/cc8cc827-3e72-4029-8a9d-76519d1c136d/sse\",\n  \"alwaysAllow\": [\n    \"call_brave_search_agent\"\n  ]\n}\n```\n*Replace `YOUR_N8N_INSTANCE` with your n8n's public URL and ensure the path matches your trigger node.*\n\n**Example Request:**\nSend a `POST` request to the trigger URL with a JSON body:\n```json\n{\n  \"input\": { \"query\": \"best coffee shops in London\" }\n}\n```\n\n\n\nThe agent will stream its response, including the summarized search results.\n\n## Customization\n*   **AI Behavior:** Modify the System Prompt within the **'Brave Search AI Agent'** node to fine-tune its decision-making, response style, or how it uses the search tools.\n*   **LLM Choice:** Replace the **'Google Gemini Chat Model'** node with any other compatible LLM node supported by n8n.\n*   **Search Tools:** Adapt the workflow to use different or additional search tools by modifying the MCP Client nodes and updating the AI Agent's system prompt and tool definitions.\n\n## Further Information\n*   GitHub Repository: https://github.com/jezweb/n8n\n*   The workflow includes extensive sticky notes for in-canvas documentation.\n\n## Author\nJeremy Dawes (Jezweb)",
    "workflow": {
      "id": "QclY1XQ8GEstkvk7",
      "meta": {
        "instanceId": "3612a0c89f35a354ddd1216385240db51b4635fde7cae2a0d5004be915b832f3",
        "templateCredsSetupCompleted": true
      },
      "name": "Brave Search Smithery AI Agent MCP Server",
      "tags": [],
      "nodes": [
        {
          "id": "74edac39-0775-4a4d-a007-43e8853b6ff4",
          "name": "Google Gemini Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
          "position": [
            200,
            400
          ],
          "parameters": {
            "options": {},
            "modelName": "models/gemini-2.5-flash-preview-05-20"
          },
          "credentials": {
            "googlePalmApi": {
              "id": "credential-id",
              "name": "googlePalmApi Credential"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "980cab3a-cc95-4e93-b334-7659d86e535d",
          "name": "Simple Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            700,
            520
          ],
          "parameters": {
            "sessionKey": "={{ $execution.id }}",
            "sessionIdType": "customKey"
          },
          "typeVersion": 1.3
        },
        {
          "id": "530a8f53-88ff-42e2-84df-75c2e053c0ad",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3000,
            -1280
          ],
          "parameters": {
            "width": 980,
            "height": 440,
            "content": "## üìû MCP Client Configuration\n### For Roo Code, Cline, etc.\nTo use this Brave Search AI Agent in your MCP client:\n\n```json\n\"n8n-brave-search-agent\": {\n  \"url\": \"https://YOUR_N8N_INSTANCE/mcp/cc8cc827-3e72-4029-8a9d-76519d1c136d/sse\",\n  \"alwaysAllow\": [\n    \"call_brave_search_agent\"\n  ]\n}\n```\n\n**üìù Notes:**\n*   Replace `YOUR_N8N_INSTANCE` with your actual n8n URL.\n*   The URL path `cc8cc827-3e72-4029-8a9d-76519d1c136d` comes from the **Brave Search MCP Server Trigger** node.\n*   `call_brave_search_agent` is the name of the **Tool Workflow** node in this main workflow.\n"
          },
          "typeVersion": 1
        },
        {
          "id": "0e22c1e6-8bc2-40a1-9bdf-d498e39c8184",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -360,
            -1140
          ],
          "parameters": {
            "color": 4,
            "width": 680,
            "height": 440,
            "content": "## üì° Brave Search MCP Server Trigger\nThis node is the **public entry point** for the Brave Search AI Agent service. It exposes an MCP (Multi-Agent Collaboration Protocol) SSE (Server-Sent Events) endpoint.\n\n### Key Details:\n*   **üõ§Ô∏è Path:** `/cc8cc827-3e72-4029-8a9d-76519d1c136d` (Unique endpoint identifier)\n*   **üëÇ Function:** Listens for incoming HTTP POST requests to its SSE endpoint.\n*   **üõ†Ô∏è Tool Exposed:** Makes the `call_brave_search_agent` tool available to external MCP clients.\n*   **üì• Input:** Expects JSON: `{\"input\": {\"query\": \"user's search query\"}}`\n*   **üì§ Output:** Streams SSE events with the AI agent's responses."
          },
          "typeVersion": 1
        },
        {
          "id": "1f2b2e2d-b05c-4721-9603-4b7911763f7e",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -360,
            -680
          ],
          "parameters": {
            "color": 4,
            "width": 680,
            "height": 340,
            "content": "## ‚û°Ô∏è call_brave_search_agent (Tool Workflow Node)\nThis node represents the **tool** (`call_brave_search_agent`) that external clients call via the MCP Server Trigger.\n\n### Functionality:\n*   **üöÄ Action:** Invokes the **\"Brave Search Smithery AI Agent MCP Server\"** sub-workflow (ID: `QclY1XQ8GEstkvk7`) to process the user's search request.\n*   **üì• Inputs to Sub-Workflow:**\n    *   `query`: The user's natural language search query from the MCP client.\n*   **üì§ Output:** The AI agent's final response/stream is passed back through the MCP Server Trigger to the client."
          },
          "typeVersion": 1
        },
        {
          "id": "32123f13-3b04-4245-b757-9dc128fa1ff9",
          "name": "Sticky Note3",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2060,
            -660
          ],
          "parameters": {
            "color": 2,
            "width": 860,
            "height": 600,
            "content": "## üó∫Ô∏è Main MCP Server Workflow Overview\n### Brave Search AI Agent Gateway üîé\nThis workflow acts as the public gateway for the Brave Search AI Agent.\n\n### 1. `Brave Search MCP Server Trigger` üì°\n*   Receives requests from external clients (e.g., Roo Code, Cline).\n*   **Client JSON Example:**\n    ```json\n    \"n8n-brave-search-agent\": {\n      \"url\": \"https://YOUR_N8N_INSTANCE/mcp/cc8cc827-3e72-4029-8a9d-76519d1c136d/sse\",\n      \"alwaysAllow\": [\"call_brave_search_agent\"]\n    }\n    ```\n    *(Confirm path & replace `YOUR_N8N_INSTANCE`)*\n\n### 2. `call_brave_search_agent` (Tool Workflow Node) ‚û°Ô∏è\n*   The \"tool\" exposed by the MCP Server Trigger.\n*   Calls the AI Agent Sub-Workflow (ID: `QclY1XQ8GEstkvk7`), passing the user's `query`.\n\n### Data Flow üîÑ:\nClient ‚Üí MCP Trigger ‚Üí `call_brave_search_agent` ‚Üí Sub-Workflow ‚Üí MCP Trigger ‚Üí Client\n\n### ‚ÑπÔ∏è Learn More:\nWatch a video explaining this pattern: [MCP Agent Video](https://youtu.be/dudvmyp7Pyg?si=N59DYTe2WE6GPlvf)\n   "
          },
          "typeVersion": 1
        },
        {
          "id": "14df63dc-d419-435b-9214-68dfb550d3b3",
          "name": "Sticky Note4",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -220,
            -280
          ],
          "parameters": {
            "color": 5,
            "width": 540,
            "height": 500,
            "content": "## üèÅ Sub-Workflow Start: Brave Search Logic\nThis is the entry point for the **Brave Search AI Agent** sub-workflow.\n\n*   **üì• Receives:**\n    *   `query`: The user's natural language search query from the main workflow.\n*   **‚û°Ô∏è Passes data to:** The **Brave Search AI Agent** node."
          },
          "typeVersion": 1
        },
        {
          "id": "f43df2ce-59d4-4e6e-a9aa-bf1cb6740ca1",
          "name": "Sticky Note5",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            760,
            -280
          ],
          "parameters": {
            "color": 5,
            "width": 740,
            "height": 500,
            "content": "## üß† Brave Search AI Agent (Core Logic)\nThis is the primary AI unit.\n\n### Components:\n*   **ü§ñ Model:** Google Gemini (`models/gemini-2.5-flash-preview-05-20`)\n*   **üìú System Prompt:** Instructs the AI on query understanding and Brave Search tool usage. (See node config)\n*   **üõ†Ô∏è Tools:**\n    *   `brave_web_search`\n    *   `brave_local_search`\n*   **üíæ Memory:** `Simple Memory` (Session Key: `{{ $execution.id }}`)\n*   **üì• Input:** User's `query`.\n*   **üì§ Output:** Summarized search results after orchestrating tool calls."
          },
          "typeVersion": 1
        },
        {
          "id": "505ec39d-e687-4a5c-b0c0-c906e35cc830",
          "name": "Sticky Note6",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            500,
            640
          ],
          "parameters": {
            "color": 6,
            "width": 500,
            "height": 240,
            "content": "## üíæ Agent Memory (Simple Memory)\nProvides conversational memory for the AI Agent.\n\n*   **üìã Type:** Window Buffer Memory (keeps a sliding window of recent messages).\n*   **üîë Session Key:** `{{ $execution.id }}`\n    *   *Ensures memory is unique to each execution, preventing cross-talk.*"
          },
          "typeVersion": 1
        },
        {
          "id": "aa198f9b-5fcf-4d7d-a597-5aa12c67e122",
          "name": "Sticky Note7",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1040,
            640
          ],
          "parameters": {
            "color": 6,
            "width": 540,
            "height": 420,
            "content": "## üõ†Ô∏è Tool: brave_web_search (MCP Client)\nCalls the external **Brave Web Search** MCP tool via Smithery.\n\n### Details:\n*   **üîó Connection:** Uses the 'smithery brave search' credential.\n*   **üéØ Purpose:** Performs general web searches (articles, news, etc.).\n*   **ü§ñ AI Interaction:**\n    *   Guided by the AI Agent's system prompt for general queries.\n    *   AI generates JSON for parameters:\n        *   `query` (string, **required**)\n        *   `count` (number, optional, max 20)\n        *   `offset` (number, optional, max 9)\n    *   *Example JSON:* `{\"query\": \"latest AI news\", \"count\": 5}`\n*   **üì§ Output:** Web search results to the AI Agent."
          },
          "typeVersion": 1
        },
        {
          "id": "39f4dff5-2086-4663-9238-e0749f74cfe4",
          "name": "Sticky Note8",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            1620,
            640
          ],
          "parameters": {
            "color": 6,
            "width": 520,
            "height": 420,
            "content": "## üõ†Ô∏è Tool: brave_local_search (MCP Client)\nCalls the external **Brave Local Search** MCP tool via Smithery.\n\n### Details:\n*   **üîó Connection:** Uses the 'smithery brave search' credential.\n*   **üéØ Purpose:** Finds local businesses, services. *May fall back to web search.*\n*   **ü§ñ AI Interaction:**\n    *   Guided by system prompt for queries with local intent.\n    *   AI generates JSON for parameters:\n        *   `query` (string, **required**)\n        *   `count` (number, optional, max 20)\n    *   *Example JSON:* `{\"query\": \"pizza near me\", \"count\": 3}`\n*   **üì§ Output:** Local search results (or web results if fallback) to AI Agent."
          },
          "typeVersion": 1
        },
        {
          "id": "f5a49518-9373-4791-ac04-5ee8c2956c7f",
          "name": "Sticky Note9",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            780,
            -1580
          ],
          "parameters": {
            "color": 7,
            "width": 720,
            "height": 660,
            "content": "## üí° n8n AI Agent as an MCP Service\n### Brave Search Example üîé\n**üéØ What This Sub-Workflow Does:**\nTransforms an AI agent specialized in **Brave Search** into a callable \"skill\" for the main MCP server. It enables natural language queries for web and local search.\n\n**üîÑ How It Works (Internally):**\n1.  Receives `query` from the main workflow's `call_brave_search_agent` tool.\n2.  The **`Brave Search AI Agent`** node (Gemini) orchestrates the task.\n3.  Uses connected MCP Client tools to call Smithery's Brave Search:\n    *   `brave_web_search` üåç\n    *   `brave_local_search` üìç\n4.  Utilizes `Simple Memory` for conversational context.\n\n**üèÜ Why This Pattern is Useful (with Smithery):**\n*   **Client Simplicity:** Main MCP clients call just *one tool* (`call_brave_search_agent`).\n*   **Token Efficiency:** Complex prompting for Brave tools happens *here*, not on the client-side.\n*   **Centralized Logic:** Update Brave search strategies here without affecting clients.\n*   **Agent Specialization:** This agent focuses *only* on Brave Search, making it modular.\n\n**(See Main Workflow for client connection examples.)**"
          },
          "typeVersion": 1
        },
        {
          "id": "4dbcdda3-c1c6-4e7b-a58c-dd7216934f13",
          "name": "Brave Search MCP Server Trigger",
          "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
          "position": [
            120,
            -820
          ],
          "webhookId": "cc8cc827-3e72-4029-8a9d-76519d1c136d",
          "parameters": {
            "path": "cc8cc827-3e72-4029-8a9d-76519d1c136d"
          },
          "typeVersion": 1
        },
        {
          "id": "64cd0750-4f06-49ce-93f3-4fd97e37a94f",
          "name": "call_brave_search_agent",
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "position": [
            280,
            -460
          ],
          "parameters": {
            "workflowId": {
              "__rl": true,
              "mode": "list",
              "value": "QclY1XQ8GEstkvk7",
              "cachedResultName": "Brave Search Smithery AI Agent MCP Server"
            },
            "description": "=To perform web and local searches using the Brave Search MCP and provide relevant results based on user queries. It should intelligently decide when to use web search versus local search.",
            "workflowInputs": {
              "value": {
                "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `The primary natural language query from the user for searching.`, 'string') }}"
              },
              "schema": [
                {
                  "id": "query",
                  "type": "string",
                  "display": true,
                  "removed": false,
                  "required": false,
                  "displayName": "query",
                  "defaultMatch": false,
                  "canBeUsedToMatch": true
                }
              ],
              "mappingMode": "defineBelow",
              "matchingColumns": [],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            }
          },
          "typeVersion": 2.2
        },
        {
          "id": "b58d3462-db63-4007-8faa-83fafac2e2fe",
          "name": "brave_web_search",
          "type": "n8n-nodes-mcp.mcpClientTool",
          "position": [
            1280,
            480
          ],
          "parameters": {
            "toolName": "brave_web_search",
            "operation": "executeTool",
            "connectionType": "http",
            "toolParameters": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Tool_Parameters', `Generate a JSON object with the parameters for the 'brave_web_search' tool.\nThe tool expects a JSON object with the following keys:\n- \"query\": (string, **required**) The search terms for the web search.\n- \"count\": (number, optional) The number of results to return per page. Maximum is 20. If not provided, a default value will be used by the service.\n- \"offset\": (number, optional) The pagination offset to retrieve a specific page of results. Maximum is 9. If not provided, the first page is returned.\n\nExample (required only):\n{\"query\": \"latest AI research\"}\n\nExample (with optionals):\n{\"query\": \"popular javascript frameworks\", \"count\": 10, \"offset\": 0}`, 'json') }}",
            "descriptionType": "manual",
            "toolDescription": "Calls the 'brave_web_search' MCP tool to perform a general web search. Useful for finding articles, news, and answers to general knowledge questions. Supports pagination."
          },
          "credentials": {
            "mcpClientHttpApi": {
              "id": "credential-id",
              "name": "mcpClientHttpApi Credential"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "4578b0da-6a61-4b60-b178-7614139559eb",
          "name": "brave_local_search",
          "type": "n8n-nodes-mcp.mcpClientTool",
          "position": [
            1840,
            480
          ],
          "parameters": {
            "toolName": "brave_local_search",
            "operation": "executeTool",
            "connectionType": "http",
            "toolParameters": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Tool_Parameters', `Generate a JSON object with the parameters for the 'brave_local_search' tool.\nThe tool expects a JSON object with the following keys:\n- \"query\": (string, **required**) The search terms for the local search (e.g., \"coffee shop downtown\", \"bookstore [zip code]\").\n- \"count\": (number, optional) The number of local results to return. Maximum is 20. If not provided, a default value will be used by the service.\n\nExample (required only):\n{\"query\": \"restaurants near Eiffel Tower\"}\n\nExample (with optional count):\n{\"query\": \"best parks in Berlin\", \"count\": 5}\n\nNote: This tool does not support an 'offset' parameter for pagination. It may fall back to web search if no local results are found.`, 'json') }}",
            "descriptionType": "manual",
            "toolDescription": "Calls the 'brave_local_search' MCP tool to find local businesses, restaurants, and services. If no local results are found, it may automatically fall back to a web search."
          },
          "credentials": {
            "mcpClientHttpApi": {
              "id": "credential-id",
              "name": "mcpClientHttpApi Credential"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "4a481f1a-ddb6-4ddc-8c80-789a20369516",
          "name": "Brave Search AI Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            1000,
            80
          ],
          "parameters": {
            "text": "={{ $('Brave Search Workflow Start').item.json.query }}",
            "options": {
              "systemMessage": "You are an AI assistant designed to help users find information using Brave Search. You have access to two tools: 'brave_web_search' for general web queries and 'brave_local_search' for finding local businesses and services.\n\nYour primary goal is to understand the user's query and choose the most appropriate tool to get the best results.\n\nHere's how you should operate:\n1.  Analyze the user's query. Identify if it has a clear local intent (e.g., \"restaurants near me,\" \"hardware store in London,\" \"coffee shop 90210\") or if it's a general web search (e.g., \"latest news on AI,\" \"how to bake bread,\" \"what is quantum physics?\").\n\n2.  If local intent is strong:\n    *   Use the `brave_local_search` tool.\n    *   The `query` parameter for this tool should contain the local search terms (e.g., \"cafe Paris\", \"bookstore Main Street\").\n    *   You can use the optional `count` parameter (number, max 20) to specify how many results to retrieve.\n    *   Be aware that `brave_local_search` might automatically fall back to a web search if no specific local results are found. If this happens, clarify this in your response.\n\n3.  If the query is general or explicitly asks for web information:\n    *   Use the `brave_web_search` tool.\n    *   The `query` parameter for this tool should be the user's search terms.\n    *   You can use the optional `count` parameter (number, max 20) for results per page and `offset` (number, max 9) for pagination if needed for follow-up queries or if the user asks for more.\n\n4.  If the query is ambiguous (could be local or web):\n    *   You can either default to `brave_web_search` for broader coverage or, if confidence is low, ask the user for clarification, for example: \"Are you looking for web results or local businesses for this query?\"\n\n5.  After receiving results from a tool:\n    *   Summarize the key findings for the user.\n    *   Indicate whether the information came primarily from a web search or a local search, especially if a fallback occurred with `brave_local_search`.\n\nCritical points:\n*   Do not use the `offset` parameter with `brave_local_search`.\n*   Ensure parameters passed to tools are correctly formatted. `query` is always a string. `count` and `offset` are numbers.\n*   If a tool call fails or returns no relevant information, inform the user gracefully.\n*   Your final output should be a helpful summary addressing the user's query."
            },
            "promptType": "define"
          },
          "typeVersion": 2
        },
        {
          "id": "f811a9ae-4b05-4409-8f80-56e468c07111",
          "name": "Brave Search Workflow Start",
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "position": [
            -20,
            80
          ],
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "query"
                }
              ]
            }
          },
          "typeVersion": 1.1
        },
        {
          "id": "0bff9d79-dc48-45e5-b5c4-a05832999e77",
          "name": "Sticky Note10",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2060,
            -1280
          ],
          "parameters": {
            "width": 860,
            "height": 400,
            "content": "## üß™ Testing this MCP Endpoint\nYou can test this agent externally using tools like Postman, curl, or an MCP client.\n\n### Request Details:\n*   **Method:** `POST`\n*   **URL:** `https://YOUR_N8N_INSTANCE/mcp/cc8cc827-3e72-4029-8a9d-76519d1c136d/sse`\n    *(Replace with your full URL from the MCP Server Trigger node)*\n*   **Headers:** `Content-Type: application/json`\n*   **Body Example:**\n    ```json\n    {\n      \"input\": {\n        \"query\": \"your test query here\"\n      },\n      \"options\": {} // Optional, depending on MCP client\n    }\n    ```"
          },
          "typeVersion": 1
        },
        {
          "id": "69d177f9-777d-4348-897e-5eabc0e314c9",
          "name": "Sticky Note12",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -20,
            540
          ],
          "parameters": {
            "color": 6,
            "width": 480,
            "height": 340,
            "content": "## ‚öôÔ∏è Key LLM & Agent Settings\n### Core Configuration:\n*   **ü§ñ LLM Model:** `models/gemini-2.5-flash-preview-05-20`\n*   **üìú Agent System Prompt:**\n    *   Defined in the **'Brave Search AI Agent'** node.\n    *   *Crucial for tool selection and response style.*\n*   **üß† Memory:** `Simple Memory`\n    *   Session Key: `{{ $execution.id }}`\n\n‚ú® *Modifying the System Prompt or LLM can significantly alter agent behavior.*"
          },
          "typeVersion": 1
        },
        {
          "id": "d3b3c2b9-5ddf-4ac1-a2e7-a50f7fdc6da1",
          "name": "Sticky Note13",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            340,
            -280
          ],
          "parameters": {
            "color": 5,
            "width": 400,
            "height": 500,
            "content": "## üéØ Sub-Workflow: Brave Search AI Agent Core Logic\n### Purpose:\nTo process a user's search query, intelligently decide between web or local Brave search, execute the search via Smithery MCP tools, and summarize the results.\n\n### Expected Input:\n(From main workflow, via the `query` parameter passed to `call_brave_search_agent`)\n*   A natural language string representing the user's search request.\n    *   *Example 1:* \"restaurants near me\"\n    *   *Example 2:* \"latest AI news\""
          },
          "typeVersion": 1
        },
        {
          "id": "e00f2870-ff34-4d5d-926f-93ed191f7b22",
          "name": "Sticky Note14",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            2060,
            -860
          ],
          "parameters": {
            "width": 860,
            "height": 180,
            "content": "## üõ†Ô∏è Troubleshooting Tips (Sub-Workflow)\n1.  **üìú Agent Logs:** Check execution logs of the **'Brave Search AI Agent'** node for its \"thought process\" and tool calls.\n2.  **üîé MCP Client Tools:** Verify inputs/outputs of `brave_web_search` & `brave_local_search` nodes.\n3.  **üåê External Service:** Test the Smithery Brave Search MCP (URL in Sticky Note11) independently if tool calls fail.\n4.  **üîë Credentials:** Ensure 'smithery brave search' n8n credential is valid.\n5.  **üí¨ LLM Issues:** For unexpected LLM responses, review/tweak the System Prompt in the AI Agent node."
          },
          "typeVersion": 1
        },
        {
          "id": "3eed4f4b-d7c1-42b8-b6a1-86e005454624",
          "name": "Sticky Note15",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -360,
            -1580
          ],
          "parameters": {
            "color": 4,
            "width": 680,
            "height": 200,
            "content": "## üìÑ Workflow Information\n*   **Workflow:** Brave Search Smithery AI Agent MCP Server (Main Gateway)\n*   **Version:** 1.0.0\n*   **Last Updated:** 2025-06-01\n*   **üë§ Author:** Jeremy Dawes, Jezweb ([www.jezweb.com.au](https://www.jezweb.com.au/))\n*   **üìú Description:** Main MCP server exposing the Brave Search AI Agent."
          },
          "typeVersion": 1
        },
        {
          "id": "cb0b44b4-2a47-4908-9ec3-81d6736b27d5",
          "name": "Sticky Note16",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -360,
            -1360
          ],
          "parameters": {
            "color": 4,
            "width": 680,
            "height": 200,
            "content": "## ‚úÖ TODO / Future Enhancements\n*   [ ] Add more detailed error handling for specific tool failures.\n*   [ ] Explore caching results for common queries.\n*   [ ] Refine system prompt for ambiguous local vs. web search cases.\n*   [ ] Consider adding freshness parameters to `brave_web_search` if needed."
          },
          "typeVersion": 1
        },
        {
          "id": "56163ca6-2bad-495c-b486-54f36a3b4e75",
          "name": "Sticky Note11",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            3000,
            -800
          ],
          "parameters": {
            "width": 990,
            "height": 1120,
            "content": "## Example prompt and response in Roo Code\n\n![Source example](https://www.jezweb.com.au/wp-content/uploads/2025/06/brave-search-mcp-server-agent-roo-code.png#full-width)\n\n### Much less context wasted on extra information fromt he Brave Search MCP server output!"
          },
          "typeVersion": 1
        },
        {
          "id": "b268e31a-72f8-4ed5-b9da-55bfcae49b2d",
          "name": "Sticky Note17",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            4040,
            -780
          ],
          "parameters": {
            "width": 1460,
            "height": 1320,
            "content": "## Example raw output that Roo Code would receive direct from the Brave Search MCP\n\n![Example raw output that Roo Code would receive direct from the Brave Search MCP](https://www.jezweb.com.au/wp-content/uploads/2025/06/brave-search-example-raw-result.png#full-width)"
          },
          "typeVersion": 1
        }
      ],
      "active": true,
      "pinData": {},
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "6fb7ce8c-5a65-4e4e-9af7-cadc36bf31ae",
      "connections": {
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "Brave Search AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "brave_web_search": {
          "ai_tool": [
            [
              {
                "node": "Brave Search AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "brave_local_search": {
          "ai_tool": [
            [
              {
                "node": "Brave Search AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "call_brave_search_agent": {
          "ai_tool": [
            [
              {
                "node": "Brave Search MCP Server Trigger",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google Gemini Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "Brave Search AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Brave Search Workflow Start": {
          "main": [
            [
              {
                "node": "Brave Search AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      }
    },
    "lastUpdatedBy": 29,
    "workflowInfo": {
      "nodeCount": 26,
      "nodeTypes": {
        "n8n-nodes-base.stickyNote": {
          "count": 18
        },
        "n8n-nodes-mcp.mcpClientTool": {
          "count": 2
        },
        "@n8n/n8n-nodes-langchain.agent": {
          "count": 1
        },
        "@n8n/n8n-nodes-langchain.mcpTrigger": {
          "count": 1
        },
        "@n8n/n8n-nodes-langchain.toolWorkflow": {
          "count": 1
        },
        "n8n-nodes-base.executeWorkflowTrigger": {
          "count": 1
        },
        "@n8n/n8n-nodes-langchain.lmChatGoogleGemini": {
          "count": 1
        },
        "@n8n/n8n-nodes-langchain.memoryBufferWindow": {
          "count": 1
        }
      }
    },
    "status": "published",
    "user": {
      "name": "Jez",
      "username": "jez",
      "bio": "I'm passionate about combining traditional web development with AI and automation to create impactful online solutions. As Founder & CEO of Jezweb, an award-winning Newcastle, Australia agency, I lead a 30+ person team delivering high-quality web design, development, and hosting services to over 3000 clients.",
      "verified": true,
      "links": [
        "https://www.jezweb.com.au"
      ],
      "avatar": "https://gravatar.com/avatar/5f6cbb73f1a61b0bea48b1fac47a94e693ca6f6bc2359eff9c7e68159698efc6?r=pg&d=retro&size=200"
    },
    "nodes": [
      {
        "id": 565,
        "icon": "fa:sticky-note",
        "name": "n8n-nodes-base.stickyNote",
        "codex": {
          "data": {
            "alias": [
              "Comments",
              "Notes",
              "Sticky"
            ],
            "categories": [
              "Core Nodes"
            ],
            "nodeVersion": "1.0",
            "codexVersion": "1.0",
            "subcategories": {
              "Core Nodes": [
                "Helpers"
              ]
            }
          }
        },
        "group": "[\"input\"]",
        "defaults": {
          "name": "Sticky Note",
          "color": "#FFD233"
        },
        "iconData": {
          "icon": "sticky-note",
          "type": "icon"
        },
        "displayName": "Sticky Note",
        "typeVersion": 1,
        "nodeCategories": [
          {
            "id": 9,
            "name": "Core Nodes"
          }
        ]
      },
      {
        "id": 837,
        "icon": "fa:sign-out-alt",
        "name": "n8n-nodes-base.executeWorkflowTrigger",
        "codex": {
          "data": {
            "resources": {
              "generic": [],
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflowtrigger/"
                }
              ]
            },
            "categories": [
              "Core Nodes"
            ],
            "nodeVersion": "1.0",
            "codexVersion": "1.0",
            "subcategories": {
              "Core Nodes": [
                "Helpers"
              ]
            }
          }
        },
        "group": "[\"trigger\"]",
        "defaults": {
          "name": "When Executed by Another Workflow",
          "color": "#ff6d5a"
        },
        "iconData": {
          "icon": "sign-out-alt",
          "type": "icon"
        },
        "displayName": "Execute Workflow Trigger",
        "typeVersion": 1,
        "nodeCategories": [
          {
            "id": 9,
            "name": "Core Nodes"
          }
        ]
      },
      {
        "id": 1119,
        "icon": "fa:robot",
        "name": "@n8n/n8n-nodes-langchain.agent",
        "codex": {
          "data": {
            "alias": [
              "LangChain",
              "Chat",
              "Conversational",
              "Plan and Execute",
              "ReAct",
              "Tools"
            ],
            "resources": {
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent/"
                }
              ]
            },
            "categories": [
              "AI",
              "Langchain"
            ],
            "subcategories": {
              "AI": [
                "Agents",
                "Root Nodes"
              ]
            }
          }
        },
        "group": "[\"transform\"]",
        "defaults": {
          "name": "AI Agent",
          "color": "#404040"
        },
        "iconData": {
          "icon": "robot",
          "type": "icon"
        },
        "displayName": "AI Agent",
        "typeVersion": 3,
        "nodeCategories": [
          {
            "id": 25,
            "name": "AI"
          },
          {
            "id": 26,
            "name": "Langchain"
          }
        ]
      },
      {
        "id": 1163,
        "icon": "fa:database",
        "name": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "codex": {
          "data": {
            "resources": {
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.memorybufferwindow/"
                }
              ]
            },
            "categories": [
              "AI",
              "Langchain"
            ],
            "subcategories": {
              "AI": [
                "Memory"
              ],
              "Memory": [
                "For beginners"
              ]
            }
          }
        },
        "group": "[\"transform\"]",
        "defaults": {
          "name": "Simple Memory"
        },
        "iconData": {
          "icon": "database",
          "type": "icon"
        },
        "displayName": "Simple Memory",
        "typeVersion": 1,
        "nodeCategories": [
          {
            "id": 25,
            "name": "AI"
          },
          {
            "id": 26,
            "name": "Langchain"
          }
        ]
      },
      {
        "id": 1205,
        "icon": "fa:network-wired",
        "name": "@n8n/n8n-nodes-langchain.toolWorkflow",
        "codex": {
          "data": {
            "resources": {
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.toolworkflow/"
                }
              ]
            },
            "categories": [
              "AI",
              "Langchain"
            ],
            "subcategories": {
              "AI": [
                "Tools"
              ],
              "Tools": [
                "Recommended Tools"
              ]
            }
          }
        },
        "group": "[\"transform\"]",
        "defaults": {
          "name": "Call n8n Workflow Tool"
        },
        "iconData": {
          "icon": "network-wired",
          "type": "icon"
        },
        "displayName": "Call n8n Workflow Tool",
        "typeVersion": 2,
        "nodeCategories": [
          {
            "id": 25,
            "name": "AI"
          },
          {
            "id": 26,
            "name": "Langchain"
          }
        ]
      },
      {
        "id": 1262,
        "icon": "file:google.svg",
        "name": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "codex": {
          "data": {
            "resources": {
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.lmchatgooglegemini/"
                }
              ]
            },
            "categories": [
              "AI",
              "Langchain"
            ],
            "subcategories": {
              "AI": [
                "Language Models",
                "Root Nodes"
              ],
              "Language Models": [
                "Chat Models (Recommended)"
              ]
            }
          }
        },
        "group": "[\"transform\"]",
        "defaults": {
          "name": "Google Gemini Chat Model"
        },
        "iconData": {
          "type": "file",
          "fileBuffer": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2aWV3Qm94PSIwIDAgNDggNDgiPjxkZWZzPjxwYXRoIGlkPSJhIiBkPSJNNDQuNSAyMEgyNHY4LjVoMTEuOEMzNC43IDMzLjkgMzAuMSAzNyAyNCAzN2MtNy4yIDAtMTMtNS44LTEzLTEzczUuOC0xMyAxMy0xM2MzLjEgMCA1LjkgMS4xIDguMSAyLjlsNi40LTYuNEMzNC42IDQuMSAyOS42IDIgMjQgMiAxMS44IDIgMiAxMS44IDIgMjRzOS44IDIyIDIyIDIyYzExIDAgMjEtOCAyMS0yMiAwLTEuMy0uMi0yLjctLjUtNCIvPjwvZGVmcz48Y2xpcFBhdGggaWQ9ImIiPjx1c2UgeGxpbms6aHJlZj0iI2EiIG92ZXJmbG93PSJ2aXNpYmxlIi8+PC9jbGlwUGF0aD48cGF0aCBmaWxsPSIjRkJCQzA1IiBkPSJNMCAzN1YxMWwxNyAxM3oiIGNsaXAtcGF0aD0idXJsKCNiKSIvPjxwYXRoIGZpbGw9IiNFQTQzMzUiIGQ9Im0wIDExIDE3IDEzIDctNi4xTDQ4IDE0VjBIMHoiIGNsaXAtcGF0aD0idXJsKCNiKSIvPjxwYXRoIGZpbGw9IiMzNEE4NTMiIGQ9Im0wIDM3IDMwLTIzIDcuOSAxTDQ4IDB2NDhIMHoiIGNsaXAtcGF0aD0idXJsKCNiKSIvPjxwYXRoIGZpbGw9IiM0Mjg1RjQiIGQ9Ik00OCA0OCAxNyAyNGwtNC0zIDM1LTEweiIgY2xpcC1wYXRoPSJ1cmwoI2IpIi8+PC9zdmc+"
        },
        "displayName": "Google Gemini Chat Model",
        "typeVersion": 1,
        "nodeCategories": [
          {
            "id": 25,
            "name": "AI"
          },
          {
            "id": 26,
            "name": "Langchain"
          }
        ]
      },
      {
        "id": 1293,
        "icon": "file:../mcp.svg",
        "name": "@n8n/n8n-nodes-langchain.mcpTrigger",
        "codex": {
          "data": {
            "alias": [
              "Model Context Protocol",
              "MCP Server"
            ],
            "resources": {
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-langchain.mcptrigger/"
                }
              ]
            },
            "categories": [
              "AI",
              "Core Nodes",
              "Langchain"
            ],
            "subcategories": {
              "AI": [
                "Root Nodes",
                "Model Context Protocol"
              ],
              "Core Nodes": [
                "Other Trigger Nodes"
              ]
            }
          }
        },
        "group": "[\"trigger\"]",
        "defaults": {
          "name": "MCP Server Trigger"
        },
        "iconData": {
          "type": "file",
          "fileBuffer": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE5NSAxOTUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+Cgk8ZyBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMTIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+CgkJPHBhdGggZD0iTTI1IDk3Ljg1MjhMOTIuODgyMyAyOS45NzA2QzEwMi4yNTUgMjAuNTk4IDExNy40NTEgMjAuNTk4IDEyNi44MjMgMjkuOTcwNlYyOS45NzA2QzEzNi4xOTYgMzkuMzQzMSAxMzYuMTk2IDU0LjUzOTEgMTI2LjgyMyA2My45MTE3TDc1LjU1ODEgMTE1LjE3NyIvPgoJCTxwYXRoIGQ9Ik03Ni4yNjUzIDExNC40N0wxMjYuODIzIDYzLjkxMTdDMTM2LjE5NiA1NC41MzkxIDE1MS4zOTIgNTQuNTM5MSAxNjAuNzY1IDYzLjkxMTdMMTYxLjExOCA2NC4yNjUyQzE3MC40OTEgNzMuNjM3OCAxNzAuNDkxIDg4LjgzMzggMTYxLjExOCA5OC4yMDYzTDk5LjcyNDggMTU5LjZDOTYuNjAwNiAxNjIuNzI0IDk2LjYwMDYgMTY3Ljc4OSA5OS43MjQ4IDE3MC45MTNMMTEyLjMzMSAxODMuNTIiLz4KCQk8cGF0aCBkPSJNMTA5Ljg1MyA0Ni45NDExTDU5LjY0ODIgOTcuMTQ1N0M1MC4yNzU3IDEwNi41MTggNTAuMjc1NyAxMjEuNzE0IDU5LjY0ODIgMTMxLjA4N1YxMzEuMDg3QzY5LjAyMDggMTQwLjQ1OSA4NC4yMTY4IDE0MC40NTkgOTMuNTg5NCAxMzEuMDg3TDE0My43OTQgODAuODgyMiIvPgoJPC9nPgo8L3N2Zz4K"
        },
        "displayName": "MCP Server Trigger",
        "typeVersion": 2,
        "nodeCategories": [
          {
            "id": 9,
            "name": "Core Nodes"
          },
          {
            "id": 25,
            "name": "AI"
          },
          {
            "id": 26,
            "name": "Langchain"
          }
        ]
      }
    ],
    "categories": [
      {
        "id": 5,
        "name": "Engineering"
      },
      {
        "id": 48,
        "name": "AI RAG"
      }
    ],
    "image": []
  }
}