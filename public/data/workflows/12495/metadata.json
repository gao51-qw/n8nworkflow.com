{
  "id": 12495,
  "slug": "12495",
  "title": "Audit SharePoint Online external sharing and anonymous links with Microsoft Graph",
  "description": "## Audit external sharing in SharePoint to ensure compliance\n\nThis workflow audits your **SharePoint Online** environment for **external sharing risks** by identifying files and folders that are shared with **anonymous links** or **external/guest users**. It is designed to **traverse SharePoint recursively**, giving you full visibility into sharing across all sites, document libraries, folders and files.\n\n### What it does\n\n* Scans **all SharePoint sites** in the tenant.\n* **Traverses SharePoint recursively** through every folder and file, starting at the root of each drive.\n* Fetches **permissions for every item** (files and folders).\n* Detects and flags:\n\n  * **Anonymous sharing links** (anyone links)\n  * **External or guest users**, identified by:\n\n    * SharePoint guest login markers (`#ext#`, `urn:spo:guest`)\n    * Email domains not matching your internal tenant domains\n* Outputs **only items that are externally shared**, including detailed metadata and permission evidence.\n\n### How it works\n\n* In the **Set Variables** node you define your internal `tenantDomains`, used to distinguish internal users from external ones.\n\n* **Microsoft Graph** is used to:\n  * Fetch all SharePoint sites\n  * Retrieve drives (document libraries) per site\n* Each drive triggers a **recursive subworkflow** that:\n  * Starts at the root level\n  * Determines whether an item is a folder or a file\n  * If a folder, drills down into its children\n  * Keeps both folders and files, since both can have unique permissions\n\n* For every discovered item:\n  * Permissions are retrieved via Microsoft Graph\n  * Item metadata and permissions are merged\n* A custom **filtering step** analyzes permissions and:\n\n  * Flags anonymous links and external principals\n  * Drops items with no external exposure\n* The final output is a clean, normalized list of **externally shared SharePoint items**, enriched with:\n\n  * Item name, type, URL and last modified date\n  * Site, drive, and parent identifiers\n  * Detailed lists of anonymous links and external users found\n\n### Setup\n\n* Create a **Microsoft Entra ID (Azure AD) App Registration**.\n* Grant **Microsoft Graph â€“ Application permissions**:\n  * `Sites.Read.All`\n\n* Configure an **OAuth2 Client Credentials** credential in n8n and assign it to all HTTP Request nodes.\n\n* Update the **Set Variables** node:\n\n  * Add all internal tenant domains (e.g. `yourDomain.onmicrosoft.com`, `yourDomain.com`)\n* Run the workflow manually or attach a **Schedule Trigger** for recurring audits.\n\n### Notes\n\n* The workflow **traverses SharePoint recursively**, ensuring no nested folder or file is missed.\n* Both folders and files are included because **permissions can be broken at any level**.\n* External users are detected defensively using **both login-name patterns and email domain checks**.",
  "featuredImage": "/data/workflows/12495/12495.webp",
  "author": {
    "id": 101,
    "slug": "alexschnabl",
    "name": "Alexander Schnabl",
    "avatar": ""
  },
  "categories": [
    "Document Extraction",
    "AI Summarization"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 2,
  "downloads": 0,
  "createdAt": "2026-01-05T17:27:56.667Z",
  "updatedAt": "2026-01-16T09:12:32.893Z",
  "publishedAt": "2026-01-05T17:27:56.667Z",
  "nodes": 31,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/12495"
}