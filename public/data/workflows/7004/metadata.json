{
  "id": 7004,
  "slug": "7004",
  "title": "AI orchestrator: dynamically selects models based on input type",
  "description": "This workflow is designed to intelligently **route user queries to the most suitable large language model (LLM)** based on the type of request received in a chat environment. It uses structured classification and model selection to optimize both performance and cost-efficiency in AI-driven conversations.\n\nIt dynamically routes requests to specialized AI models based on content type, optimizing response quality and efficiency.\n\n---\n\n###  **Benefits**\n\n* **Smart Model Routing**: Reduces costs by using lighter models for general tasks and reserving heavier models for complex needs.\n* **Scalability**: Easily expandable by adding more request types or LLMs.\n* **Maintainability**: Clear logic separation between classification, model routing, and execution.\n* **Personalization**: Can be integrated with session IDs for per-user memory, enabling personalized conversations.\n* **Speed Optimization**: Fast models like `GPT-4.1 mini` or `Gemini Flash` are chosen for tasks where speed is a priority.\n---\n\n### **How It Works**\n1. **Input Handling**:  \n   - The workflow starts with the \"When chat message received\" node, which triggers the process when a chat message is received. The input includes the chat message (`chatInput`) and a session ID (`sessionId`).\n\n2. **Request Classification**:  \n   - The \"Request Type\" node uses an OpenAI model (`gpt-4.1-mini`) to classify the incoming request into one of four categories:  \n     - `general`: For general queries.  \n     - `reasoning`: For reasoning-based questions.  \n     - `coding`: For code-related requests.  \n     - `search`: For queries requiring search tools.  \n   - The classification is structured using the \"Structured Output Parser\" node, which enforces a consistent output format.\n\n3. **Model Selection**:  \n   - The \"Model Selector\" node routes the request to one of four AI models based on the classification:  \n     - **Opus 4** (Claude 4 Sonnet): Used for `coding` requests.  \n     - **Gemini Thinking Pro**: Used for `reasoning` requests.  \n     - **GPT 4.1 mini**: Used for `general` requests.  \n     - **Perplexity**: Used for `search` (Google-related) requests.  \n\n4. **AI Processing**:  \n   - The selected model processes the request via the \"AI Agent\" node, which includes intermediate steps for complex tasks.  \n   - The \"Simple Memory\" node retains session context using the provided `sessionId`, enabling multi-turn conversations.  \n\n5. **Output**:  \n   - The final response is generated by the chosen model and returned to the user.  \n\n---\n\n### **Set Up Steps**\n1. **Configure Trigger**:  \n   - Ensure the \"When chat message received\" node is set up with the correct webhook ID to receive chat inputs.  \n\n2. **Define Classification Logic**:  \n   - Adjust the prompt in the \"Request Type\" node to refine classification accuracy.  \n   - Verify the output schema in the \"Structured Output Parser\" node matches expected categories (`general`, `reasoning`, `coding`, `search`).  \n\n3. **Connect AI Models**:  \n   - Link each model node (Opus 4, Gemini Thinking Pro, GPT 4.1 mini, Perplexity) to the \"Model Selector\" node.  \n   - Ensure credentials (API keys) for each model are correctly configured in their respective nodes.  \n\n4. **Set Up Memory**:  \n   - Configure the \"Simple Memory\" node to use the `sessionId` from the input for context retention.  \n\n5. **Test Workflow**:  \n   - Send test inputs to verify classification and model routing.  \n   - Check intermediate outputs (e.g., `request_type`) to ensure correct model selection.  \n\n6. **Activate Workflow**:  \n   - Toggle the workflow to \"Active\" in n8n after testing.  \n\n---\n### **Need help customizing?**  \n[Contact me](mailto:info@n3w.it) for consulting and support or add me on [Linkedin](https://www.linkedin.com/in/davideboizza/). ",
  "featuredImage": "/data/workflows/7004/7004.webp",
  "author": {
    "id": 101,
    "slug": "n3witalia",
    "name": "Davide",
    "avatar": ""
  },
  "categories": [
    "Engineering",
    "AI Chatbot"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 10060,
  "downloads": 1006,
  "createdAt": "2025-08-05T10:21:49.772Z",
  "updatedAt": "2026-01-16T08:48:06.915Z",
  "publishedAt": "2025-08-05T10:21:49.772Z",
  "nodes": 12,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/7004"
}