{
  "id": 3892,
  "slug": "3892",
  "title": "PostgreSQL conversational agent with Claude & DeepSeek (Multi-KPI, Secure)",
  "description": "# ğŸ§  Conversational PostgreSQL Agent \n\nEnable AI-driven conversations with your PostgreSQL database using a secure and visual-free agent powered by n8nâ€™s Model Context Protocol (MCP). This template allows users to ask multiple KPIs in a single message, returning consolidated insights â€” more efficient than the original Conversing with Data template.\n\n---\n\n## ğŸš€ Why This Template\n\nUnlike the Conversing with Data workflow, which handles one KPI per message, this version:\n\n- âœ… Supports multi-KPI questions  \n- âœ… Returns structured, human-readable reports  \n- âœ… Uses fewer AI calls, making it faster and cheaper  \n- âœ… Avoids raw SQL execution for enhanced security\n\nğŸ’² **Estimated cost per full multi-request run: ~$0.01**\n\nThis template is optimized for efficiency. Each message can return 2â€“4 KPIs (You can change the MaxIteration of the Agent to make it more, it is currently set up at 30 iterations) using a single Claude 3.5 Haiku session and DeepSeek-based SQL generation â€” balancing speed, reasoning, and affordability.\n\n---\n\n## ğŸ’¬ Sample Use Case\n\n**User:**  \nâ€œCan you show product performance, revenue trends, and top 5 customers?â€\n\n**Agent:**  \n- Uses `ListTables` and `GetTableSchema`  \n- Generates three SQL queries using `get_query_and_data`  \n- Returns:\n\nğŸ“Š **Product Performance**  \n1. High-Waist Jeans â€” 10 units, $1,027 revenue  \n2. Denim Jacket â€” 10 units, $783 revenue  \n\nğŸ“ˆ **Sales Trends**  \n- Peak Month: January 2024 â€” 32 units, $2,378  \n- Average Monthly Units: 10â€“16  \n\nğŸ§ **Customer Insights**  \n1. Bob Brown â€” $1,520 spent  \n2. Diana Wilson â€” $925 spent  \n\nAll from one natural prompt.\n\n---\n\n## ğŸ–¼ï¸ Real-World Interaction Screenshot\n\n\n\n![novisual_sql.png](fileId:1283)\n\n---\n\n## ğŸ§° Whatâ€™s Inside\n\n| Node                        | Purpose                                                   |\n|----------------------------|-----------------------------------------------------------|\n| MCP Server Trigger         | Receives user queries via `/mcp/...`                      |\n| AI Agent + Memory          | Understands and plans multi-step queries                  |\n| Think Tool                 | Breaks down the userâ€™s question into structured goals     |\n| get_query_and_data         | Generates SQL securely from natural language              |\n| ListTables, GetSchema      | AI tools to explore DB safely                             |\n| Read/Insert/Update Tools   | Execute structured operations (never raw SQL)             |\n| checkdatabase Subflow      | Validates SQL, formats response as clean text             |\n\n---\n\n## ğŸ¤– Model Selection Recommendations\n\nThis template uses two types of models, selected for cost-performance balance and role alignment:\n\n**1. Claude 3.5 Haiku (Anthropic) â€“ for the MCP Agent**  \nThe main conversational agent uses Claude 3.5 Haiku, ideal for MCP because it was built by Anthropic â€” the creators of the MCP standard. Itâ€™s fast, affordable, and performs excellently in tool-calling and reasoning tasks.\n\n**2. DeepSeek â€“ for the SQL subworkflow**  \nThe subworkflow that turns natural language into SQL uses DeepSeek. Itâ€™s one of the most affordable and performant models available today for structured outputs like SQL, making it a perfect fit for utility logic.\n\nâœ… This setup provides top-tier reasoning + low-cost execution.\n\n---\n\n## ğŸ” Security Benefits\n\n- No raw SQL accepted from the user or LLM  \n- All queries are parameterized  \n- Schema is dynamically retrieved  \n- Final output is clean, safe, and human-readable\n\n---\n\n## ğŸ§ª Try a Prompt\n\n&gt; â€œShow me the top 5 products by units sold and revenue, total monthly sales trend, and top 5 customers by spending.â€\n\nIn one message, the agent will:  \n- Generate and run multiple queries  \n- Use the schema to validate logic  \n- Return a single, comprehensive answer\n\n---\n\n## ğŸ›  How to Use\n\n1. ğŸ“¥ Upload both workflow files into your n8n instance:\n   - `Build_your_own_PostgreSQL_MCP_server_No_visuals_.json`\n   - `checkdatabase.json`\n2. ğŸ” Set up PostgreSQL credentials (e.g. â€œPostgres account 3â€)\n3. ğŸ§  Confirm model setup:\n   - Claude 3.5 Haiku for the main agent\n   - DeepSeek for the subflow\n4. ğŸŒ Use the `/mcp/...` URL from the MCP Server Trigger to connect your frontend or chatbot\n5. ğŸ—£ Ask questions naturally â€” the agent takes care of planning, querying, and formatting\n\n---\n\n## ğŸ”„ Customization Ideas\n\n- Swap Claude or DeepSeek for OpenAI, Mistral, Gemini, etc.  \n- Export insights to Slack, Notion, or Google Sheets  \n- Add Switch nodes to control access to specific tables  \n- Integrate with any front-end app, internal dashboard, or bot\n\n---\n\n## ğŸ“¦ What's Included\n\n- `Build_your_own_PostgreSQL_MCP_server_No_visuals_.json` â€“ MCP agent logic  \n- `checkdatabase.json` â€“ SQL generation and formatting utility workflow\n\nğŸ“ These must be uploaded into your n8n workspace for the template to function.\n\n---\n\n## ğŸ“Š Comparison: Conversing with Data vs This Workflow\n\n| Feature                       | Conversing with Data      | This Workflow                   |\n|------------------------------|---------------------------|---------------------------------|\n| Handles multi-KPI questions  | âŒ No                     | âœ… Yes                          |\n| Secure query execution       | âœ… Yes                    | âœ… Yes                          |\n| Structured response          | âš ï¸ JSON / raw            | âœ… Clean natural language       |\n| Cost-efficiency              | âš ï¸ More calls            | âœ… Optimized with fewer calls   |\n| Endpoint support             | âŒ Manual interaction     | âœ… MCP-ready (`/mcp/...`)       |\n\nğŸ”— Prefer something more lightweight and cost-sensitive?  \nTry the original Conversing with Data template (single KPI + chart support):  \n[Conversing with Data: Transforming Text into SQL Queries and Visual Curves](https://n8n.io/workflows/3497-conversing-with-data-transforming-text-into-sql-queries-and-visual-curves)\n\n&gt; I used this version for over 3 months and only spent **$0.80 total**, making it a great entry point if you're just getting started or on a limited budget.\n\n---\n\n## ğŸ“š More from the Same Creator\n\nLooking for a different kind of AI reporting workflow?\n\nExplore:  \n**Customer Feedback Analysis with AI, QuickChart & HTML Report Generator**  \nâ†’ Automatically analyze customer input and generate full reports with insights and charts.  \n[Customer Feedback Analysis with AI, QuickChart & HTML Report Generator](https://n8n.io/workflows/3642-customer-feedback-analysis-with-ai-quickchart-and-html-report-generator)\n",
  "featuredImage": "/data/workflows/3892/3892.webp",
  "author": {
    "id": 101,
    "slug": "hippolyte-hu",
    "name": "hippolyte-hu",
    "avatar": ""
  },
  "categories": [
    "Engineering",
    "AI RAG"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 968,
  "downloads": 96,
  "createdAt": "2025-05-06T09:56:26.479Z",
  "updatedAt": "2026-01-16T08:32:01.538Z",
  "publishedAt": "2025-05-06T09:56:26.479Z",
  "nodes": 21,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/3892"
}