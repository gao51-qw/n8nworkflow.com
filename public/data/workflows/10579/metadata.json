{
  "id": 10579,
  "slug": "10579",
  "title": "Conversational VK bot with GPT-4 mini & Whisper voice transcription",
  "description": "### How it works\n\nThis workflow powers an intelligent, conversational AI bot for VK that can understand and respond to both **text and voice messages**. The bot uses an AI agent with built-in memory, allowing it to remember the conversation history for each unique user (or in each chat) and answer follow-up questions. It's a complete solution for creating an engaging, automated assistant within your VK group.\n\n### Step-by-step\n\n  * **VK Webhook (Trigger):** The workflow starts when the **Webhook** node receives a new message from your VK group.\n  * **Duplicate Filtering:** The data immediately passes through the **Filter Dubles** node, which checks for the `x-retry-counter` header. This is a crucial step to prevent processing duplicate retry requests sent by the VK API.\n  * **Voice or Text Routing:** A **Voice/Text** (Switch) node checks if the message contains text (`message.text`) or a voice attachment (`audio_message.link_mp3`).\n  * **Voice Transcription:** If it's a voice note, the **Get URL** (HTTP Request) node downloads the audio file. The file is then passed to the **Transcribe** (OpenAI) node, which uses the Whisper model to convert the audio to text.\n  * **Input Unification:** Both the original text (from the 'Text' path) and the newly transcribed text (from the 'Voice' path) are routed to the **Set Prompt** node. This node standardizes the input into a single `prompt` variable.\n  * **AI Agent Processing:** The `prompt` variable is passed to the **AI Agent**. This agent is powered by an **OpenAI Chat Model** and uses **Simple Memory** to retain conversation history, using the VK **`peer_id`** as the `sessionKey`. This allows it to maintain a separate history for both private messages and group chats.\n  * **Response Generation:** The successful AI response is passed to the **Send to VK** (HTTP Request) node, which sends the message back to the user.\n  * **Error Handling:** The **AI Agent** node has error handling enabled (`onError`). If it fails, the flow is redirected to the **Error** (HTTP Request) node, which sends a fallback message to the user.\n\n### Set up steps\n\nEstimated set up time: 10 minutes\n\n1.  Add your OpenAI credentials to the **OpenAI Chat Model** and **Transcribe** nodes.\n2.  Add your VK group's API Bearer Token credentials to the two **HTTP Request** nodes named **Send to VK** and **Error**.\n3.  **Webhook Setup (Important\\!):** This is a two-stage process: confirmation and operation.\n      * Copy the **Production Webhook URL** from the **Webhook** node.\n      * **Stage A: Confirm Address (One-time)**\n          * In the **Webhook** node settings, set `Response Mode` to `On Received`.\n          * In `Options` -\\&gt; `Response Data`, temporarily paste the confirmation string that VK provides.\n          * Activate the workflow (toggle \"Active\" in the top-right).\n          * Paste the URL into your VK group's Callback API settings (Management -\\&gt; API -\\&gt; Callback API) and click \"Confirm\".\n      * **Stage B: Operational Mode (Permanent)**\n          * Return to the **Webhook** node.\n          * Set `Response Mode` to **`Immediate`**.\n          * In `Options` -\\&gt; `Response Data`, type the word **`ok`** (lowercase).\n          * Save and reactivate the workflow. The bot is now live.\n4.  (Optional) Customize the system prompt in the **AI Agent** node to define your bot's name and personality.",
  "featuredImage": "/data/workflows/10579/10579.webp",
  "author": {
    "id": 101,
    "slug": "zzsnowballzz",
    "name": "Konstantin",
    "avatar": ""
  },
  "categories": [
    "Support Chatbot",
    "AI Chatbot"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 145,
  "downloads": 14,
  "createdAt": "2025-11-06T23:52:26.778Z",
  "updatedAt": "2026-01-16T09:05:34.738Z",
  "publishedAt": "2025-11-06T23:52:26.778Z",
  "nodes": 17,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/10579"
}