{
  "workflow": {
    "id": 6221,
    "name": "Manage Stripe data using natural language with Kimi K2 via OpenRouter",
    "views": 380,
    "recentViews": 0,
    "totalViews": 380,
    "createdAt": "2025-07-21T10:25:09.277Z",
    "description": "Elevate your Stripe workflows with an AI agent that intelligently, securely, and interactively handles essential Stripe data operations. Leveraging the Kimi K2 model via OpenRouter, this n8n template enables safe data retrieval. From fetching summarized financial insights to managing customer discounts, while strictly enforcing privacy, concise outputs, and operational boundaries.\n\n---\n\n## üßæ Requirements\n\n**Stripe:**\n- Active Stripe account\n- API key with read and write access.\n\n**n8n:**\n- Deployed n8n instance (cloud or self-hosted)\n\n**OpenRouter:**\n- Active OpenRouter account with credit\n- API key from OpenRouter\n\n---\n\n## üîó Useful Links\n\n- [Stripe](https://stripe.com)\n- [n8n Stripe Credentials Setup](https://docs.n8n.io/integrations/builtin/credentials/stripe/)\n- [OpenRouter](https://openrouter.ai/)\n\n---\n\n## üö¶ Workflow Breakdown\n\n1. **Trigger: User Request**\n   - Workflow initiates when an authenticated user sends a message in the chat trigger.\n\n2. **AI Agent (Kimi K2 OpenRouter): Intent Analysis**\n   - Determines whether the user wants to:\n     - List customers, charges, or coupons\n     - Retrieve the account‚Äôs balance\n     - Create a new coupon in Stripe\n   - Filters unsupported or unclear requests, explaining permissions or terminology as needed.\n\n3. **Stripe Data Retrieval**\n   - For data queries:\n     - Only returns summarized, masked lists (e.g., last 10 transactions/customers)\n     - Sensitive details, such as card numbers, are automatically masked or truncated\n     - Never exposes or logs confidential information\n\n4. **Coupon Creation**\n   - When a coupon creation is requested:\n     - AI agent collects coupon parameters (discount, expiration, restrictions)\n     - Clearly summarizes the action and **requires explicit user confirmation** before proceeding\n     - Creates the coupon upon confirmation and replies with only the public-safe coupon details\n\n---\n\n## üõ°Ô∏è Privacy & Security\n\n- **No data storage:** All responses are ephemeral; sensitive Stripe data is never retained.\n- **Strict minimization:** Outputs are tightly scoped; only partial identifiers are shown and only when necessary.\n- **Retention rules enforced:** No logs, exports, or secondary storage of Stripe data.\n- **Confirmation required:** Actions modifying Stripe (like coupon creation) always require the user to approve before execution.\n- **Compliance-ready:** Aligned with Stripe and general data protection standards.\n\n---\n\n## ‚è±Ô∏è Setup Steps\n\n- Setup time: 10‚Äì15 minutes\n- Add Stripe API credentials in n8n\n- Add the OpenRouter API credentials in n8n and select your desired AI model to run the agent. In our template we selected Kimi K2 from Moonshot AI.\n\n---\n\n## ‚úÖ Summary\n\nThis workflow template connects a privacy-prioritized AI agent (Kimi K2 via OpenRouter) with your Stripe account to enable:\n- Fast, summarized access to customer, transaction, coupon, and balance data\n- Secure, confirmed creation of discounts/coupons\n- Complete adherence to authorization, privacy, and operational best practices\n\n---\n\n## üôã‚Äç‚ôÇÔ∏è Need Help?\n\nFeel free to contact us at [1 Node](https://1node.ai)\nGet instant access to a library of [free resources](https://1node.ai/resources) we created.\n",
    "workflow": {
      "id": "lc8NKe6V14iG51T4",
      "meta": {
        "instanceId": "9219ebc7795bea866f70aa3d977d54417fdf06c41944be95e20cfb60f992db19",
        "templateCredsSetupCompleted": true
      },
      "name": "Access Stripe data in natural language with Kimi K2 via OpenRouter",
      "tags": [],
      "nodes": [
        {
          "id": "fc80d268-934e-4bb7-a854-0483732bfb34",
          "name": "AI Agent",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "position": [
            -48,
            -112
          ],
          "parameters": {
            "options": {
              "systemMessage": "=You are an AI agent with authorized access to a defined set of Stripe tools. Your core objective is to understand and respond to user queries by securely interacting with Stripe's API, enabling read and write operations in accordance with their requests and permissions.\n\nTool Access and Capabilities\nRead Data Capabilities\nYou can retrieve the following information from Stripe:\nCustomers: Access and list multiple customer records.\nCharges: Retrieve and list multiple charge transactions.\nCoupons: Get lists of existing coupons.\nBalance: Obtain the current balance details.\n\nWrite Data Capabilities\nYou are authorized to:\nCreate Coupons: Generate new coupons within the Stripe system.\n\nStrictly follow these rules:\n\nNever access or attempt to retrieve data outside of the above abilities.\nAlways confirm actions (especially when creating coupons) and provide users with a summary of the resulting Stripe operation.\nClearly explain any Stripe terminology or usage as needed.\nReject and inform users if they request actions beyond your tool permissions.\nYour responses must be concise, accurate, and tailored to the user's intent regarding Stripe operations. \nUse Stripe data responsibly and in line with best practices for financial data access."
            }
          },
          "typeVersion": 2
        },
        {
          "id": "0dc1fc15-7958-4f01-be6d-bed3946d60c9",
          "name": "OpenRouter Chat Model",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
          "position": [
            -64,
            112
          ],
          "parameters": {
            "model": "moonshotai/kimi-k2",
            "options": {}
          },
          "credentials": {
            "openRouterApi": {
              "id": "credential-id",
              "name": "openRouterApi Credential"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "6edc5f19-be6c-4842-b69d-efc7bb46ad7f",
          "name": "When chat message received",
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "position": [
            -256,
            -112
          ],
          "webhookId": "ee12c9ab-62ac-4e5a-b657-4677bcfcf6d0",
          "parameters": {
            "options": {}
          },
          "typeVersion": 1.1
        },
        {
          "id": "8f520f8d-5085-420a-907f-65958f4ca843",
          "name": "Simple Memory",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "position": [
            80,
            112
          ],
          "parameters": {
            "contextWindowLength": 20
          },
          "typeVersion": 1.3
        },
        {
          "id": "08695c48-3f6d-404d-acca-d799708f101b",
          "name": "Create a coupon in Stripe",
          "type": "n8n-nodes-base.stripeTool",
          "position": [
            320,
            368
          ],
          "parameters": {
            "resource": "coupon",
            "percentOff": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Percent_Off', ``, 'number') }}"
          },
          "credentials": {
            "stripeApi": {
              "id": "credential-id",
              "name": "stripeApi Credential"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "c37f6b38-638b-46f6-a8d9-3ff526a7599b",
          "name": "Get a balance in Stripe",
          "type": "n8n-nodes-base.stripeTool",
          "position": [
            816,
            96
          ],
          "parameters": {},
          "credentials": {
            "stripeApi": {
              "id": "credential-id",
              "name": "stripeApi Credential"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "1adee53c-0f39-44cb-b2c6-83779340bb0b",
          "name": "Get many charges in Stripe",
          "type": "n8n-nodes-base.stripeTool",
          "position": [
            496,
            96
          ],
          "parameters": {
            "limit": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}",
            "resource": "charge",
            "operation": "getAll"
          },
          "credentials": {
            "stripeApi": {
              "id": "credential-id",
              "name": "stripeApi Credential"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "b9c48bc6-a79a-4e2b-bb2f-23837bd936af",
          "name": "Get many coupons in Stripe",
          "type": "n8n-nodes-base.stripeTool",
          "position": [
            672,
            96
          ],
          "parameters": {
            "limit": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}",
            "resource": "coupon",
            "operation": "getAll"
          },
          "credentials": {
            "stripeApi": {
              "id": "credential-id",
              "name": "stripeApi Credential"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "94ce8cf5-c2cf-4cb5-8a05-2a72c8011213",
          "name": "Sticky Note",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            256,
            -32
          ],
          "parameters": {
            "width": 688,
            "height": 304,
            "content": "## Read data\n"
          },
          "typeVersion": 1
        },
        {
          "id": "5f79a25d-eab2-452d-ac07-8ccf3778ac2c",
          "name": "Sticky Note1",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            256,
            288
          ],
          "parameters": {
            "width": 224,
            "height": 256,
            "content": "## Write data"
          },
          "typeVersion": 1
        },
        {
          "id": "4f9598f9-3e48-4979-a1f5-8c64b5c7b44c",
          "name": "Get many customers in Stripe",
          "type": "n8n-nodes-base.stripeTool",
          "position": [
            320,
            96
          ],
          "parameters": {
            "limit": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Limit', ``, 'number') }}",
            "filters": {},
            "resource": "customer",
            "operation": "getAll"
          },
          "credentials": {
            "stripeApi": {
              "id": "credential-id",
              "name": "stripeApi Credential"
            }
          },
          "typeVersion": 1
        },
        {
          "id": "1cfd5b2f-36d7-42c8-ba67-0d2906d0bd93",
          "name": "Sticky Note2",
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -624,
            96
          ],
          "parameters": {
            "color": 5,
            "width": 464,
            "height": 192,
            "content": "## Requirements\n\n- An **Stripe** account and API key credentials enabled. n8n docs: https://docs.n8n.io/integrations/builtin/credentials/stripe/ \n- An **[OpenRouter](https://openrouter.ai)** account and API credentials enabled. Set up an API key at https://openrouter.ai/settings/keys "
          },
          "typeVersion": 1
        }
      ],
      "active": false,
      "pinData": {},
      "settings": {
        "executionOrder": "v1"
      },
      "versionId": "58807a0c-a099-4d5f-9722-3bfce4363f80",
      "connections": {
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "OpenRouter Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Get a balance in Stripe": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Create a coupon in Stripe": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Get many charges in Stripe": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Get many coupons in Stripe": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many customers in Stripe": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      }
    },
    "lastUpdatedBy": 29,
    "workflowInfo": {
      "nodeCount": 12,
      "nodeTypes": {
        "n8n-nodes-base.stickyNote": {
          "count": 3
        },
        "n8n-nodes-base.stripeTool": {
          "count": 5
        },
        "@n8n/n8n-nodes-langchain.agent": {
          "count": 1
        },
        "@n8n/n8n-nodes-langchain.chatTrigger": {
          "count": 1
        },
        "@n8n/n8n-nodes-langchain.lmChatOpenRouter": {
          "count": 1
        },
        "@n8n/n8n-nodes-langchain.memoryBufferWindow": {
          "count": 1
        }
      }
    },
    "status": "published",
    "user": {
      "name": "Aitor | 1Node",
      "username": "aitoralonso",
      "bio": "Hi, I'm Aitor with 1 Node. We create practical AI solutions for businesses. Nothing fancy, just tools that solve real problems and help you scale. Always happy to have a conversation about how we might be able to help you grow",
      "verified": true,
      "links": [
        "https://1node.ai"
      ],
      "avatar": "https://gravatar.com/avatar/2f850f7b4c218087a3e7d9775daf6bd8dad05b5eb5ea82242d4bfd1a97465455?r=pg&d=retro&size=200"
    },
    "nodes": [
      {
        "id": 565,
        "icon": "fa:sticky-note",
        "name": "n8n-nodes-base.stickyNote",
        "codex": {
          "data": {
            "alias": [
              "Comments",
              "Notes",
              "Sticky"
            ],
            "categories": [
              "Core Nodes"
            ],
            "nodeVersion": "1.0",
            "codexVersion": "1.0",
            "subcategories": {
              "Core Nodes": [
                "Helpers"
              ]
            }
          }
        },
        "group": "[\"input\"]",
        "defaults": {
          "name": "Sticky Note",
          "color": "#FFD233"
        },
        "iconData": {
          "icon": "sticky-note",
          "type": "icon"
        },
        "displayName": "Sticky Note",
        "typeVersion": 1,
        "nodeCategories": [
          {
            "id": 9,
            "name": "Core Nodes"
          }
        ]
      },
      {
        "id": 1119,
        "icon": "fa:robot",
        "name": "@n8n/n8n-nodes-langchain.agent",
        "codex": {
          "data": {
            "alias": [
              "LangChain",
              "Chat",
              "Conversational",
              "Plan and Execute",
              "ReAct",
              "Tools"
            ],
            "resources": {
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent/"
                }
              ]
            },
            "categories": [
              "AI",
              "Langchain"
            ],
            "subcategories": {
              "AI": [
                "Agents",
                "Root Nodes"
              ]
            }
          }
        },
        "group": "[\"transform\"]",
        "defaults": {
          "name": "AI Agent",
          "color": "#404040"
        },
        "iconData": {
          "icon": "robot",
          "type": "icon"
        },
        "displayName": "AI Agent",
        "typeVersion": 3,
        "nodeCategories": [
          {
            "id": 25,
            "name": "AI"
          },
          {
            "id": 26,
            "name": "Langchain"
          }
        ]
      },
      {
        "id": 1163,
        "icon": "fa:database",
        "name": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "codex": {
          "data": {
            "resources": {
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.memorybufferwindow/"
                }
              ]
            },
            "categories": [
              "AI",
              "Langchain"
            ],
            "subcategories": {
              "AI": [
                "Memory"
              ],
              "Memory": [
                "For beginners"
              ]
            }
          }
        },
        "group": "[\"transform\"]",
        "defaults": {
          "name": "Simple Memory"
        },
        "iconData": {
          "icon": "database",
          "type": "icon"
        },
        "displayName": "Simple Memory",
        "typeVersion": 1,
        "nodeCategories": [
          {
            "id": 25,
            "name": "AI"
          },
          {
            "id": 26,
            "name": "Langchain"
          }
        ]
      },
      {
        "id": 1247,
        "icon": "fa:comments",
        "name": "@n8n/n8n-nodes-langchain.chatTrigger",
        "codex": {
          "data": {
            "resources": {
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-langchain.chattrigger/"
                }
              ]
            },
            "categories": [
              "Core Nodes",
              "Langchain"
            ]
          }
        },
        "group": "[\"trigger\"]",
        "defaults": {
          "name": "When chat message received"
        },
        "iconData": {
          "icon": "comments",
          "type": "icon"
        },
        "displayName": "Chat Trigger",
        "typeVersion": 1,
        "nodeCategories": [
          {
            "id": 9,
            "name": "Core Nodes"
          },
          {
            "id": 26,
            "name": "Langchain"
          }
        ]
      },
      {
        "id": 1281,
        "icon": "file:openrouter.svg",
        "name": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "codex": {
          "data": {
            "resources": {
              "primaryDocumentation": [
                {
                  "url": "https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.lmchatopenrouter/"
                }
              ]
            },
            "categories": [
              "AI",
              "Langchain"
            ],
            "subcategories": {
              "AI": [
                "Language Models",
                "Root Nodes"
              ],
              "Language Models": [
                "Chat Models (Recommended)"
              ]
            }
          }
        },
        "group": "[\"transform\"]",
        "defaults": {
          "name": "OpenRouter Chat Model"
        },
        "iconData": {
          "type": "file",
          "fileBuffer": "data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjOTRBM0I4IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDI0IDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjx0aXRsZT5PcGVuUm91dGVyPC90aXRsZT48cGF0aCBkPSJNMTYuODA0IDEuOTU3bDcuMjIgNC4xMDV2LjA4N0wxNi43MyAxMC4yMWwuMDE3LTIuMTE3LS44MjEtLjAzYy0xLjA1OS0uMDI4LTEuNjExLjAwMi0yLjI2OC4xMS0xLjA2NC4xNzUtMi4wMzguNTc3LTMuMTQ3IDEuMzUyTDguMzQ1IDExLjAzYy0uMjg0LjE5NS0uNDk1LjMzNi0uNjguNDU1bC0uNTE1LjMyMi0uMzk3LjIzNC4zODUuMjMuNTMuMzM4Yy40NzYuMzE0IDEuMTcuNzk2IDIuNzAxIDEuODY2IDEuMTEuNzc1IDIuMDgzIDEuMTc3IDMuMTQ3IDEuMzUybC4zLjA0NWMuNjk0LjA5MSAxLjM3NS4wOTQgMi44MjUuMDMzbC4wMjItMi4xNTkgNy4yMiA0LjEwNXYuMDg3TDE2LjU4OSAyMmwuMDE0LTEuODYyLS42MzUuMDIyYy0xLjM4Ni4wNDItMi4xMzcuMDAyLTMuMTM4LS4xNjItMS42OTQtLjI4LTMuMjYtLjkyNi00Ljg4MS0yLjA1OWwtMi4xNTgtMS41YTIxLjk5NyAyMS45OTcgMCAwMC0uNzU1LS40OThsLS40NjctLjI4YTU1LjkyNyA1NS45MjcgMCAwMC0uNzYtLjQzQzIuOTA4IDE0LjczLjU2MyAxNC4xMTYgMCAxNC4xMTZWOS44ODhsLjE0LjAwNGMuNTY0LS4wMDcgMi45MS0uNjIyIDMuODA5LTEuMTI0bDEuMDE2LS41OC40MzgtLjI3NGMuNDI4LS4yOCAxLjA3Mi0uNzI2IDIuNjg2LTEuODUzIDEuNjIxLTEuMTMzIDMuMTg2LTEuNzggNC44ODEtMi4wNTkgMS4xNTItLjE5IDEuOTc0LS4yMTMgMy44MTQtLjEzOGwuMDItMS45MDd6Ij48L3BhdGg+PC9zdmc+Cg=="
        },
        "displayName": "OpenRouter Chat Model",
        "typeVersion": 1,
        "nodeCategories": [
          {
            "id": 25,
            "name": "AI"
          },
          {
            "id": 26,
            "name": "Langchain"
          }
        ]
      }
    ],
    "categories": [
      {
        "id": 39,
        "name": "CRM"
      },
      {
        "id": 47,
        "name": "AI Chatbot"
      }
    ],
    "image": []
  }
}