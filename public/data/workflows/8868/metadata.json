{
  "id": 8868,
  "slug": "8868",
  "title": "Extract structured data from D&B company reports with GPT-4o",
  "description": "\nPull a **Dun & Bradstreet Business Information Report** (PDF) by DUNS, convert the response into a binary **PDF file**, extract readable text, and use **OpenAI** to return a **clean, flat JSON** with only the key fields you care about (e.g., report date, Paydex, viability score, credit limit). Includes Sticky Notes for quick setup help and guidance.\n\n---\n\n## ‚úÖ What this template does\n- **Requests a D&B report** (PDF) for a specific **DUNS** via HTTP  \n- **Converts** the API response into a **binary PDF file**  \n- **Extracts** the text from the PDF for analysis  \n- Uses **OpenAI** with a **Structured Output Parser** to return a **flat JSON**  \n- Designed to be extended to Sheets, databases, or CRMs\n\n---\n\n## üß© How it works (node-by-node)\n1. **Manual Trigger** ‚Äî Runs the workflow on demand (\"When clicking 'Execute workflow'\").\n2. **D&B Report (HTTP Request)** ‚Äî Calls the D&B Reports API for a Business Information Report (PDF).\n3. **Convert to PDF File (Convert to File)** ‚Äî Turns the D&B response payload into a binary **PDF**.\n4. **Extract Binary (Extract from File)** ‚Äî Extracts text content from the PDF.\n5. **OpenAI Chat Model** ‚Äî Provides the language model context for the analyzer.\n6. **Analyze PDF (AI Agent)** ‚Äî Reads the extracted text and applies strict rules for a flat JSON output.\n7. **Structured Output (AI Structured Output Parser)** ‚Äî Enforces a schema and validates/auto-fixes the JSON shape.\n8. *(Optional)* **Get Bearer Token (HTTP Request)** ‚Äî Template guidance for OAuth token retrieval (shown as disabled; included for reference if you prefer Bearer flows).\n\n---\n\n## üõ†Ô∏è Setup instructions (from the JSON)\n\n### 1) D&B Report (HTTP Request)\n- **Auth:** Header Auth (use an n8n **HTTP Header Auth** credential)  \n- **URL:**  \nhttps://plus.dnb.com/v1/reports/duns/804735132?productId=birstd&inLanguage=en-US&reportFormat=PDF&orderReason=6332&tradeUp=hq&customerReference=customer%20reference%20text\n\n- **Headers:**\n  - `Accept: application/json`\n- **Credential Example:** `D&B` (HTTP Header Auth)  \n  &gt; Put your `Authorization: Bearer &lt;token&gt;` header inside this credential, not directly in the node.\n\n### 2) Convert to PDF File (Convert to File)\n- **Operation:** `toBinary`  \n- **Source Property:** `contents[0].contentObject`  \n  &gt; This takes the PDF content from the D&B API response and converts it to a binary file for downstream nodes.\n\n### 3) Extract Binary (Extract from File)\n- **Operation:** `pdf`  \n  &gt; Produces a `text` field with the extracted PDF content, ready for AI analysis.\n\n### 4) OpenAI Model(s)\n- **OpenAI Chat Model**  \n- **Model:** `gpt-4o` (as configured in the JSON)  \n- **Credential:** Your stored **OpenAI API** credential (do **not** hardcode keys)\n- **Wiring:**  \n  - Connect **OpenAI Chat Model** as `ai_languageModel` to **Analyze PDF**  \n  - Connect another **OpenAI Chat Model** (also `gpt-4o`) as `ai_languageModel` to **Structured Output**\n\n### 5) Analyze PDF (AI Agent)\n- **Prompt Type:** `define`  \n- **Text:**  \n  `={{ $json.text }}`\n- **System Message (rules):**  \n  - You are a precision extractor. Read the provided business report PDF and return only a single flat JSON object with the fields below.  \n  - No arrays/lists.  \n  - No prose.  \n  - If a value is missing, output null.  \n  - Dates: `YYYY-MM-DD`.  \n  - Numbers: plain numerics (no commas or $).  \n  - Prefer most recent or highest-level overall values if multiple are shown.  \n  - Never include arrays, nested structures, or text outside of the JSON object.\n\n### 6) Structured Output (AI Structured Output Parser)\n- **JSON Schema Example:**\n```json\n{\n  \"report_date\": \"\",\n  \"company_name\": \"\",\n  \"duns\": \"\",\n  \"dnb_rating_overall\": \"\",\n  \"composite_credit_appraisal\": \"\",\n  \"viability_score\": \"\",\n  \"portfolio_comparison_score\": \"\",\n  \"paydex_3mo\": \"\",\n  \"paydex_24mo\": \"\",\n  \"credit_limit_conservative\": \"\"\n}\n```\n- **Auto Fix:** enabled\n- **Wiring:** Connect as `ai_outputParser` to **Analyze PDF**\n\n### 7) (Optional) Get Bearer Token (HTTP Request) ‚Äî Disabled example\nIf you prefer fetching tokens dynamically:\n- **Auth:** Basic Auth (D&B username/password)\n- **Method:** POST\n- **URL:** https://plus.dnb.com/v3/token\n- **Body Parameters:**\n  - `grant_type = client_credentials`\n- **Headers:**\n  - `Accept: application/json`\n- **Downstream usage:** Set header `Authorization: Bearer {{$json[\"access_token\"]}}` in subsequent calls.\n\n&gt; In this template, the D&B Report node uses Header Auth credential instead. Use one strategy consistently (credentials are recommended for security).\n\n---\n\n## üß† Output schema (flat JSON)\nThe analyzer + parser return a single flat object like:\n\n```json\n{\n  \"report_date\": \"2024-12-31\",\n  \"company_name\": \"Example Corp\",\n  \"duns\": \"123456789\",\n  \"dnb_rating_overall\": \"5A2\",\n  \"composite_credit_appraisal\": \"Fair\",\n  \"viability_score\": \"3\",\n  \"portfolio_comparison_score\": \"2\",\n  \"paydex_3mo\": \"80\",\n  \"paydex_24mo\": \"78\",\n  \"credit_limit_conservative\": \"25000\"\n}\n```\n\n---\n\n## üß™ Test flow\n1. Click **Execute workflow** (Manual Trigger).\n2. Confirm **D&B Report** returns the PDF response.\n3. Check **Convert to PDF File** for a binary file.\n4. Verify **Extract from File** produces a `text` field.\n5. Inspect **Analyze PDF** ‚Üí **Structured Output** for valid JSON.\n\n---\n\n## üîê Security notes\n- Do not hardcode tokens in nodes; use **Credentials** (HTTP Header Auth or Basic Auth).\n- Restrict who can execute the workflow if it's accessible from outside your network.\n- Avoid storing sensitive payloads in logs; mask tokens/headers.\n\n---\n\n## üß© Customize\n- Map the structured JSON to **Google Sheets**, **Postgres/BigQuery**, or a **CRM**.\n- Extend the schema with additional fields (e.g., number of employees, HQ address) ‚Äî keep it **flat**.\n- Add validation (**Set/IF** nodes) to ensure required fields exist before writing downstream.\n\n---\n\n## ü©π Troubleshooting\n- **Missing PDF text?** Ensure **Convert to File** source property is `contents[0].contentObject`.\n- **Unauthorized from D&B?** Refresh/verify token; confirm Header Auth credential contains `Authorization: Bearer &lt;token&gt;`.\n- **Parser errors?** Keep the agent output short and flat; the Structured Output node will auto-fix minor issues.\n- **Different DUNS/product?** Update the D&B Report URL query params (`duns`, `productId`, etc.).\n\n---\n\n## üóíÔ∏è Sticky Notes (included)\n- **Overview:** \"Fetch D&B Company Report (PDF) ‚Üí Convert ‚Üí Extract ‚Üí Summarize to Structured JSON (n8n)\"\n- Setup snippets for Data Blocks (optional) and Auth flow\n\n---\n\n## üì¨ Contact\nNeed help customizing this (e.g., routing the PDF to Drive, mapping JSON to your CRM, or expanding the schema)?\n\nüìß robert@ynteractive.com  \nüîó https://www.linkedin.com/in/robert-breen-29429625/  \nüåê https://ynteractive.com",
  "featuredImage": "/data/workflows/8868/8868.webp",
  "author": {
    "id": 101,
    "slug": "rbreen",
    "name": "Robert Breen",
    "avatar": ""
  },
  "categories": [
    "Document Extraction",
    "AI Summarization"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 166,
  "downloads": 16,
  "createdAt": "2025-09-23T13:23:03.531Z",
  "updatedAt": "2026-01-16T08:58:05.415Z",
  "publishedAt": "2025-09-23T13:23:03.531Z",
  "nodes": 11,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/8868"
}