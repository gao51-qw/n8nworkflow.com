{
  "id": 7712,
  "slug": "7712",
  "title": "Automated WhatsApp lead nurturing with personalized messages via Postgres & Gallabox",
  "description": "# n8n Workflow: WhatsApp Lead Nurturing (MQL)\n\n## üîÑ Purpose\nThis workflow **fetches unqualified leads** from Postgres at defined retry intervals, sends **personalized WhatsApp template messages** via Gallabox API, and **logs message activity** while updating lead status in the database.\n\n---\n\n## üß© Workflow Structure\n\n1. **Schedule Trigger**\n   - Type: `n8n-nodes-base.scheduleTrigger`\n   - Runs the workflow automatically at set intervals (seconds-based).\n   - Entry point of the workflow.\n\n2. **Execute a SQL query**\n   - Type: `n8n-nodes-base.postgres`\n   - Fetches leads from `mql_contacts` that:\n     - Have `count` = 0, 1, 2, or 3.\n     - Respect time delays:  \n       - `count=1` ‚Üí after 3 minutes  \n       - `count=2` ‚Üí after 5 minutes  \n       - `count=3` ‚Üí after 8 minutes  \n     - Must have `disposition = unqualified`.\n\n3. **Loop Over Items4**\n   - Type: `n8n-nodes-base.splitInBatches`\n   - Iterates over each lead individually.\n   - Ensures one-by-one processing.\n\n4. **Code1**\n   - Type: `n8n-nodes-base.code`\n   - Selects message content based on:\n     - Lead‚Äôs **model** (`nexus`, `magnus`, `reo`, `general`).\n     - Current **count** (0‚Äì3).\n   - Ensures personalized, varied message text.\n\n5. **new_lead_4**\n   - Type: `n8n-nodes-base.httpRequest`\n   - Sends WhatsApp template message through Gallabox API.\n   - Dynamic fields:\n     - Lead‚Äôs **name** and **phone**.\n     - **Message details** selected from Code1.\n     - Quick reply buttons: *Show Brochure*, *Get Showroom Location*, *Not Interested*.\n\n6. **Insert rows in a table4**\n   - Type: `n8n-nodes-base.postgres`\n   - Inserts a record into `mql_logs`.\n   - Captures:\n     - Phone, name, disposition.\n     - Message count, message_id, timestamps.\n     - Gallabox API response (status, code).\n\n7. **Update rows in a table4**\n   - Type: `n8n-nodes-base.postgres`\n   - Updates `mql_contacts`:\n     - Increments **count** by 1.\n     - Updates **last_message_sent** timestamp.\n     - Matches using phone number.\n\n8. **Sticky Notes**\n   - Provide inline documentation:\n     - SQL query purpose.\n     - Message matrix explanation.\n     - Gallabox API role.\n     - Postgres update/logging details.\n\n---\n\n## ‚öôÔ∏è Data Flow Summary\n\n- **Trigger** ‚Üí Runs every X seconds  \n- **SQL Query** ‚Üí Fetches eligible leads (unqualified, retry intervals)  \n- **Loop** ‚Üí Processes each lead sequentially  \n- **Code1** ‚Üí Chooses personalized message based on model & count  \n- **HTTP Request** ‚Üí Sends WhatsApp template via Gallabox  \n- **Insert Log** ‚Üí Stores activity in `mql_logs`  \n- **Update Contact** ‚Üí Updates count & last sent in `mql_contacts`  \n- **Cycle repeats** until all leads are processed  \n\n---\n\n## üìä Use Case\n- Automates **WhatsApp drip campaigns** for unqualified leads.  \n- Respects retry intervals to avoid spamming.  \n- Uses **personalized message variations** based on product model & retry count.  \n- Provides full traceability with logs and lead updates.  \n",
  "featuredImage": "/data/workflows/7712/7712.webp",
  "author": {
    "id": 101,
    "slug": "rahiuppal",
    "name": "Rahi Uppal",
    "avatar": ""
  },
  "categories": [
    "Lead Nurturing",
    "Multimodal AI"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 188,
  "downloads": 18,
  "createdAt": "2025-08-21T16:54:02.779Z",
  "updatedAt": "2026-01-16T08:51:57.734Z",
  "publishedAt": "2025-08-21T16:54:02.779Z",
  "nodes": 11,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/7712"
}