{
  "id": 11648,
  "slug": "11648",
  "title": "AI WhatsApp support with human handoff using Gemini, Twilio, and Supabase RAG",
  "description": "# Quick Overview\nWhat it is: An n8n workflow that enables AI-first WhatsApp support with seamless human handoff.\nWhy it’s unique: The AI agent answers queries using RAG (Supabase vector store + Gemini). If a human intervenes, the AI steps down. If there’s no human reply within 2 hours, the AI resumes.\nChannel constraints: Respects WhatsApp’s 24-hour customer care window and requires approved message templates for out-of-window messages.\n# How It Works\nAI-first: Incoming WhatsApp messages are routed to an AI agent (Gemini) with knowledge grounded by a Supabase vector store.\n**Human-in-the-loop**: When a human responds in the dashboard, AI pauses for 2 hours for that conversation.\n**Auto-resume**: If no human reply within 2 hours, AI automatically resumes.\n**Compliance**: Only responds within 24 hours of the user’s last message, or via approved templates when outside this window.\n### Architecture (At a Glance)\nTransport: Twilio WhatsApp; n8n http node.\nRAG: Supabase (Postgres + embeddings) stores knowledgebase.\nLLM: Google Gemini (free API key supported).\nHandoff: Human dashboard (GitHub project) logs and labels AI vs Human responses, and controls AI pause/resume.\n**Prerequisites**\nn8n (self-hosted or cloud) with public webhook access.\nTwilio account with a WhatsApp-enabled number.\nSupabase project for vector store.\nGoogle Gemini API key.\nHuman dashboard: https://github.com/shadrack-ago/whatsapp-dashboard.git\nSetup Steps (n8n + Integrations)\nImport workflow in n8n\nCreate new workflow → Import from JSON → Paste the provided JSON.\nEnable the workflow.\nCreate credentials\nTwilio: Add TWILIO_ACCOUNT_SID, TWILIO_AUTH_TOKEN, TWILIO_PHONE_NUMBER. Do NOT paste real secrets publicly.\nGemini: Add GEMINI_API_KEY.\nSupabase: Add SUPABASE_URL, SUPABASE_ANON_KEY (or service role where needed), and your table/bucket names.\nConnect Twilio WhatsApp\nWhatsApp Business setup in Twilio, or Sandbox for testing.\nPoint Twilio incoming webhook to your n8n webhook URL.\nEnsure approved templates for any out-of-window messaging.\nSet environment variables (examples)\nTWILIO_ACCOUNT_SID=...\nTWILIO_AUTH_TOKEN=...\nTWILIO_PHONE_NUMBER=+1...\nGEMINI_API_KEY=...\nSUPABASE_URL=...\nSUPABASE_ANON_KEY=...\nSUPABASE_TABLE=knowledge_base\nEMBEDDING_MODEL\nHUMAN_TIMEOUT_MS=7200000 (2 hours)\nHuman-in-the-loop dashboard\nFollow the repo guide: https://github.com/shadrack-ago/whatsapp-dashboard.git\nRun the dashboard and connect it to the same conversation store used by the workflow.\nVerify that human responses are captured and labeled; confirm AI pause/resume logic.\nSupabase for RAG\nCreate table(s) for documents and embeddings.\nIngest content per this tutorial:[Supabase Tutorial ](https://youtu.be/5uw1wE6niGc?si=hLd8m_PdcH4tts5m)\nConfirm your n8n nodes query the vector store before calling Gemini.\nGemini setup\nGet API key: [Gemini API](https://aistudio.google.com/api-keys)\nSet model (e.g., gemini-pro or latest available in your environment).\nTest\nSend a WhatsApp message to your Twilio number.\nObserve AI response.\nTrigger a human reply via the dashboard → confirm AI pauses for that thread.\nWait 2 hours or adjust HUMAN_TIMEOUT_MS to test auto-resume.\nCustomization\nProviders: You can swap Twilio for Meta’s WhatsApp Cloud API; keep the 24-hour and template rules.\nTone/Policies: Adjust system prompts and fallback behaviors in the LLM node.\nRAG Quality: Tune chunking, TOP_K, and embedding model for better retrieval.\nTimeouts: Change HUMAN_TIMEOUT_MS to alter handoff duration.\nWhatsApp Policy Notes\n24-hour window: Replies must occur within 24 hours of user’s last message; otherwise use an approved template.\nTemplates: Create and get approval inside Twilio/Meta before sending out-of-window messages.\nSecurity & Reliability\nSecrets: Store all keys in n8n credentials or environment variables. Never commit secrets to repos.\nLogging: Use the dashboard to audit AI vs Human messages.\nRate limits: Add retry/backoff nodes for Twilio and LLM calls.\nTroubleshooting\nNo replies: Check Twilio webhook URL and n8n workflow is active.\nPolicy blocks: Ensure template use outside 24-hour window.\nPoor answers: Improve RAG data, increase TOP_K, refine prompts.\nHandoff not pausing: Verify dashboard is writing the “human active” flag that the workflow reads.\nLinks\nHuman dashboard (Full guide): [GitHub Repo Link](https://github.com/shadrack-ago/whatsapp-dashboard.git)",
  "featuredImage": "/data/workflows/11648/11648.webp",
  "author": {
    "id": 101,
    "slug": "shadrack",
    "name": "Shadrack",
    "avatar": ""
  },
  "categories": [
    "Support Chatbot",
    "AI RAG"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 283,
  "downloads": 28,
  "createdAt": "2025-12-10T09:09:44.224Z",
  "updatedAt": "2026-01-16T09:09:30.574Z",
  "publishedAt": "2025-12-10T09:09:44.224Z",
  "nodes": 27,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/11648"
}