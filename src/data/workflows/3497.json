{
  "id": 3497,
  "slug": "3497",
  "title": "Conversing with data: transforming text into SQL queries and visual curves",
  "description": "# Conversational Data Retrieval and Visualization Workflow\n\nThis workflow enables users to interact with a PostgreSQL database using natural language. It translates text inputs into SQL queries, retrieves the corresponding data, and generates visualizations using QuickChart, facilitating seamless data analysis without manual query writing.\n\n## Table of Contents\n\n- [Pre-conditions and Requirements](#pre-conditions-and-requirements)\n- [Database Schema Setup](#database-schema-setup)\n- [Step-by-Step Workflow Explanation](#step-by-step-workflow-explanation)\n- [Customization Guide](#customization-guide)\n\n## Pre-conditions and Requirements\n\n### 1. API Keys and Services Required\n\nTo operate this workflow, access to the following services is necessary:\n\n- **DeepSeek API**: For converting natural language into SQL queries.\n  - *API Key*: Obtain from your DeepSeek account.\n- **QuickChart**: For generating data visualizations.\n  - *Service URL*: `https://quickchart.io/chart`\n\n### 2. n8n Instance Setup\n\n- **n8n Installation**: Install and run n8n using the [Official Guide](https://docs.n8n.io/getting-started/installation/).\n- **Credential Configuration**:\n  - *DeepSeek API*: Set up DeepSeek credentials in n8n by adding your API key.\n  - *PostgreSQL Database*:\n    - *Local Database Access*: If your PostgreSQL database is hosted locally and needs to be accessed over the internet (e.g., by n8n running on a different machine or in the cloud), you can expose it using ngrok:\n      1. **Install ngrok**: Download and install ngrok from [ngrok.com](https://ngrok.com/download).\n      2. **Start ngrok Tunnel**: Run the command `ngrok tcp 5432` to expose your local PostgreSQL server.\n         - This will provide a forwarding address like `tcp://0.tcp.ngrok.io:12345` that can be used to connect to your local database remotely.\n      3. **Update n8n Credentials**: In n8n, configure the PostgreSQL node to use the ngrok forwarding address, ensuring remote access to your local database.\n\n## Database Schema Setup\n\nBefore initiating the workflow, ensure that the database schema is extracted and saved:\n\n1. **Extract Schema**: Retrieve the database schema, including table names and column details.\n2. **Save Schema**: Store the extracted schema in a JSON file for reference during query generation.\n\n## Step-by-Step Workflow Explanation\n\n1. **User Input Handling**\n   - The workflow begins by receiving a natural language query from the user.\n\n2. **Schema Retrieval**\n   - Loads the previously saved database schema from the JSON file.\n\n3. **AI-Based SQL Generation**\n   - Combines the user's query with the database schema.\n   - Utilizes the DeepSeek API to translate the natural language query into a SQL statement.\n\n4. **SQL Query Execution**\n   - Executes the generated SQL query against the PostgreSQL database.\n   - Retrieves the data corresponding to the query.\n\n5. **Data Visualization**\n   - Formats the retrieved data into a structure compatible with QuickChart.\n   - Sends the data to QuickChart to generate a visual representation.\n     - *Example*: To create a bar chart, construct a URL with the chart configuration:\n       ```\n       https://quickchart.io/chart?c={type:'bar',data:{labels:['Label1','Label2'],datasets:[{label:'Dataset1',data:[10,20]}]}}\n       ```\n       This URL returns an image of the chart.\n\n6. **Response Delivery**\n   - Presents the generated visualizations and data insights to the user.\n\n## Customization Guide\n\n### Modifying the AI Model\n\n- **Alternative AI Services**: Replace DeepSeek with other AI models by adjusting the API call configurations in the workflow.\n\n### Changing Visualization Services\n\n- **Visualization Tools**: Swap QuickChart with other visualization services by modifying the data processing and visualization steps.\n\n### Expanding Database Support\n\n- **Additional Databases**: Adapt the workflow to support other databases (e.g., MySQL, MongoDB) by configuring the respective database credentials and query execution nodes.\n\n---\n\nThis workflow streamlines the process of data retrieval and visualization, allowing users to interact with their database using natural language, thereby enhancing accessibility and efficiency in data analysis.\n\n---\n",
  "featuredImage": "/data/workflows/3497/3497.webp",
  "author": {
    "id": 101,
    "slug": "hippolyte-hu",
    "name": "hippolyte-hu",
    "avatar": ""
  },
  "categories": [
    "Engineering",
    "AI Chatbot"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 3298,
  "downloads": 329,
  "createdAt": "2025-04-09T10:47:20.113Z",
  "updatedAt": "2026-01-16T08:30:02.130Z",
  "publishedAt": "2025-04-09T10:47:20.113Z",
  "nodes": 36,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/3497",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Conversing with data: transforming text into SQL queries and visual curves",
    "workflowName": "Conversing with data: transforming text into SQL queries and visual curves",
    "description": "# Conversational Data Retrieval and Visualization Workflow\n\nThis workflow enables users to interact with a PostgreSQL database using natural language. It translates text inputs into SQL queries, retrieves the corresponding data, and generates visualizations using QuickChart, facilitating seamless data analysis without manual query writing.\n\n## Table of Contents\n\n- [Pre-conditions and Requirements](#pre-conditions-and-requirements)\n- [Database Schema Setup](#database-schema-setup)\n- [Step-by-Step Workflow Explanation](#step-by-step-workflow-explanation)\n- [Customization Guide](#customization-guide)\n\n## Pre-conditions and Requirements\n\n### 1. API Keys and Services Required\n\nTo operate this workflow, access to the following services is necessary:\n\n- **DeepSeek API**: For converting natural language into SQL queries.\n  - *API Key*: Obtain from your DeepSeek account.\n- **QuickChart**: For generating data visualizations.\n  - *Service URL*: `https://quickchart.io/chart`\n\n### 2. n8n Instance Setup\n\n- **n8n Installation**: Install and run n8n using the [Official Guide](https://docs.n8n.io/getting-started/installation/).\n- **Credential Configuration**:\n  - *DeepSeek API*: Set up DeepSeek credentials in n8n by adding your API key.\n  - *PostgreSQL Database*:\n    - *Local Database Access*: If your PostgreSQL database is hosted locally and needs to be accessed over the internet (e.g., by n8n running on a different machine or in the cloud), you can expose it using ngrok:\n      1. **Install ngrok**: Download and install ngrok from [ngrok.com](https://ngrok.com/download).\n      2. **Start ngrok Tunnel**: Run the command `ngrok tcp 5432` to expose your local PostgreSQL server.\n         - This will provide a forwarding address like `tcp://0.tcp.ngrok.io:12345` that can be used to connect to your local database remotely.\n      3. **Update n8n Credentials**: In n8n, configure the PostgreSQL node to use the ngrok forwarding address, ensuring remote access to your local database.\n\n## Database Schema Setup\n\nBefore initiating the workflow, ensure that the database schema is extracted and saved:\n\n1. **Extract Schema**: Retrieve the database schema, including table names and column details.\n2. **Save Schema**: Store the extracted schema in a JSON file for reference during query generation.\n\n## Step-by-Step Workflow Explanation\n\n1. **User Input Handling**\n   - The workflow begins by receiving a natural language query from the user.\n\n2. **Schema Retrieval**\n   - Loads the previously saved database schema from the JSON file.\n\n3. **AI-Based SQL Generation**\n   - Combines the user's query with the database schema.\n   - Utilizes the DeepSeek API to translate the natural language query into a SQL statement.\n\n4. **SQL Query Execution**\n   - Executes the generated SQL query against the PostgreSQL database.\n   - Retrieves the data corresponding to the query.\n\n5. **Data Visualization**\n   - Formats the retrieved data into a structure compatible with QuickChart.\n   - Sends the data to QuickChart to generate a visual representation.\n     - *Example*: To create a bar chart, construct a URL with the chart configuration:\n       ```\n       https://quickchart.io/chart?c={type:'bar',data:{labels:['Label1','Label2'],datasets:[{label:'Dataset1',data:[10,20]}]}}\n       ```\n       This URL returns an image of the chart.\n\n6. **Response Delivery**\n   - Presents the generated visualizations and data insights to the user.\n\n## Customization Guide\n\n### Modifying the AI Model\n\n- **Alternative AI Services**: Replace DeepSeek with other AI models by adjusting the API call configurations in the workflow.\n\n### Changing Visualization Services\n\n- **Visualization Tools**: Swap QuickChart with other visualization services by modifying the data processing and visualization steps.\n\n### Expanding Database Support\n\n- **Additional Databases**: Adapt the workflow to support other databases (e.g., MySQL, MongoDB) by configuring the respective database credentials and query execution nodes.\n\n---\n\nThis workflow streamlines the process of data retrieval and visualization, allowing users to interact with their database using natural language, thereby enhancing accessibility and efficiency in data analysis.\n\n---",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "role": "memoryBufferWindow",
      "configDescription": "Version 1.2"
    },
    {
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "Add table name to output",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Save file locally",
      "type": "n8n-nodes-base.readWriteFile",
      "role": "readWriteFile",
      "configDescription": "Version 1"
    },
    {
      "name": "Extract data from file",
      "type": "n8n-nodes-base.extractFromFile",
      "role": "extractFromFile",
      "configDescription": "Version 1"
    },
    {
      "name": "Chat Trigger",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "role": "chatTrigger",
      "configDescription": "Version 1.1"
    },
    {
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.6"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "When clicking \"Test workflow\"",
      "type": "n8n-nodes-base.manualTrigger",
      "role": "manualTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Combine schema data and chat input",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Load the schema from the local file",
      "type": "n8n-nodes-base.readWriteFile",
      "role": "readWriteFile",
      "configDescription": "Version 1"
    },
    {
      "name": "Extract SQL query",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Check if query exists",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Format query results",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Prepare final output",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Combine query result and chat answer",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3"
    },
    {
      "name": "List all tables in a database",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "Convert data to Json",
      "type": "n8n-nodes-base.convertToFile",
      "role": "convertToFile",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Schema Extractor",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "Final SQL result",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Structured Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "role": "outputParserStructured",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Edit Fields1",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "plot agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.7"
    },
    {
      "name": "deepseek-chat",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "role": "lmChatOpenAi",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Deepseek-chat",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "role": "lmChatOpenAi",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}