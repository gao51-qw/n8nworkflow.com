{
  "id": 4013,
  "slug": "4013",
  "title": "Automatic jest test generation for GitHub PRs with dual AI review",
  "description": "# Workflow: Automatic Unit Test Creator from GitHub\n\n## üèóÔ∏è Architecture Overview\nThis workflow listens for GitHub pull-request events, analyzes changed React/TypeScript files, auto-generates Jest tests via AI, has them reviewed by a second AI pass, and posts suggestions back as PR comments:\n\n1. GitHub Webhook ‚Üí PR opened or updated\n2. Fetch & Diff ‚Üí Retrieve raw diff of changed files\n3. Filter & Split ‚Üí Isolate .tsx files & their diffs\n4. Fetch File Contents ‚Üí Provide full context for tests\n5. Test Maker Agent ‚Üí Generate Jest tests for diff hunks\n6. Code Reviewer Agent ‚Üí Refine tests for style & edge-cases\n7. Post PR Comment ‚Üí Sends suggested tests back to GitHub\n\n## üì¶ Node-by-Node Breakdown\n\n```mermaid\nflowchart LR\n  A[Webhook: /github/pr-events] --&gt; B[GitHub: Get PR]\n  B --&gt; C[Function: Parse diff_url + owner/repo]\n  C --&gt; D[HTTP Request: GET diff_url]\n  D --&gt; E[Function: Split on \"diff --git\"]\n  E --&gt; F[Filter: /\\.tsx$/]\n  F --&gt; G[GitHub: Get File Contents]\n  G --&gt; H[Test Maker Agent]\n  H --&gt; I[Code Reviewer Agent]\n  I --&gt; J[Function: Build Comment Payload]\n  J --&gt; K[HTTP Request: POST to PR Comments]\n```\n\n### Webhook: GitHub PR Events\n- Type: HTTP Webhook (`/webhook/github/pr-events`)\n- Subscribed Events: `pull_request.opened`, `pull_request.synchronize`\n\n### GitHub: Get PR\n- Node: GitHub\n- Action: \"Get Pull Request\"\n- Inputs: owner, repo, pull_number\n\n### Function: Parse diff_url + owner/repo\n- Extracts:\n  - diff_url (e.g. ‚Ä¶/pulls/123.diff)\n  - owner, repo, merge_commit_sha\n\n### HTTP Request: GET diff_url\n- Fetches unified-diff text for the PR.\n\n### Function: Split on \"diff --git\"\n- Splits the diff into file-specific segments.\n\n### Filter: /.tsx$/\n- Keeps only segments where the file path ends with .tsx.\n\n### GitHub: Get File Contents\n- For each .tsx file, fetches the latest blob via GitHub API.\n\n### Test Maker Agent\n- Prompt:\n  - \"Generate Jest unit tests covering only the behaviors changed in these diff hunks.\"\n- Output: Raw Jest test code.\n\n### Code Reviewer Agent\n- Reads file + generated tests\n- Prompt:\n  - \"Review and improve these tests for readability, edge-cases, and naming conventions.\"\n- Output: Polished test suite.\n\n### Function: Build Comment Payload\n- Wraps tests in TypeScript fences:\n```ts\n// generated tests‚Ä¶\n```\n- Constructs JSON:\n```json\n{ \"body\": \"&lt;tests&gt;\" }\n```\n\n### HTTP Request: POST to PR Comments\n- URL: `https://api.github.com/repos/{owner}/{repo}/issues/{pull_number}/comments`\n- Body: Contains the suggested tests.\n\n## üîç Design Rationale & Best Practices\n\n### Focused Diff Analysis\n- Targets only .tsx files to cover UI logic.\n\n### Two-Stage AI\n- Separate \"generate\" + \"review\" steps mimic TDD + code review.\n\n### Stateless Functions\n- Pure JS for parsing & transformation, easy to test.\n\n### Non-Blocking PR Comments\n- Asynchronous suggestions‚Äîdevelopers aren't blocked.\n\n### Scoped Permissions\n- GitHub token limited to reading PRs & posting comments.",
  "featuredImage": "/data/workflows/4013/4013.webp",
  "author": {
    "id": 101,
    "slug": "varritech",
    "name": "Varritech",
    "avatar": ""
  },
  "categories": [
    "Engineering",
    "Multimodal AI"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 597,
  "downloads": 59,
  "createdAt": "2025-05-13T11:42:18.431Z",
  "updatedAt": "2026-01-16T08:32:36.925Z",
  "publishedAt": "2025-05-13T11:42:18.431Z",
  "nodes": 24,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/4013",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Automatic jest test generation for GitHub PRs with dual AI review",
    "workflowName": "Automatic jest test generation for GitHub PRs with dual AI review",
    "description": "# Workflow: Automatic Unit Test Creator from GitHub\n\n## üèóÔ∏è Architecture Overview\nThis workflow listens for GitHub pull-request events, analyzes changed React/TypeScript files, auto-generates Jest tests via AI, has them reviewed by a second AI pass, and posts suggestions back as PR comments:\n\n1. GitHub Webhook ‚Üí PR opened or updated\n2. Fetch & Diff ‚Üí Retrieve raw diff of changed files\n3. Filter & Split ‚Üí Isolate .tsx files & their diffs\n4. Fetch File Contents ‚Üí Provide full context for tests\n5. Test Maker Agent ‚Üí Generate Jest tests for diff hunks\n6. Code Reviewer Agent ‚Üí Refine tests for style & edge-cases\n7. Post PR Comment ‚Üí Sends suggested tests back to GitHub\n\n## üì¶ Node-by-Node Breakdown\n\n```mermaid\nflowchart LR\n  A[Webhook: /github/pr-events] --&gt; B[GitHub: Get PR]\n  B --&gt; C[Function: Parse diff_url + owner/repo]\n  C --&gt; D[HTTP Request: GET diff_url]\n  D --&gt; E[Function: Split on \"diff --git\"]\n  E --&gt; F[Filter: /\\.tsx$/]\n  F --&gt; G[GitHub: Get File Contents]\n  G --&gt; H[Test Maker Agent]\n  H --&gt; I[Code Reviewer Agent]\n  I --&gt; J[Function: Build Comment Payload]\n  J --&gt; K[HTTP Request: POST to PR Comments]\n```\n\n### Webhook: GitHub PR Events\n- Type: HTTP Webhook (`/webhook/github/pr-events`)\n- Subscribed Events: `pull_request.opened`, `pull_request.synchronize`\n\n### GitHub: Get PR\n- Node: GitHub\n- Action: \"Get Pull Request\"\n- Inputs: owner, repo, pull_number\n\n### Function: Parse diff_url + owner/repo\n- Extracts:\n  - diff_url (e.g. ‚Ä¶/pulls/123.diff)\n  - owner, repo, merge_commit_sha\n\n### HTTP Request: GET diff_url\n- Fetches unified-diff text for the PR.\n\n### Function: Split on \"diff --git\"\n- Splits the diff into file-specific segments.\n\n### Filter: /.tsx$/\n- Keeps only segments where the file path ends with .tsx.\n\n### GitHub: Get File Contents\n- For each .tsx file, fetches the latest blob via GitHub API.\n\n### Test Maker Agent\n- Prompt:\n  - \"Generate Jest unit tests covering only the behaviors changed in these diff hunks.\"\n- Output: Raw Jest test code.\n\n### Code Reviewer Agent\n- Reads file + generated tests\n- Prompt:\n  - \"Review and improve these tests for readability, edge-cases, and naming conventions.\"\n- Output: Polished test suite.\n\n### Function: Build Comment Payload\n- Wraps tests in TypeScript fences:\n```ts\n// generated tests‚Ä¶\n```\n- Constructs JSON:\n```json\n{ \"body\": \"&lt;tests&gt;\" }\n```\n\n### HTTP Request: POST to PR Comments\n- URL: `https://api.github.com/repos/{owner}/{repo}/issues/{pull_number}/comments`\n- Body: Contains the suggested tests.\n\n## üîç Design Rationale & Best Practices\n\n### Focused Diff Analysis\n- Targets only .tsx files to cover UI logic.\n\n### Two-Stage AI\n- Separate \"generate\" + \"review\" steps mimic TDD + code review.\n\n### Stateless Functions\n- Pure JS for parsing & transformation, easy to test.\n\n### Non-Blocking PR Comments\n- Asynchronous suggestions‚Äîdevelopers aren't blocked.\n\n### Scoped Permissions\n- GitHub token limited to reading PRs & posting comments.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "GH - Get PR",
      "type": "n8n-nodes-base.github",
      "role": "github",
      "configDescription": "Version 1"
    },
    {
      "name": "GET .diff file",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Splits text into array",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "FIlter for components",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Extrat API URL, owner and repo",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Get File name",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Get Files",
      "type": "n8n-nodes-base.githubTool",
      "role": "githubTool",
      "configDescription": "Version 1"
    },
    {
      "name": "Structured Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "role": "outputParserStructured",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Merge info needed",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3.1"
    },
    {
      "name": "Test Maker",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.8"
    },
    {
      "name": "Get Repo",
      "type": "n8n-nodes-base.githubTool",
      "role": "githubTool",
      "configDescription": "Version 1"
    },
    {
      "name": "Code Reviewer",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.8"
    },
    {
      "name": "o3-mini",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "role": "lmChatOpenAi",
      "configDescription": "Version 1.2"
    },
    {
      "name": "gpt4.1-mini",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "role": "lmChatOpenAi",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3.1"
    },
    {
      "name": "Prepare for POST",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "POST Comments",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 2"
    },
    {
      "name": "2nd Node for Testing",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Structured Output Parser1",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "role": "outputParserStructured",
      "configDescription": "Version 1.2"
    }
  ]
}