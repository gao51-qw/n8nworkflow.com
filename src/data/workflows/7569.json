{
  "id": 7569,
  "slug": "7569",
  "title": "Automatic Google Cloud Run auth with JWT token management (sub-workflow)",
  "description": "## Who it’s for? \nAnyone calling a **Google Cloud Run** service from n8n who wants a small, reusable auth layer instead of wiring tokens in every workflow.\n\n## What it does / How it works\nThis sub-workflow checks whether an incoming `id_token` exists and is still valid (with a 5-minute buffer). If it’s good, it reuses it. If not, it signs a short-lived JWT with your service account, exchanges it at Google’s token endpoint, and returns a fresh `id_token`. It also passes through `service_url` and an optional `service_path` so the caller can hit the endpoint right away. (Designed to be called via **Execute Workflow** from your main flow.)\n\n## How to set up\n- Add your **JWT (PEM)** credential using the service account **private_key**.\n- In **Vars**, set `client_email` (from your key) and confirm `token_uri` is `https://oauth2.googleapis.com/token`.\n- Call this sub-workflow with `service_url` (and optional `service_path`). Optionally include a prior `id_token` to enable reuse.\n\n## Inputs / Outputs\n**Inputs:** `id_token` (optional), `service_url`, `service_path`  \n**Outputs:** `id_token`, `service_url`, `service_path`\n\n## Notes\n- Built for loops: pair with a Merge/Split strategy to attach `id_token` to each item.\n- Keep credentials in n8n **Credentials** (no keys in nodes).\n- Full write-up and context: \n **[Build a Secure Google Cloud Run API, Then Call It from n8n (Free Tier)](https://medium.com/@marcocodes/build-a-secure-google-cloud-run-api-then-call-it-from-n8n-88c03291a95f)** \n— by Marco Cassar",
  "featuredImage": "/data/workflows/7569/7569.webp",
  "author": {
    "id": 101,
    "slug": "marcocassar",
    "name": "Marco Cassar",
    "avatar": ""
  },
  "categories": [
    "Engineering",
    "Multimodal AI"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 296,
  "downloads": 29,
  "createdAt": "2025-08-19T06:29:32.229Z",
  "updatedAt": "2026-01-16T08:51:09.316Z",
  "publishedAt": "2025-08-19T06:29:32.229Z",
  "nodes": 16,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/7569",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Automatic Google Cloud Run auth with JWT token management (sub-workflow)",
    "workflowName": "Automatic Google Cloud Run auth with JWT token management (sub-workflow)",
    "description": "## Who it’s for? \nAnyone calling a **Google Cloud Run** service from n8n who wants a small, reusable auth layer instead of wiring tokens in every workflow.\n\n## What it does / How it works\nThis sub-workflow checks whether an incoming `id_token` exists and is still valid (with a 5-minute buffer). If it’s good, it reuses it. If not, it signs a short-lived JWT with your service account, exchanges it at Google’s token endpoint, and returns a fresh `id_token`. It also passes through `service_url` and an optional `service_path` so the caller can hit the endpoint right away. (Designed to be called via **Execute Workflow** from your main flow.)\n\n## How to set up\n- Add your **JWT (PEM)** credential using the service account **private_key**.\n- In **Vars**, set `client_email` (from your key) and confirm `token_uri` is `https://oauth2.googleapis.com/token`.\n- Call this sub-workflow with `service_url` (and optional `service_path`). Optionally include a prior `id_token` to enable reuse.\n\n## Inputs / Outputs\n**Inputs:** `id_token` (optional), `service_url`, `service_path`  \n**Outputs:** `id_token`, `service_url`, `service_path`\n\n## Notes\n- Built for loops: pair with a Merge/Split strategy to attach `id_token` to each item.\n- Keep credentials in n8n **Credentials** (no keys in nodes).\n- Full write-up and context: \n **[Build a Secure Google Cloud Run API, Then Call It from n8n (Free Tier)](https://medium.com/@marcocodes/build-a-secure-google-cloud-run-api-then-call-it-from-n8n-88c03291a95f)** \n— by Marco Cassar",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "If Token",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "If",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Return Values",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Combine Context",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3.2"
    },
    {
      "name": "Raise Id",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Decode JWT",
      "type": "n8n-nodes-base.jwt",
      "role": "jwt",
      "configDescription": "Version 1"
    },
    {
      "name": "Sign New JWT",
      "type": "n8n-nodes-base.jwt",
      "role": "jwt",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Start",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "role": "executeWorkflowTrigger",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Bearer YOUR_TOKEN_HERE Request",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Vars",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}