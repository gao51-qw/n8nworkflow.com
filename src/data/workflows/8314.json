{
  "id": 8314,
  "slug": "8314",
  "title": "Telegram chatbot with voice recognition and message batching using OpenAI",
  "description": "This Telegram workflow batches rapid-fire messages from the same user into one prompt (20–30s debounce), then sends a single AI reply.\n\nIt uses **two Google Sheets**:\n- **Message Retention** (`date | user_id | message`) — queues incoming messages.\n- **Message  Checkup** (`user_id | is_waiting | last_updated`) — debounces per user.\n\nFlow per message:\n1. Log to **Message Retention**.\n2. Read **Message  Checkup** for that `user_id`. If empty, synthesize `{ is_waiting:false }`.\n3. IF (**OR**):\n   - `last_updated` is **older than 30s**, **or**\n   - `is_waiting` is **false**  \n   → Start wait window: set `is_waiting=true`, update `last_updated`, **Wait** (e.g., 30s).\n4. After Wait: fetch all queued messages for the user, merge them, delete those rows, send one AI answer to Telegram, then clear the Waiting row.\n5. If a new message arrives while waiting, we only refresh `last_updated` (extend the window) — we do **not** start another wait.\n\nCopy/paste:\n- Older-than-30s: `{{ new Date(Date.now() - 30000).toISOString() }}`\n- “No Rows” normalizer (Code node) ensures the IF always has data to check.\n\nSupports text and voice (voice via Whisper). Works reliably on Telegram once the webhook is registered and Sheets are shared with the service account.",
  "featuredImage": "/data/workflows/8314/8314.webp",
  "author": {
    "id": 101,
    "slug": "rushtechhub",
    "name": "Kirill Zolygin",
    "avatar": ""
  },
  "categories": [
    "Support Chatbot",
    "AI Chatbot"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 707,
  "downloads": 70,
  "createdAt": "2025-09-05T22:27:56.621Z",
  "updatedAt": "2026-01-16T08:55:14.430Z",
  "publishedAt": "2025-09-05T22:27:56.621Z",
  "nodes": 31,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/8314",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Telegram chatbot with voice recognition and message batching using OpenAI",
    "workflowName": "Telegram chatbot with voice recognition and message batching using OpenAI",
    "description": "This Telegram workflow batches rapid-fire messages from the same user into one prompt (20–30s debounce), then sends a single AI reply.\n\nIt uses **two Google Sheets**:\n- **Message Retention** (`date | user_id | message`) — queues incoming messages.\n- **Message  Checkup** (`user_id | is_waiting | last_updated`) — debounces per user.\n\nFlow per message:\n1. Log to **Message Retention**.\n2. Read **Message  Checkup** for that `user_id`. If empty, synthesize `{ is_waiting:false }`.\n3. IF (**OR**):\n   - `last_updated` is **older than 30s**, **or**\n   - `is_waiting` is **false**  \n   → Start wait window: set `is_waiting=true`, update `last_updated`, **Wait** (e.g., 30s).\n4. After Wait: fetch all queued messages for the user, merge them, delete those rows, send one AI answer to Telegram, then clear the Waiting row.\n5. If a new message arrives while waiting, we only refresh `last_updated` (extend the window) — we do **not** start another wait.\n\nCopy/paste:\n- Older-than-30s: `{{ new Date(Date.now() - 30000).toISOString() }}`\n- “No Rows” normalizer (Code node) ensures the IF always has data to check.\n\nSupports text and voice (voice via Whisper). Works reliably on Telegram once the webhook is registered and Sheets are shared with the service account.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Pass text message",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Link Filter",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3.1"
    },
    {
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Transcript Error Output",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Transcript Result",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Get Audio File",
      "type": "n8n-nodes-base.telegram",
      "role": "telegram",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Transcribe a recording",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "role": "openAi",
      "configDescription": "Version 1.8"
    },
    {
      "name": "Append row in sheet",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.7"
    },
    {
      "name": "Get row(s) in sheet",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.7"
    },
    {
      "name": "Embeddings OpenAI1",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "role": "embeddingsOpenAi",
      "configDescription": "Version 1.2"
    },
    {
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "role": "lmChatOpenAi",
      "configDescription": "Version 1.2"
    },
    {
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.7"
    },
    {
      "name": "Get row(s) in sheet1",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.7"
    },
    {
      "name": "What to do",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Update row in sheet",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.7"
    },
    {
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "role": "wait",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Delete rows or columns from sheet1",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.7"
    },
    {
      "name": "Update row in sheet1",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.7"
    },
    {
      "name": "No Rows",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Batch Messages",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "role": "memoryBufferWindow",
      "configDescription": "Version 1.3"
    },
    {
      "name": "Supabase Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "role": "vectorStoreSupabase",
      "configDescription": "Version 1.3"
    },
    {
      "name": "Send message Back to TG",
      "type": "n8n-nodes-base.telegram",
      "role": "telegram",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "role": "telegramTrigger",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Delete Row from Message Checkup",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.7"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}