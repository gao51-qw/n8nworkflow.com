{
  "id": 3903,
  "slug": "3903",
  "title": "Conversational PostgreSQL agent with visuals, multi-KPI, and data editing (MCP)",
  "description": "![ChatGPT Image 6 mai 2025, 17_58_38.png](fileId:1286)\n\nAsk your PostgreSQL database complex questions and receive clear summaries, charts, and even update or insert data ‚Äî all through one smart agent powered by n8n‚Äôs Model Context Protocol (MCP).\n\nSupports:\n- Multi-KPI insights in one prompt  \n- Auto-generated QuickChart bar/pie charts  \n- Natural-language inserts and updates  \n- Markdown-friendly output for dashboards\n\n\n---\n\n## üöÄ Why This Version Stands Out\n\nThis version goes beyond reporting:\n- üìà Auto-generates charts (QuickChart)\n- üßÆ Answers multiple KPIs in one message\n- ‚úçÔ∏è Add and update records securely\n- üß† Uses up to 30 planned steps for smart reasoning\n\nüí∞ Estimated cost per run: ~$0.02\n\n---\n\n## üí¨ Example Output\n\n![withvisual_sql.png](fileId:1287)\n---\n\n## üß∞ Key Components\n\n- MCP Server Trigger ‚Üí Receives natural queries  \n- Claude 3.5 Haiku ‚Üí Plans, reasons, splits tasks  \n- DeepSeek ‚Üí SQL and QuickChart generation  \n- checkdatabase subflow ‚Üí Validates SQL  \n- Plot Tool ‚Üí Converts data to QuickChart URLs  \n- Insert/Update nodes ‚Üí Edits PostgreSQL records  \n- Markdown Formatter ‚Üí Combines output into readable message\n\n---\n\n## ü§ñ Model Configuration Notes\n\nThis workflow uses two models:\n\n1. **Claude 3.5 Haiku (Anthropic)**  \nUsed as the MCP agent for reasoning, planning, and tool calling. Claude is the native model for MCP and delivers reliable results in fewer steps.\n\n2. **DeepSeek**  \nUsed in:\n- `checkdatabase` for SQL generation  \n- `Plot Tool` for QuickChart JSON generation\n\nüß† All models are modular ‚Äî you can plug in OpenAI, Gemini, or Mistral if desired.\n\n---\n\n## üîê Security by Design\n\n- No raw SQL from user input  \n- Fully parameterized queries  \n- Structured tool calling with validation  \n- Safe output format (text + chart links)\n\n---\n\n## üß™ Try This Prompt\n\n&gt; ‚ÄúShow me top 5 products by revenue, revenue per month chart, and best customers.‚Äù\n\nExpected output:\n- 3 KPIs\n- Multiple SQL queries\n- 2‚Äì3 QuickChart links\n- Markdown summary for dashboard/Slack\n\n---\n\n## üõ† How to Use\n\n1. Import:\n   - `Build_your_own_PostgreSQL_MCP_server__visuals_capable_.json`\n   - `checkdatabase.json`\n   - `Plot_tool.json`\n\n2. Create your **PostgreSQL credential** under ‚ÄúCredentials‚Äù in n8n:\n   - Must match the name used in the workflow (e.g., `Postgres account 3`)\n\n3. Assign AI models:\n   - Claude 3.5 Haiku ‚Üí MCP agent (`Claude 3.5 MCP Agent`)\n   - DeepSeek ‚Üí LLM nodes inside `checkdatabase` and `Plot Tool`\n\n4. Trigger the workflow using the URL from the **MCP Server Trigger** node  \n   (e.g., in a chatbot, HTTP request, or Webhook UI)\n\n---\n\n## üì¶ End-User Setup Guide\n\nIf you're using this template for the first time, follow these exact steps:\n\n1. Go to your n8n dashboard and import all three workflows (main + subflows)\n2. Create a PostgreSQL credential using your host, database, user, and password\n3. Go to the Claude and DeepSeek nodes, and connect them to your account(s)\n4. Use the Webhook URL in the `MCP Server Trigger` to connect your chatbot or frontend\n5. Send a prompt like:  \n   ‚ÄúShow me revenue per month, top 5 products, and a chart of best customers.‚Äù\n\nOptional:  \n- You can increase the MCP Agent‚Äôs `MaxIterations` to go deeper (default is 30)\n- You can use Switch nodes to limit access to certain tables or actions\n- Insert/Update nodes are already included and can be safely enabled\n\n‚úÖ Once this is done, your AI assistant will:\n- Read from your database  \n- Visualize data via QuickChart  \n- Insert or update rows  \n- Respond in clear, markdown-formatted summaries\n\n---\n\n## üîó More Templates by the Same Creator\n\n1. [PostgreSQL Conversational Agent with Claude & DeepSeek (Multi-KPI, Secure)](https://n8n.io/workflows/3892-postgresql-conversational-agent-with-claude-and-deepseek-multi-kpi-secure/)\n\n2. [Conversing with Data: Transforming Text into SQL Queries and Visual Curves](https://n8n.io/workflows/3497-conversing-with-data-transforming-text-into-sql-queries-and-visual-curves/)\n\n3. [Customer Feedback Analysis with AI, QuickChart & HTML Report Generator](https://n8n.io/workflows/3642-customer-feedback-analysis-with-ai-quickchart-and-html-report-generator/)\n",
  "featuredImage": "/data/workflows/3903/3903.webp",
  "author": {
    "id": 101,
    "slug": "hippolyte-hu",
    "name": "hippolyte-hu",
    "avatar": ""
  },
  "categories": [
    "Engineering",
    "AI RAG"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 2176,
  "downloads": 217,
  "createdAt": "2025-05-06T15:59:21.804Z",
  "updatedAt": "2026-01-16T08:32:04.851Z",
  "publishedAt": "2025-05-06T15:59:21.804Z",
  "nodes": 22,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/3903",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Conversational PostgreSQL agent with visuals, multi-KPI, and data editing (MCP)",
    "workflowName": "Conversational PostgreSQL agent with visuals, multi-KPI, and data editing (MCP)",
    "description": "![ChatGPT Image 6 mai 2025, 17_58_38.png](fileId:1286)\n\nAsk your PostgreSQL database complex questions and receive clear summaries, charts, and even update or insert data ‚Äî all through one smart agent powered by n8n‚Äôs Model Context Protocol (MCP).\n\nSupports:\n- Multi-KPI insights in one prompt  \n- Auto-generated QuickChart bar/pie charts  \n- Natural-language inserts and updates  \n- Markdown-friendly output for dashboards\n\n\n---\n\n## üöÄ Why This Version Stands Out\n\nThis version goes beyond reporting:\n- üìà Auto-generates charts (QuickChart)\n- üßÆ Answers multiple KPIs in one message\n- ‚úçÔ∏è Add and update records securely\n- üß† Uses up to 30 planned steps for smart reasoning\n\nüí∞ Estimated cost per run: ~$0.02\n\n---\n\n## üí¨ Example Output\n\n![withvisual_sql.png](fileId:1287)\n---\n\n## üß∞ Key Components\n\n- MCP Server Trigger ‚Üí Receives natural queries  \n- Claude 3.5 Haiku ‚Üí Plans, reasons, splits tasks  \n- DeepSeek ‚Üí SQL and QuickChart generation  \n- checkdatabase subflow ‚Üí Validates SQL  \n- Plot Tool ‚Üí Converts data to QuickChart URLs  \n- Insert/Update nodes ‚Üí Edits PostgreSQL records  \n- Markdown Formatter ‚Üí Combines output into readable message\n\n---\n\n## ü§ñ Model Configuration Notes\n\nThis workflow uses two models:\n\n1. **Claude 3.5 Haiku (Anthropic)**  \nUsed as the MCP agent for reasoning, planning, and tool calling. Claude is the native model for MCP and delivers reliable results in fewer steps.\n\n2. **DeepSeek**  \nUsed in:\n- `checkdatabase` for SQL generation  \n- `Plot Tool` for QuickChart JSON generation\n\nüß† All models are modular ‚Äî you can plug in OpenAI, Gemini, or Mistral if desired.\n\n---\n\n## üîê Security by Design\n\n- No raw SQL from user input  \n- Fully parameterized queries  \n- Structured tool calling with validation  \n- Safe output format (text + chart links)\n\n---\n\n## üß™ Try This Prompt\n\n&gt; ‚ÄúShow me top 5 products by revenue, revenue per month chart, and best customers.‚Äù\n\nExpected output:\n- 3 KPIs\n- Multiple SQL queries\n- 2‚Äì3 QuickChart links\n- Markdown summary for dashboard/Slack\n\n---\n\n## üõ† How to Use\n\n1. Import:\n   - `Build_your_own_PostgreSQL_MCP_server__visuals_capable_.json`\n   - `checkdatabase.json`\n   - `Plot_tool.json`\n\n2. Create your **PostgreSQL credential** under ‚ÄúCredentials‚Äù in n8n:\n   - Must match the name used in the workflow (e.g., `Postgres account 3`)\n\n3. Assign AI models:\n   - Claude 3.5 Haiku ‚Üí MCP agent (`Claude 3.5 MCP Agent`)\n   - DeepSeek ‚Üí LLM nodes inside `checkdatabase` and `Plot Tool`\n\n4. Trigger the workflow using the URL from the **MCP Server Trigger** node  \n   (e.g., in a chatbot, HTTP request, or Webhook UI)\n\n---\n\n## üì¶ End-User Setup Guide\n\nIf you're using this template for the first time, follow these exact steps:\n\n1. Go to your n8n dashboard and import all three workflows (main + subflows)\n2. Create a PostgreSQL credential using your host, database, user, and password\n3. Go to the Claude and DeepSeek nodes, and connect them to your account(s)\n4. Use the Webhook URL in the `MCP Server Trigger` to connect your chatbot or frontend\n5. Send a prompt like:  \n   ‚ÄúShow me revenue per month, top 5 products, and a chart of best customers.‚Äù\n\nOptional:  \n- You can increase the MCP Agent‚Äôs `MaxIterations` to go deeper (default is 30)\n- You can use Switch nodes to limit access to certain tables or actions\n- Insert/Update nodes are already included and can be safely enabled\n\n‚úÖ Once this is done, your AI assistant will:\n- Read from your database  \n- Visualize data via QuickChart  \n- Insert or update rows  \n- Respond in clear, markdown-formatted summaries\n\n---\n\n## üîó More Templates by the Same Creator\n\n1. [PostgreSQL Conversational Agent with Claude & DeepSeek (Multi-KPI, Secure)](https://n8n.io/workflows/3892-postgresql-conversational-agent-with-claude-and-deepseek-multi-kpi-secure/)\n\n2. [Conversing with Data: Transforming Text into SQL Queries and Visual Curves](https://n8n.io/workflows/3497-conversing-with-data-transforming-text-into-sql-queries-and-visual-curves/)\n\n3. [Customer Feedback Analysis with AI, QuickChart & HTML Report Generator](https://n8n.io/workflows/3642-customer-feedback-analysis-with-ai-quickchart-and-html-report-generator/)",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "GetTableSchema",
      "type": "n8n-nodes-base.postgresTool",
      "role": "postgresTool",
      "configDescription": "Version 2.6"
    },
    {
      "name": "ListTables",
      "type": "n8n-nodes-base.postgresTool",
      "role": "postgresTool",
      "configDescription": "Version 2.6"
    },
    {
      "name": "When Executed by Another Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "role": "executeWorkflowTrigger",
      "configDescription": "Version 1.1"
    },
    {
      "name": "CreateTableRecords",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "role": "toolWorkflow",
      "configDescription": "Version 2.1"
    },
    {
      "name": "ReadTableRecord",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.6"
    },
    {
      "name": "Operation",
      "type": "n8n-nodes-base.switch",
      "role": "switch",
      "configDescription": "Version 3.2"
    },
    {
      "name": "UpdateTableRecord",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.6"
    },
    {
      "name": "UpdateTableRecords",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "role": "toolWorkflow",
      "configDescription": "Version 2.1"
    },
    {
      "name": "CreateTableRecord",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.6"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "PostgreSQL MCP Server",
      "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
      "role": "mcpTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.8"
    },
    {
      "name": "MCP Client",
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "role": "mcpClientTool",
      "configDescription": "Version 1"
    },
    {
      "name": "Anthropic Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "role": "lmChatAnthropic",
      "configDescription": "Version 1.3"
    },
    {
      "name": "Think",
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "role": "toolThink",
      "configDescription": "Version 1"
    },
    {
      "name": "get table details",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "role": "toolWorkflow",
      "configDescription": "Version 2.1"
    },
    {
      "name": "ReadTableRows",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "role": "toolWorkflow",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Plot tool",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "role": "toolWorkflow",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "role": "memoryBufferWindow",
      "configDescription": "Version 1.3"
    },
    {
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "role": "chatTrigger",
      "configDescription": "Version 1.1"
    }
  ]
}