{
  "id": 2676,
  "slug": "2676",
  "title": "Analyze email headers for IP reputation and spoofing detection - Outlook",
  "description": "### **Analyze Emails for Security Insights**\n\n#### **Who is this for?**\n\nThis workflow is ideal for security teams, IT Ops professionals, and managed service providers (MSPs) responsible for monitoring and validating email traffic. It’s especially useful for organizations that need to identify potential phishing attempts, spam, or compromised accounts by analyzing email headers and IP reputation.\n\n---\n\n#### **What problem is this workflow solving?**\n\nThis workflow helps identify malicious or suspicious emails by verifying email authentication headers (SPF, DKIM, DMARC) and analyzing the reputation of the originating IP address. By automating these checks, it reduces manual analysis time and flags potential threats efficiently.\n\n---\n\n#### **What this workflow does**\n\n- **Email Monitoring:** Polls a specified Microsoft Outlook folder for new emails in real-time.\n- **Header Analysis:** Retrieves and processes email headers to extract critical information such as authentication results and the sender’s IP address.\n- **IP Reputation Check:** Leverages external APIs (IP Quality Score and IP-API) to analyze the originating IP for potential spam or malicious activity.\n- **Authentication Validation:** Validates SPF, DKIM, and DMARC headers, determining if the email passes industry-standard authentication protocols.\n- **Data Aggregation and Reporting:** Combines all analyzed data into a unified format, ready for reporting or integration into downstream systems.\n- **Webhook Integration:** Outputs the findings via a webhook, enabling integration with alerting tools or security information and event management (SIEM) platforms.\n\n---\n\n#### **Setup**\n\n1. **Connect to Outlook:**\n   - Configure the Microsoft Outlook trigger node with valid OAuth2 credentials.\n   - Specify the email folder to monitor for new messages.\n\n2. **API Keys (Optional):**\n   - Obtain an API key for IP Quality Score (https://ipqualityscore.com).\n   - Ensure the IP-API endpoint is accessible.\n   - This step is optional as ipqualityscore.com will provide a limited number of free lookups each month. [See more details here](https://www.ipqualityscore.com/plans).  \n\n3. **Webhook Configuration:**\n   - Set up a webhook endpoint to receive the output of the workflow.\n\n4. **Optional Adjustments:**\n   - Customize polling intervals in the trigger node.\n   - Modify header filters or extend the validation logic as needed.\n\n---\n\n#### **How to customize this workflow to your needs**\n\n- **Add Alerts:** Use the `Respond to Webhook` node to trigger notifications in Slack, email, or any other communication channel.\n- **Integrate with SIEM:** Forward the workflow output to SIEM tools like Splunk or ELK Stack for further analysis.\n- **Modify Validation Rules:** Update SPF, DKIM, or DMARC logic in the `Set` nodes to align with your organization’s security policies.\n- **Expand IP Analysis:** Add more APIs or services to enrich IP reputation data, such as VirusTotal or AbuseIPDB.\n\n---\n\nThis workflow provides a robust foundation for email security monitoring and can be tailored to fit your organization's unique requirements. With its modular design and integration options, it’s a versatile tool to enhance your cybersecurity operations.",
  "featuredImage": "/data/workflows/2676/2676.webp",
  "author": {
    "id": 101,
    "slug": "djangelic",
    "name": "Angel Menendez",
    "avatar": ""
  },
  "categories": [
    "SecOps"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 5153,
  "downloads": 515,
  "createdAt": "2024-12-27T06:09:11.324Z",
  "updatedAt": "2026-01-16T08:25:56.538Z",
  "publishedAt": "2024-12-27T06:09:11.324Z",
  "nodes": 41,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/2676",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Analyze email headers for IP reputation and spoofing detection - Outlook",
    "workflowName": "Analyze email headers for IP reputation and spoofing detection - Outlook",
    "description": "### **Analyze Emails for Security Insights**\n\n#### **Who is this for?**\n\nThis workflow is ideal for security teams, IT Ops professionals, and managed service providers (MSPs) responsible for monitoring and validating email traffic. It’s especially useful for organizations that need to identify potential phishing attempts, spam, or compromised accounts by analyzing email headers and IP reputation.\n\n---\n\n#### **What problem is this workflow solving?**\n\nThis workflow helps identify malicious or suspicious emails by verifying email authentication headers (SPF, DKIM, DMARC) and analyzing the reputation of the originating IP address. By automating these checks, it reduces manual analysis time and flags potential threats efficiently.\n\n---\n\n#### **What this workflow does**\n\n- **Email Monitoring:** Polls a specified Microsoft Outlook folder for new emails in real-time.\n- **Header Analysis:** Retrieves and processes email headers to extract critical information such as authentication results and the sender’s IP address.\n- **IP Reputation Check:** Leverages external APIs (IP Quality Score and IP-API) to analyze the originating IP for potential spam or malicious activity.\n- **Authentication Validation:** Validates SPF, DKIM, and DMARC headers, determining if the email passes industry-standard authentication protocols.\n- **Data Aggregation and Reporting:** Combines all analyzed data into a unified format, ready for reporting or integration into downstream systems.\n- **Webhook Integration:** Outputs the findings via a webhook, enabling integration with alerting tools or security information and event management (SIEM) platforms.\n\n---\n\n#### **Setup**\n\n1. **Connect to Outlook:**\n   - Configure the Microsoft Outlook trigger node with valid OAuth2 credentials.\n   - Specify the email folder to monitor for new messages.\n\n2. **API Keys (Optional):**\n   - Obtain an API key for IP Quality Score (https://ipqualityscore.com).\n   - Ensure the IP-API endpoint is accessible.\n   - This step is optional as ipqualityscore.com will provide a limited number of free lookups each month. [See more details here](https://www.ipqualityscore.com/plans).  \n\n3. **Webhook Configuration:**\n   - Set up a webhook endpoint to receive the output of the workflow.\n\n4. **Optional Adjustments:**\n   - Customize polling intervals in the trigger node.\n   - Modify header filters or extend the validation logic as needed.\n\n---\n\n#### **How to customize this workflow to your needs**\n\n- **Add Alerts:** Use the `Respond to Webhook` node to trigger notifications in Slack, email, or any other communication channel.\n- **Integrate with SIEM:** Forward the workflow output to SIEM tools like Splunk or ELK Stack for further analysis.\n- **Modify Validation Rules:** Update SPF, DKIM, or DMARC logic in the `Set` nodes to align with your organization’s security policies.\n- **Expand IP Analysis:** Add more APIs or services to enrich IP reputation data, such as VirusTotal or AbuseIPDB.\n\n---\n\nThis workflow provides a robust foundation for email security monitoring and can be tailored to fit your organization's unique requirements. With its modular design and integration options, it’s a versatile tool to enhance your cybersecurity operations.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Trigger on New Email",
      "type": "n8n-nodes-base.microsoftOutlookTrigger",
      "role": "microsoftOutlookTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Retrieve Headers of Email",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Extract Received Headers",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Remove Extra Received Headers",
      "type": "n8n-nodes-base.limit",
      "role": "limit",
      "configDescription": "Version 1"
    },
    {
      "name": "Extract Original From IP",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Query IP Quality Score API",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Query IP API",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Authentication-Results Header?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Extract Authentication-Results Header",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Received-SPF Header?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "DKIM-Signature Header?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Set SPF Value",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Extract Received-SPF Header",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "DKIM Signature Found",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "DMARC Header?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "No DMARC Header",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Extract DMARC Header",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Set DMARC Value",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Original IP Found?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "No DKIM Signature Found",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Determine Auth Values",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "No SPF Found",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3"
    },
    {
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "role": "aggregate",
      "configDescription": "Version 1"
    },
    {
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "Format Webhook Output",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Format Individual Auth Outputs",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Format Combined Auth Output",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "role": "respondToWebhook",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Webhook1",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 2"
    },
    {
      "name": "Set Headers",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Aggregate Received-SPF Headers",
      "type": "n8n-nodes-base.aggregate",
      "role": "aggregate",
      "configDescription": "Version 1"
    },
    {
      "name": "Set Headers Here",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Set Webhook Headers Here",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}