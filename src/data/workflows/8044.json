{
  "id": 8044,
  "slug": "8044",
  "title": "Automate token purchases with dollar cost averaging on Uniswap V3 & 1Shot API",
  "description": "*This workflow contains community nodes that are only compatible with the self-hosted version of n8n.*\n\n![DCAdemo.gif](fileId:2287)\n# Dollar Cost Averaging with Uniswap V3\n\nThis workflow lets you set up an scheduled workflow to dollar cost average (DCA) into any token on a custom schedule using [1Shot API](https://1shotapi.com) and the [Uniswap V3](https://app.uniswap.org/) protocol. Choose your schedule input token and output token and optionally configure the workflow to send you notifications in Telegram everytime your workflow completes a swap. \n\n## YouTube Tutorial\n\nYou can watch the full [end-to-end tutorial](https://youtu.be/JiyLR5NtU7I) for this workflow on our [YouTube channel](https://www.youtube.com/@1shotapi). \n\n## Wallet Delegation\n\nImportantly, this workflow uses Metamasks [Delegation Framework](https://metamask.io/developer/delegation-toolkit) which lets you DCA from an account you custody whithout ever exporting your private key or giving up control of your assets. \n\n## Setup\n\n1. Create a free [1Shot API](https://1shotapi.com) account, provision a [server wallet](https://app.1shotapi.com/wallets) to relay transactions, and generate an API key to connect to n8n.  \n2. Import the following [Uniswap contracts](https://docs.uniswap.org/contracts/v3/reference/deployments/) into your 1Shot API account for the chain you want to swap on: QuoterV2, SwapRouter02, and the token pool (needed to compute time-weighted average price (TWAP). \n3. Import the `approve` function for the ERC-20 token you want to use to purchase your target asset (this should be the `token0` or `token1` of the pool you imported in step 2).\n4. Click on the server wallet details you created, fund it with enough gas tokens to pay for your transactions, then generate a delegation for the SwapRouter02 contract and the ERC-20 token from steps 2 and 3. \n5. Import the DCA workflow and use your 1Shot API key/secret to create a credential.\n6. Point the 1Shot API nodes at the appropriate smart contract functions you imported in steps 2 and 3. \n7. In the `Swap Configs` node, set the amount of the *in* token you want to spend on each purchase - for example, if you are using USDC (which has 6 decimals) and you want to purchase $10 every purchase, then `amountDCA` should be `10000000`. Also set the correct addresses for the SwapRouterV2, `token0`, `token1` and `fee` of the pool you are using. \n8. Lastly, set the frequency of your DCA in the trigger node and activate!\n\n## Optional Telegram Notifications\n\nYou can configure a Telegarm bot to notifiy you everytime the workflow completes to send you a transaction has and you remaining balance in your purchasing funds. ",
  "featuredImage": "/data/workflows/8044/8044.webp",
  "author": {
    "id": 101,
    "slug": "oneshotapi",
    "name": "1Shot API",
    "avatar": ""
  },
  "categories": [
    "Crypto Trading",
    "Multimodal AI"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 181,
  "downloads": 18,
  "createdAt": "2025-08-30T05:39:26.365Z",
  "updatedAt": "2026-01-16T08:53:47.300Z",
  "publishedAt": "2025-08-30T05:39:26.365Z",
  "nodes": 16,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/8044",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Automate token purchases with dollar cost averaging on Uniswap V3 & 1Shot API",
    "workflowName": "Automate token purchases with dollar cost averaging on Uniswap V3 & 1Shot API",
    "description": "*This workflow contains community nodes that are only compatible with the self-hosted version of n8n.*\n\n![DCAdemo.gif](fileId:2287)\n# Dollar Cost Averaging with Uniswap V3\n\nThis workflow lets you set up an scheduled workflow to dollar cost average (DCA) into any token on a custom schedule using [1Shot API](https://1shotapi.com) and the [Uniswap V3](https://app.uniswap.org/) protocol. Choose your schedule input token and output token and optionally configure the workflow to send you notifications in Telegram everytime your workflow completes a swap. \n\n## YouTube Tutorial\n\nYou can watch the full [end-to-end tutorial](https://youtu.be/JiyLR5NtU7I) for this workflow on our [YouTube channel](https://www.youtube.com/@1shotapi). \n\n## Wallet Delegation\n\nImportantly, this workflow uses Metamasks [Delegation Framework](https://metamask.io/developer/delegation-toolkit) which lets you DCA from an account you custody whithout ever exporting your private key or giving up control of your assets. \n\n## Setup\n\n1. Create a free [1Shot API](https://1shotapi.com) account, provision a [server wallet](https://app.1shotapi.com/wallets) to relay transactions, and generate an API key to connect to n8n.  \n2. Import the following [Uniswap contracts](https://docs.uniswap.org/contracts/v3/reference/deployments/) into your 1Shot API account for the chain you want to swap on: QuoterV2, SwapRouter02, and the token pool (needed to compute time-weighted average price (TWAP). \n3. Import the `approve` function for the ERC-20 token you want to use to purchase your target asset (this should be the `token0` or `token1` of the pool you imported in step 2).\n4. Click on the server wallet details you created, fund it with enough gas tokens to pay for your transactions, then generate a delegation for the SwapRouter02 contract and the ERC-20 token from steps 2 and 3. \n5. Import the DCA workflow and use your 1Shot API key/secret to create a credential.\n6. Point the 1Shot API nodes at the appropriate smart contract functions you imported in steps 2 and 3. \n7. In the `Swap Configs` node, set the amount of the *in* token you want to spend on each purchase - for example, if you are using USDC (which has 6 decimals) and you want to purchase $10 every purchase, then `amountDCA` should be `10000000`. Also set the correct addresses for the SwapRouterV2, `token0`, `token1` and `fee` of the pool you are using. \n8. Lastly, set the frequency of your DCA in the trigger node and activate!\n\n## Optional Telegram Notifications\n\nYou can configure a Telegarm bot to notifiy you everytime the workflow completes to send you a transaction has and you remaining balance in your purchasing funds.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Calculate TWAP",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Fetch Pool TWA Observations",
      "type": "n8n-nodes-1shot.oneShot",
      "role": "oneShot",
      "configDescription": "Version 1"
    },
    {
      "name": "Get Swap Qoute",
      "type": "n8n-nodes-1shot.oneShot",
      "role": "oneShot",
      "configDescription": "Version 1"
    },
    {
      "name": "Swap Tokens",
      "type": "n8n-nodes-1shot.oneShotSynch",
      "role": "oneShotSynch",
      "configDescription": "Version 1"
    },
    {
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "role": "scheduleTrigger",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Failure Details",
      "type": "n8n-nodes-base.telegram",
      "role": "telegram",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Give Approval to Router",
      "type": "n8n-nodes-1shot.oneShotSynch",
      "role": "oneShotSynch",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Success Details",
      "type": "n8n-nodes-base.telegram",
      "role": "telegram",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Get Remaining DCA Funds Balance",
      "type": "n8n-nodes-1shot.oneShot",
      "role": "oneShot",
      "configDescription": "Version 1"
    },
    {
      "name": "Swap Configs",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}