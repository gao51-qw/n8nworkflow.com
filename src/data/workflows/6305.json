{
  "id": 6305,
  "slug": "6305",
  "title": "Salesforce to S3 file migration & cleanup",
  "description": "# Salesforce to S3 File Migration & Cleanup\n\nAutomate archiving old Salesforce files to Amazon S3, log them back in Salesforce, and free up org storage ‚Äî all from a scheduled n8n workflow.\n\n---\n\n## üîß How It Works (High-Level)\n\n1. **Schedule Trigger** kicks off (e.g., daily).  \n2. **Query Salesforce** for `ContentDocument` records older than 365 days.  \n3. **Loop Each File** ‚Üí download binary via REST.  \n4. **Upload to S3** with the original filename.  \n5. **Lookup Links** (`ContentDocumentLink`) to keep the parent record reference.  \n6. **Filter Out Users** (ignore `LinkedEntityId` starting with `005`).  \n7. **Create `S3_File__c`** record in Salesforce for traceability.  \n8. **Delete Original File** from Salesforce to reclaim storage.  \n9. **Notify via Slack** when the batch is done.\n\n![Screenshot 20250723 135316.png](fileId:1840)\n---\n\n## üöÄ Set Up Steps (Time: ~45‚Äì90 mins)\n\n1. **Import n8n Workflow JSON** and wire up credentials (Salesforce OAuth2, AWS S3, Slack).  \n2. **Install Salesforce Unmanaged Package** (Custom Object `S3_File__c`, Apex controller, LWC, settings).  \n3. **Fill `S3Settings__c`** (bucket, region, keys, expiry) or swap to Named Credentials.  \n4. **Test with a Sandbox Batch** (e.g., small date range) and verify upload/delete.  \n5. **Schedule & Monitor** (tweak interval, Slack channel).\n\n\n---\n\n## üíñ Why you‚Äôll love it\n- üí∏ **Slash storage costs** ‚Äî offload gigabytes to S3  \n- üîç **Full traceability** ‚Äî every file still tracked in Salesforce  \n- üß∞ **Plug & play** ‚Äî import JSON, install package, plug in creds  \n- üß± **Modular & extensible** ‚Äî swap S3, add approvals, build an uploader UI  \n- ‚è± **Set it & forget it** ‚Äî scheduled automation + Slack alerts\n\n## üì¶ What‚Äôs Included\n\n- **n8n JSON Flow** ‚Äì ready to import.  \n- **Salesforce Unmanaged Package** ‚Äì Apex (`S3FilesController.cls`), LWC (`s3FilesViewer`), `S3_File__c`, `S3Settings__c`.  \n- **S3 + Salesforce Setup Guide** ‚Äì quick reference for configuring keys, permissions, and the LWC.\n\nAll components are editable ‚Äî extend, replace, or integrate with your own processes.\n\n---\n\n## üß± Requirements\n\n- n8n instance (self-hosted or Cloud) with HTTP Request, AWS S3, Slack, and Salesforce nodes.  \n- Salesforce org with API access & permission to install unmanaged packages.  \n- You have to have **Query All Files** permission. Setup-&gt; Permission Sets / Profile -&gt; App Permission -&gt; Content -&gt; Query All Files. Allows View All Data users to SOQL query all files in the org.\n- AWS S3 bucket + IAM user/role with `GetObject`/`PutObject` (and optional `ListBucket`).  \n\n",
  "featuredImage": "/data/workflows/6305/6305.webp",
  "author": {
    "id": 101,
    "slug": "leeseifer",
    "name": "Le Nguyen",
    "avatar": ""
  },
  "categories": [
    "File Management"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 113,
  "downloads": 11,
  "createdAt": "2025-07-23T06:15:02.427Z",
  "updatedAt": "2026-01-16T08:44:21.253Z",
  "publishedAt": "2025-07-23T06:15:02.427Z",
  "nodes": 23,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/6305",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Salesforce to S3 file migration & cleanup",
    "workflowName": "Salesforce to S3 file migration & cleanup",
    "description": "# Salesforce to S3 File Migration & Cleanup\n\nAutomate archiving old Salesforce files to Amazon S3, log them back in Salesforce, and free up org storage ‚Äî all from a scheduled n8n workflow.\n\n---\n\n## üîß How It Works (High-Level)\n\n1. **Schedule Trigger** kicks off (e.g., daily).  \n2. **Query Salesforce** for `ContentDocument` records older than 365 days.  \n3. **Loop Each File** ‚Üí download binary via REST.  \n4. **Upload to S3** with the original filename.  \n5. **Lookup Links** (`ContentDocumentLink`) to keep the parent record reference.  \n6. **Filter Out Users** (ignore `LinkedEntityId` starting with `005`).  \n7. **Create `S3_File__c`** record in Salesforce for traceability.  \n8. **Delete Original File** from Salesforce to reclaim storage.  \n9. **Notify via Slack** when the batch is done.\n\n![Screenshot 20250723 135316.png](fileId:1840)\n---\n\n## üöÄ Set Up Steps (Time: ~45‚Äì90 mins)\n\n1. **Import n8n Workflow JSON** and wire up credentials (Salesforce OAuth2, AWS S3, Slack).  \n2. **Install Salesforce Unmanaged Package** (Custom Object `S3_File__c`, Apex controller, LWC, settings).  \n3. **Fill `S3Settings__c`** (bucket, region, keys, expiry) or swap to Named Credentials.  \n4. **Test with a Sandbox Batch** (e.g., small date range) and verify upload/delete.  \n5. **Schedule & Monitor** (tweak interval, Slack channel).\n\n\n---\n\n## üíñ Why you‚Äôll love it\n- üí∏ **Slash storage costs** ‚Äî offload gigabytes to S3  \n- üîç **Full traceability** ‚Äî every file still tracked in Salesforce  \n- üß∞ **Plug & play** ‚Äî import JSON, install package, plug in creds  \n- üß± **Modular & extensible** ‚Äî swap S3, add approvals, build an uploader UI  \n- ‚è± **Set it & forget it** ‚Äî scheduled automation + Slack alerts\n\n## üì¶ What‚Äôs Included\n\n- **n8n JSON Flow** ‚Äì ready to import.  \n- **Salesforce Unmanaged Package** ‚Äì Apex (`S3FilesController.cls`), LWC (`s3FilesViewer`), `S3_File__c`, `S3Settings__c`.  \n- **S3 + Salesforce Setup Guide** ‚Äì quick reference for configuring keys, permissions, and the LWC.\n\nAll components are editable ‚Äî extend, replace, or integrate with your own processes.\n\n---\n\n## üß± Requirements\n\n- n8n instance (self-hosted or Cloud) with HTTP Request, AWS S3, Slack, and Salesforce nodes.  \n- Salesforce org with API access & permission to install unmanaged packages.  \n- You have to have **Query All Files** permission. Setup-&gt; Permission Sets / Profile -&gt; App Permission -&gt; Content -&gt; Query All Files. Allows View All Data users to SOQL query all files in the org.\n- AWS S3 bucket + IAM user/role with `GetObject`/`PutObject` (and optional `ListBucket`).",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "role": "scheduleTrigger",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Loop Over Each File Record",
      "type": "n8n-nodes-base.splitInBatches",
      "role": "splitInBatches",
      "configDescription": "Version 3"
    },
    {
      "name": "Download File Content",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Upload to S3",
      "type": "n8n-nodes-base.awsS3",
      "role": "awsS3",
      "configDescription": "Version 2"
    },
    {
      "name": "Get LinkedEntityId from ContentDocumentLink",
      "type": "n8n-nodes-base.salesforce",
      "role": "salesforce",
      "configDescription": "Version 1"
    },
    {
      "name": "Filter Out User Attachments",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Create S3_File__c Record",
      "type": "n8n-nodes-base.salesforce",
      "role": "salesforce",
      "configDescription": "Version 1"
    },
    {
      "name": "Prepare ContentDocumentId for Deletion",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Delete Original File in Salesforce",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Send Slack Notification",
      "type": "n8n-nodes-base.slack",
      "role": "slack",
      "configDescription": "Version 2.3"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Get All ContentDocuments older than 365 days ago",
      "type": "n8n-nodes-base.salesforce",
      "role": "salesforce",
      "configDescription": "Version 1"
    }
  ]
}