{
  "id": 7595,
  "slug": "7595",
  "title": "Automate video uploads to thumbnails with FFmpeg and Google Drive",
  "description": "# Automate Video Upload → Auto-Thumbnail → Google Drive\n\nThis workflow accepts a video via HTTP upload, verifies it’s a valid video, extracts a thumbnail frame at the **5-second** mark using **FFmpeg** (auto-installs a static build if missing), uploads the image to a specified **Google Drive** folder and returns a structured JSON response containing the new file’s details.\n\n## Who’s it for\n\n* **Marketing / Social teams** who need ready-to-publish thumbnails from raw uploads.\n* **Developers** who want an API-first thumbnail microservice without standing up extra infrastructure.\n* **Agencies / Creators** standardizing assets in a shared Drive.\n\n## How it works\n\n1. **Accept Video Upload (Webhook)**\n   Receives `multipart/form-data` with file in field `media` at `/mediaUpload`. Response is deferred until the final node.\n2. **Validate Upload is Video (IF)**\n   Checks `{{$binary.media.mimeType}}` contains `video/`. Non-video payloads can be rejected with HTTP 400.\n3. **Persist Upload to /tmp (Write Binary File)**\n   Writes the uploaded file to `/tmp/&lt;originalFilename or input.mp4&gt;` for stable processing.\n4. **Extract Thumbnail with FFmpeg (Execute Command)**\n   * Uses system `ffmpeg` if available; otherwise downloads a static binary to `/tmp/ffmpeg`.\n   * Runs: `ffmpeg -y -ss 5 -i <video> -frames:v 1 -q:v 2 /tmp/thumbnail.jpg`\n5. **Load Thumbnail from Disk (Read Binary File)**\n   Reads `/tmp/thumbnail.jpg` into the item’s binary as `thumbnail`.\n6. **Upload Thumbnail to Drive (Google Drive)**\n   Uploads to your target folder. File name is `&lt;original&gt;-thumb.jpg`.\n7. **Return API Response (Respond to Webhook)**\n   Sends JSON to the client including Drive file `id`, `name`, links, size, and checksums (if available).\n\n## How to set up\n\n1. **Import the workflow JSON** into n8n.\n2. **Google Drive**\n   * Create (or choose) a destination folder; copy its **Folder ID**.\n   * Add **Google Drive OAuth2** credentials in n8n and select them in the Drive node.\n   * Set the folder in the Drive “Upload” node.\n3. **Webhook**\n   * The endpoint is `POST /webhook/mediaUpload`.\n   * Test:\n     ```bash\n     curl -X POST https://YOUR-N8N-URL/webhook/mediaUpload \\\n       -F \"media=@/path/to/video.mp4\"\n     ```\n4. **FFmpeg**\n   * Nothing to install manually: the Execute Command node auto-installs a static `ffmpeg` if it’s not present.\n   * (Optional) If running n8n in Docker and you want permanence, use an image that includes `ffmpeg`.\n5. **Response body**\n   * The Respond node returns JSON with file metadata. You can customize the fields as needed.\n6. **(Optional) Non-video branch**\n   * On the IF node’s **false** output, add a Respond node with HTTP **400** and a helpful message.\n\n## Requirements\n* n8n instance with **Execute Command** node enabled (self-hosted/container/VM).\n* **Outbound network** access (to fetch static FFmpeg if not installed).\n* **Google Drive OAuth2** credential with permission to the destination folder.\n* Adequate temp space in `/tmp` for the uploaded video and generated thumbnail.\n\n## How to customize\n\n* **Timestamp**: change `-ss 5` to another second, or parameterize it via query/body (e.g., `timestamp=15`).\n* **Multiple thumbnails**: duplicate the FFmpeg + Read steps with `-ss 5`, `-ss 15`, `-ss 30`, suffix names `-thumb-5.jpg`, etc.\n* **File naming**: include the upload time or Drive file ID: `{{ base + '-' + $now + '-thumb.jpg' }}`.\n* **Public sharing**: add a **Drive → Permission: Create** node (Role: `reader`, Type: `anyone`) and return `webViewLink`.\n* **Output target**: replace the Drive node with **S3 Upload** or **Zoho WorkDrive (HTTP Request)** if needed.\n* **Validation**: enforce max file size/MIME whitelist in a small Function node before writing to disk.\n* **Logging**: append a row to Google Sheets/Notion with `sourceFile`, `thumbId`, `size`, `duration`, `status`.\n\n## Add-ons\n\n* **Slack / Teams notification** with the uploaded thumbnail link.\n* **Image optimization** (e.g., convert to WebP or resize variants).\n* **Retry & alerts** via error trigger workflow.\n* **Audit log** to a database (e.g., Postgres) for observability.\n\n## Use Case Examples\n\n* **CMS ingestion**: Editors upload videos; workflow returns a thumbnail URL to store alongside the article.\n* **Social scheduling**: Upload longform to generate a quick hero image for a post.\n* **Client portals**: Clients drop raw footage; you keep thumbnails uniform in one Drive folder.\n\n## Common troubleshooting\n\n| Issue                                                 | Possible Cause                                         | Solution                                                                                                         |\n| ----------------------------------------------------- | ------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------- |\n| `ffmpeg: not found`                                   | System lacks ffmpeg and static build couldn’t download | Ensure outbound HTTPS allowed; keep the auto-installer lines intact; or use a Docker image that includes ffmpeg. |\n| Webhook returns 400 “not a video”                     | Wrong field name or non-video MIME                     | Send file in `media` field; ensure it’s `video/*`.                                                               |\n| Drive upload fails (`403` / insufficient permissions) | OAuth scope or account lacks folder access             | Reconnect Drive credential; verify the destination **Folder ID** and sharing/ownership.                          |\n| Response missing `webViewLink` / `webContentLink`     | Drive node not returning link fields                   | Enable link fields in the Drive node or build URLs using the returned `id`.                                      |\n| `413 Payload Too Large` at reverse proxy              | Proxy limits on upload size                            | Increase body size limits in your proxy (e.g., Nginx `client_max_body_size`).                                    |\n| Disk full / ENOSPC                                    | Large uploads filling `/tmp`                           | Increase temp storage; keep **Cleanup** step; consider size caps and early rejection.                            |\n| Corrupt thumbnail or black frame                      | Timestamp lands on a black frame                       | Change `-ss` or use `-ss` *before* `-i` vs. after; try different seconds (e.g., 1–3s).                           |\n| Slow extraction                                       | Large or remote files; cold FFmpeg download            | Warm the container; host near upload source; keep static ffmpeg cached in image.                                 |\n| Duplicate outputs                                     | Repeat requests with same video/name                   | Add a de-dup check (query Drive for existing `&lt;base&gt;-thumb.jpg` before upload).                                  |\n\n## Need Help?\n\nWant this wired to **S3 or Zoho WorkDrive** or to generate **multiple timestamps** and **public links** out of the box? We're happy to help.",
  "featuredImage": "/data/workflows/7595/7595.webp",
  "author": {
    "id": 101,
    "slug": "weblineindia",
    "name": "WeblineIndia",
    "avatar": ""
  },
  "categories": [
    "Content Creation",
    "Multimodal AI"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 1140,
  "downloads": 114,
  "createdAt": "2025-08-19T14:25:55.838Z",
  "updatedAt": "2026-01-16T08:51:17.545Z",
  "publishedAt": "2025-08-19T14:25:55.838Z",
  "nodes": 9,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/7595",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Automate video uploads to thumbnails with FFmpeg and Google Drive",
    "workflowName": "Automate video uploads to thumbnails with FFmpeg and Google Drive",
    "description": "# Automate Video Upload → Auto-Thumbnail → Google Drive\n\nThis workflow accepts a video via HTTP upload, verifies it’s a valid video, extracts a thumbnail frame at the **5-second** mark using **FFmpeg** (auto-installs a static build if missing), uploads the image to a specified **Google Drive** folder and returns a structured JSON response containing the new file’s details.\n\n## Who’s it for\n\n* **Marketing / Social teams** who need ready-to-publish thumbnails from raw uploads.\n* **Developers** who want an API-first thumbnail microservice without standing up extra infrastructure.\n* **Agencies / Creators** standardizing assets in a shared Drive.\n\n## How it works\n\n1. **Accept Video Upload (Webhook)**\n   Receives `multipart/form-data` with file in field `media` at `/mediaUpload`. Response is deferred until the final node.\n2. **Validate Upload is Video (IF)**\n   Checks `{{$binary.media.mimeType}}` contains `video/`. Non-video payloads can be rejected with HTTP 400.\n3. **Persist Upload to /tmp (Write Binary File)**\n   Writes the uploaded file to `/tmp/&lt;originalFilename or input.mp4&gt;` for stable processing.\n4. **Extract Thumbnail with FFmpeg (Execute Command)**\n   * Uses system `ffmpeg` if available; otherwise downloads a static binary to `/tmp/ffmpeg`.\n   * Runs: `ffmpeg -y -ss 5 -i <video> -frames:v 1 -q:v 2 /tmp/thumbnail.jpg`\n5. **Load Thumbnail from Disk (Read Binary File)**\n   Reads `/tmp/thumbnail.jpg` into the item’s binary as `thumbnail`.\n6. **Upload Thumbnail to Drive (Google Drive)**\n   Uploads to your target folder. File name is `&lt;original&gt;-thumb.jpg`.\n7. **Return API Response (Respond to Webhook)**\n   Sends JSON to the client including Drive file `id`, `name`, links, size, and checksums (if available).\n\n## How to set up\n\n1. **Import the workflow JSON** into n8n.\n2. **Google Drive**\n   * Create (or choose) a destination folder; copy its **Folder ID**.\n   * Add **Google Drive OAuth2** credentials in n8n and select them in the Drive node.\n   * Set the folder in the Drive “Upload” node.\n3. **Webhook**\n   * The endpoint is `POST /webhook/mediaUpload`.\n   * Test:\n     ```bash\n     curl -X POST https://YOUR-N8N-URL/webhook/mediaUpload \\\n       -F \"media=@/path/to/video.mp4\"\n     ```\n4. **FFmpeg**\n   * Nothing to install manually: the Execute Command node auto-installs a static `ffmpeg` if it’s not present.\n   * (Optional) If running n8n in Docker and you want permanence, use an image that includes `ffmpeg`.\n5. **Response body**\n   * The Respond node returns JSON with file metadata. You can customize the fields as needed.\n6. **(Optional) Non-video branch**\n   * On the IF node’s **false** output, add a Respond node with HTTP **400** and a helpful message.\n\n## Requirements\n* n8n instance with **Execute Command** node enabled (self-hosted/container/VM).\n* **Outbound network** access (to fetch static FFmpeg if not installed).\n* **Google Drive OAuth2** credential with permission to the destination folder.\n* Adequate temp space in `/tmp` for the uploaded video and generated thumbnail.\n\n## How to customize\n\n* **Timestamp**: change `-ss 5` to another second, or parameterize it via query/body (e.g., `timestamp=15`).\n* **Multiple thumbnails**: duplicate the FFmpeg + Read steps with `-ss 5`, `-ss 15`, `-ss 30`, suffix names `-thumb-5.jpg`, etc.\n* **File naming**: include the upload time or Drive file ID: `{{ base + '-' + $now + '-thumb.jpg' }}`.\n* **Public sharing**: add a **Drive → Permission: Create** node (Role: `reader`, Type: `anyone`) and return `webViewLink`.\n* **Output target**: replace the Drive node with **S3 Upload** or **Zoho WorkDrive (HTTP Request)** if needed.\n* **Validation**: enforce max file size/MIME whitelist in a small Function node before writing to disk.\n* **Logging**: append a row to Google Sheets/Notion with `sourceFile`, `thumbId`, `size`, `duration`, `status`.\n\n## Add-ons\n\n* **Slack / Teams notification** with the uploaded thumbnail link.\n* **Image optimization** (e.g., convert to WebP or resize variants).\n* **Retry & alerts** via error trigger workflow.\n* **Audit log** to a database (e.g., Postgres) for observability.\n\n## Use Case Examples\n\n* **CMS ingestion**: Editors upload videos; workflow returns a thumbnail URL to store alongside the article.\n* **Social scheduling**: Upload longform to generate a quick hero image for a post.\n* **Client portals**: Clients drop raw footage; you keep thumbnails uniform in one Drive folder.\n\n## Common troubleshooting\n\n| Issue                                                 | Possible Cause                                         | Solution                                                                                                         |\n| ----------------------------------------------------- | ------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------- |\n| `ffmpeg: not found`                                   | System lacks ffmpeg and static build couldn’t download | Ensure outbound HTTPS allowed; keep the auto-installer lines intact; or use a Docker image that includes ffmpeg. |\n| Webhook returns 400 “not a video”                     | Wrong field name or non-video MIME                     | Send file in `media` field; ensure it’s `video/*`.                                                               |\n| Drive upload fails (`403` / insufficient permissions) | OAuth scope or account lacks folder access             | Reconnect Drive credential; verify the destination **Folder ID** and sharing/ownership.                          |\n| Response missing `webViewLink` / `webContentLink`     | Drive node not returning link fields                   | Enable link fields in the Drive node or build URLs using the returned `id`.                                      |\n| `413 Payload Too Large` at reverse proxy              | Proxy limits on upload size                            | Increase body size limits in your proxy (e.g., Nginx `client_max_body_size`).                                    |\n| Disk full / ENOSPC                                    | Large uploads filling `/tmp`                           | Increase temp storage; keep **Cleanup** step; consider size caps and early rejection.                            |\n| Corrupt thumbnail or black frame                      | Timestamp lands on a black frame                       | Change `-ss` or use `-ss` *before* `-i` vs. after; try different seconds (e.g., 1–3s).                           |\n| Slow extraction                                       | Large or remote files; cold FFmpeg download            | Warm the container; host near upload source; keep static ffmpeg cached in image.                                 |\n| Duplicate outputs                                     | Repeat requests with same video/name                   | Add a de-dup check (query Drive for existing `&lt;base&gt;-thumb.jpg` before upload).                                  |\n\n## Need Help?\n\nWant this wired to **S3 or Zoho WorkDrive** or to generate **multiple timestamps** and **public links** out of the box? We're happy to help.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Accept Video Upload (Webhook)",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 1"
    },
    {
      "name": "Validate Upload is Video (IF)",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2"
    },
    {
      "name": "Persist Upload to /tmp (Write Binary File)",
      "type": "n8n-nodes-base.writeBinaryFile",
      "role": "writeBinaryFile",
      "configDescription": "Version 1"
    },
    {
      "name": "Extract Thumbnail with FFmpeg (Auto-Install) (Execute Command)",
      "type": "n8n-nodes-base.executeCommand",
      "role": "executeCommand",
      "configDescription": "Version 1"
    },
    {
      "name": "Load Thumbnail from Disk (Read Binary File)",
      "type": "n8n-nodes-base.readBinaryFile",
      "role": "readBinaryFile",
      "configDescription": "Version 1"
    },
    {
      "name": "Upload Thumbnail to Drive (Google Drive)",
      "type": "n8n-nodes-base.googleDrive",
      "role": "googleDrive",
      "configDescription": "Version 3"
    },
    {
      "name": "Return API Response (Respond to Webhook)",
      "type": "n8n-nodes-base.respondToWebhook",
      "role": "respondToWebhook",
      "configDescription": "Version 1"
    }
  ]
}