{
  "id": 9969,
  "slug": "9969",
  "title": "Automate review request via WhatsApp for completed WooCommerce order with Rapiwa",
  "description": "## Who is this for?\nThis workflow is designed for online store owners, customer-success teams, and marketing operators who want to automatically verify customers' WhatsApp numbers and deliver order updates or invoice links via WhatsApp. It is built around WooCommerce order WooCommerce Trigger (order.updated) but is easily adaptable to Shopify or other platforms that provide billing and line_items in the WooCommerce Trigger payload.\n\n## What this Workflow Does / Key Features\n- Listens for WooCommerce order events (example: order.updated) via a Webhook or a WooCommerce trigger.\n- Filters only orders with status \"completed\" and maps the payload into a normalized object: { data: { customer, products, invoice_link } } using the Code node `Order Completed check`.\n- Iterates over line items using `SplitInBatches` to control throughput.\n- Cleans phone numbers (`Clean WhatsApp Number` code node) by removing all non-digit characters.\n- Verifies whether the cleaned phone number is registered on WhatsApp using Rapiwa's verify endpoint `(POST https://app.rapiwa.com/api/verify-whatsapp)`.\n- If verified, sends a templated WhatsApp message via Rapiwa `(POST https://app.rapiwa.com/api/send-message)`.\n- Appends an audit row to a \"Verified & Sent\" Google Sheet for successful sends, or to an \"Unverified & Not Sent\" sheet for unverified numbers.\n- Uses `Wait` and batching to throttle requests and avoid API rate limits.\n\n## Requirements\n- HTTP Bearer credential for Rapiwa (example name in flow: `Rapiwa Bearer Auth`).\n- WooCommerce API credential for the trigger (example: `WooCommerce (get customer)`)\n- Running n8n instance with nodes: WooCommerce Trigger, Code, SplitInBatches, HTTP Request, IF, Google Sheets, Wait.\n- Rapiwa account and a valid Bearer token.\n- Google account with Sheets access and OAuth2 credentials configured in n8n.\n- WooCommerce store (or any WooCommerce Trigger source) that provides `billing` and `line_items` in the payload.\n\n## How to Use — step-by-step Setup\n1) Credentials\n   - Rapiwa: Create an HTTP Bearer credential in n8n and paste your token (flow example name: `Rapiwa Bearer Auth`).\n   - Google Sheets: Add an OAuth2 credential (flow example name: `Google Sheets`).\n   - WooCommerce: Add the WooCommerce API credential or configure a Webhook on your store.\n\n\n3) Configure Google Sheets\n   - The exported flow uses spreadsheet ID: 1S3RtGt5xxxxxxxXmQi_s (Sheet gid=0) as an example. Replace with your spreadsheet ID and sheet gid.\n   - Ensure your sheet column headers exactly match the mapping keys listed below (case and trailing spaces must match or be corrected in the mapping).\n\n5) Verify HTTP Request nodes\n   - Verify endpoint: POST https://app.rapiwa.com/api/verify-whatsapp — sends { number } (uses HTTP Bearer credential).\n   - Send endpoint: POST https://app.rapiwa.com/api/send-message — sends number, message_type=text, and a templated message that uses fields from the `Clean WhatsApp Number` output.\n\n\n\n## Google Sheet Column Structure\nThe Google Sheets nodes in the flow append rows with these column keys. Make sure the spreadsheet headers \n**A Google Sheet formatted like this** ➤ [sample](https://docs.google.com/spreadsheets/d/1S3RtGt5tGk2sLLm9XQTI9C1C0bq2jx3TNuGQnXmQi_s/edit?usp=sharing)\n\n| Name           | Number        | Email             | Address                                  | Product Title               | Product ID | Total Price   | Invoice Link                                                                                                  | Delivery Status | Validity   | Status    |\n|----------------|---------------|-------------------|------------------------------------------|-----------------------------|------------|---------------|--------------------------------------------------------------------------------------------------------------|-----------------|------------|-----------|\n| Abdul Mannan | 8801322827799 | contact@spagreen.net   | mirpur dohs                             | Air force 1 Fossil 1:1 - 44 | 238        | BDT 5500.00   | [Invoice link](https://your_shop_domain/oxxxxoWRWqd) | completed       | verified   | sent      |\n| Abdul Mannan | 8801322827799 | contact@spagreen.net   | mirpur dohs h#1168 rd#10 av#10 mirpur dohs dhaka | Air force 1 Fossil 1:1 - 44 | 238        | BDT 5500.00   | [Invoice link](https://your_shop_domain/cxxxxuhtbLoWRWqd) | completed       | unverified | not sent  |\n\n\n## Important Notes\n- Do not hard-code API keys or tokens; always use n8n credentials.\n- Google Sheets column header names must match the mapping keys used in the nodes. Trailing spaces are common accidental problems — trim them in the spreadsheet or adjust the mapping.\n- The IF node in the exported flow compares to the string `\"true\"`. If the verify endpoint returns boolean true/false, convert to string or boolean consistently before the IF.\n- Message templates in the flow reference `$('Clean WhatsApp Number').item.json.data.products[0]` — update templates if you need multiple-product support.\n\n## Useful Links\n- **Dashboard:** [https://app.rapiwa.com](https://app.rapiwa.com/login)\n- **Official Website:** [https://rapiwa.com](https://rapiwa.com/)\n- **Documentation:** [https://docs.rapiwa.com](https://docs.rapiwa.com/)\n\n## Support & Help\n- **WhatsApp**: [Chat on WhatsApp](https://wa.me/8801322827799)\n- **Discord**: [SpaGreen Community](https://discord.gg/SsCChWEP)\n- **Facebook Group**: [SpaGreen Support](https://www.facebook.com/groups/spagreenbd)\n- **Website**: [https://spagreen.net](https://spagreen.net)\n- **Developer Portfolio**: [Codecanyon SpaGreen](https://codecanyon.net/user/spagreen/portfolio)\n",
  "featuredImage": "/data/workflows/9969/9969.webp",
  "author": {
    "id": 101,
    "slug": "rapiwa",
    "name": "Rapiwa",
    "avatar": ""
  },
  "categories": [
    "Lead Nurturing"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 165,
  "downloads": 16,
  "createdAt": "2025-10-21T05:10:46.311Z",
  "updatedAt": "2026-01-16T09:02:48.179Z",
  "publishedAt": "2025-10-21T05:10:46.311Z",
  "nodes": 15,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/9969",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Automate review request via WhatsApp for completed WooCommerce order with Rapiwa",
    "workflowName": "Automate review request via WhatsApp for completed WooCommerce order with Rapiwa",
    "description": "## Who is this for?\nThis workflow is designed for online store owners, customer-success teams, and marketing operators who want to automatically verify customers' WhatsApp numbers and deliver order updates or invoice links via WhatsApp. It is built around WooCommerce order WooCommerce Trigger (order.updated) but is easily adaptable to Shopify or other platforms that provide billing and line_items in the WooCommerce Trigger payload.\n\n## What this Workflow Does / Key Features\n- Listens for WooCommerce order events (example: order.updated) via a Webhook or a WooCommerce trigger.\n- Filters only orders with status \"completed\" and maps the payload into a normalized object: { data: { customer, products, invoice_link } } using the Code node `Order Completed check`.\n- Iterates over line items using `SplitInBatches` to control throughput.\n- Cleans phone numbers (`Clean WhatsApp Number` code node) by removing all non-digit characters.\n- Verifies whether the cleaned phone number is registered on WhatsApp using Rapiwa's verify endpoint `(POST https://app.rapiwa.com/api/verify-whatsapp)`.\n- If verified, sends a templated WhatsApp message via Rapiwa `(POST https://app.rapiwa.com/api/send-message)`.\n- Appends an audit row to a \"Verified & Sent\" Google Sheet for successful sends, or to an \"Unverified & Not Sent\" sheet for unverified numbers.\n- Uses `Wait` and batching to throttle requests and avoid API rate limits.\n\n## Requirements\n- HTTP Bearer credential for Rapiwa (example name in flow: `Rapiwa Bearer Auth`).\n- WooCommerce API credential for the trigger (example: `WooCommerce (get customer)`)\n- Running n8n instance with nodes: WooCommerce Trigger, Code, SplitInBatches, HTTP Request, IF, Google Sheets, Wait.\n- Rapiwa account and a valid Bearer token.\n- Google account with Sheets access and OAuth2 credentials configured in n8n.\n- WooCommerce store (or any WooCommerce Trigger source) that provides `billing` and `line_items` in the payload.\n\n## How to Use — step-by-step Setup\n1) Credentials\n   - Rapiwa: Create an HTTP Bearer credential in n8n and paste your token (flow example name: `Rapiwa Bearer Auth`).\n   - Google Sheets: Add an OAuth2 credential (flow example name: `Google Sheets`).\n   - WooCommerce: Add the WooCommerce API credential or configure a Webhook on your store.\n\n\n3) Configure Google Sheets\n   - The exported flow uses spreadsheet ID: 1S3RtGt5xxxxxxxXmQi_s (Sheet gid=0) as an example. Replace with your spreadsheet ID and sheet gid.\n   - Ensure your sheet column headers exactly match the mapping keys listed below (case and trailing spaces must match or be corrected in the mapping).\n\n5) Verify HTTP Request nodes\n   - Verify endpoint: POST https://app.rapiwa.com/api/verify-whatsapp — sends { number } (uses HTTP Bearer credential).\n   - Send endpoint: POST https://app.rapiwa.com/api/send-message — sends number, message_type=text, and a templated message that uses fields from the `Clean WhatsApp Number` output.\n\n\n\n## Google Sheet Column Structure\nThe Google Sheets nodes in the flow append rows with these column keys. Make sure the spreadsheet headers \n**A Google Sheet formatted like this** ➤ [sample](https://docs.google.com/spreadsheets/d/1S3RtGt5tGk2sLLm9XQTI9C1C0bq2jx3TNuGQnXmQi_s/edit?usp=sharing)\n\n| Name           | Number        | Email             | Address                                  | Product Title               | Product ID | Total Price   | Invoice Link                                                                                                  | Delivery Status | Validity   | Status    |\n|----------------|---------------|-------------------|------------------------------------------|-----------------------------|------------|---------------|--------------------------------------------------------------------------------------------------------------|-----------------|------------|-----------|\n| Abdul Mannan | 8801322827799 | contact@spagreen.net   | mirpur dohs                             | Air force 1 Fossil 1:1 - 44 | 238        | BDT 5500.00   | [Invoice link](https://your_shop_domain/oxxxxoWRWqd) | completed       | verified   | sent      |\n| Abdul Mannan | 8801322827799 | contact@spagreen.net   | mirpur dohs h#1168 rd#10 av#10 mirpur dohs dhaka | Air force 1 Fossil 1:1 - 44 | 238        | BDT 5500.00   | [Invoice link](https://your_shop_domain/cxxxxuhtbLoWRWqd) | completed       | unverified | not sent  |\n\n\n## Important Notes\n- Do not hard-code API keys or tokens; always use n8n credentials.\n- Google Sheets column header names must match the mapping keys used in the nodes. Trailing spaces are common accidental problems — trim them in the spreadsheet or adjust the mapping.\n- The IF node in the exported flow compares to the string `\"true\"`. If the verify endpoint returns boolean true/false, convert to string or boolean consistently before the IF.\n- Message templates in the flow reference `$('Clean WhatsApp Number').item.json.data.products[0]` — update templates if you need multiple-product support.\n\n## Useful Links\n- **Dashboard:** [https://app.rapiwa.com](https://app.rapiwa.com/login)\n- **Official Website:** [https://rapiwa.com](https://rapiwa.com/)\n- **Documentation:** [https://docs.rapiwa.com](https://docs.rapiwa.com/)\n\n## Support & Help\n- **WhatsApp**: [Chat on WhatsApp](https://wa.me/8801322827799)\n- **Discord**: [SpaGreen Community](https://discord.gg/SsCChWEP)\n- **Facebook Group**: [SpaGreen Support](https://www.facebook.com/groups/spagreenbd)\n- **Website**: [https://spagreen.net](https://spagreen.net)\n- **Developer Portfolio**: [Codecanyon SpaGreen](https://codecanyon.net/user/spagreen/portfolio)",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "If",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Wait",
      "type": "n8n-nodes-base.wait",
      "role": "wait",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "role": "splitInBatches",
      "configDescription": "Version 3"
    },
    {
      "name": "Clean WhatsApp Number",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Order Completed check",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Save State of Rows in Verified & Sent",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.6"
    },
    {
      "name": "Save State of Rows in Unerified & Not sent",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.6"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "WooCommerce Trigger",
      "type": "n8n-nodes-base.wooCommerceTrigger",
      "role": "wooCommerceTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Rapiwa",
      "type": "n8n-nodes-rapiwa.rapiwa",
      "role": "rapiwa",
      "configDescription": "Version 1"
    },
    {
      "name": "Rapiwa (send message)",
      "type": "n8n-nodes-rapiwa.rapiwa",
      "role": "rapiwa",
      "configDescription": "Version 1"
    }
  ]
}