{
  "id": 5174,
  "slug": "5174",
  "title": "ðŸ—² Creating a Secure Webhook - MUST HAVE",
  "description": "## How it works\n\nThis workflow demonstrates a fundamental pattern for securing a webhook by requiring an API key. It acts as a gatekeeper, checking for a valid key in the request header before allowing the request to proceed.\n\n1.  **Incoming Request:** The `Secured Webhook` node receives an incoming `POST` request. It expects an API key to be sent in the `x-api-key` header.\n2.  **API Key Verification:**\n    *   The `Check API Key` node takes the key from the incoming request's header.\n    *   It then makes an internal HTTP request to a *second* webhook (`Get API Key`) which acts as a mock database.\n    *   This second webhook retrieves a list of registered API keys (from the `Registered API Keys` node) and filters it to find a match for the key that was provided.\n3.  **Conditional Response:**\n    *   **If a match is found**, the `API Key Identified` node routes the execution to the \"success\" path, returning a `200 OK` response with the identified user's ID.\n    *   **If no match is found**, it routes to the \"unauthorized\" path, returning a `401 Unauthorized` error.\n\nThis pattern separates the public-facing endpoint from the data source, which is a good security practice.\n\n## Set up steps\n\n**Setup time: ~2 minutes**\n\nThis workflow is designed to be a self-contained example.\n\n1.  **Set up Credentials:** This workflow uses \"Header Auth\" for its internal communication. Go to **Credentials** and create a new **Header Auth** credential. You can use any name and value (e.g., Name: `X-N8N-Auth`, Value: `my-secret-password`). Select this credential in all four webhook/HTTP Request nodes.\n2.  **Add Your API Keys:** Open the **`Registered API Keys`** node. This is your mock database. Edit the array to include the `user_id` and `api_key` pairs you want to authorize.\n3.  **Activate the workflow.**\n4.  **Test it:** Use the **`Test Secure Webhook`** node to send a request.\n    *   Try it with a valid key from your list to see the success response.\n    *   Change the `x-api-key` header to an invalid key to see the `401 Unauthorized` error.\n\n**For Production:** Replace the mock database part of this workflow (the `Get API Key` webhook and `Registered API Keys` node) with a real database node like Supabase, Postgres, or Baserow to look up keys.",
  "featuredImage": "/data/workflows/5174/5174.webp",
  "author": {
    "id": 101,
    "slug": "lucaspeyrin",
    "name": "Lucas Peyrin",
    "avatar": ""
  },
  "categories": [
    "SecOps"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 5291,
  "downloads": 529,
  "createdAt": "2025-06-24T00:39:28.426Z",
  "updatedAt": "2026-01-16T08:38:06.505Z",
  "publishedAt": "2025-06-24T00:39:28.426Z",
  "nodes": 16,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/5174",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "ðŸ—² Creating a Secure Webhook - MUST HAVE",
    "workflowName": "ðŸ—² Creating a Secure Webhook - MUST HAVE",
    "description": "## How it works\n\nThis workflow demonstrates a fundamental pattern for securing a webhook by requiring an API key. It acts as a gatekeeper, checking for a valid key in the request header before allowing the request to proceed.\n\n1.  **Incoming Request:** The `Secured Webhook` node receives an incoming `POST` request. It expects an API key to be sent in the `x-api-key` header.\n2.  **API Key Verification:**\n    *   The `Check API Key` node takes the key from the incoming request's header.\n    *   It then makes an internal HTTP request to a *second* webhook (`Get API Key`) which acts as a mock database.\n    *   This second webhook retrieves a list of registered API keys (from the `Registered API Keys` node) and filters it to find a match for the key that was provided.\n3.  **Conditional Response:**\n    *   **If a match is found**, the `API Key Identified` node routes the execution to the \"success\" path, returning a `200 OK` response with the identified user's ID.\n    *   **If no match is found**, it routes to the \"unauthorized\" path, returning a `401 Unauthorized` error.\n\nThis pattern separates the public-facing endpoint from the data source, which is a good security practice.\n\n## Set up steps\n\n**Setup time: ~2 minutes**\n\nThis workflow is designed to be a self-contained example.\n\n1.  **Set up Credentials:** This workflow uses \"Header Auth\" for its internal communication. Go to **Credentials** and create a new **Header Auth** credential. You can use any name and value (e.g., Name: `X-N8N-Auth`, Value: `my-secret-password`). Select this credential in all four webhook/HTTP Request nodes.\n2.  **Add Your API Keys:** Open the **`Registered API Keys`** node. This is your mock database. Edit the array to include the `user_id` and `api_key` pairs you want to authorize.\n3.  **Activate the workflow.**\n4.  **Test it:** Use the **`Test Secure Webhook`** node to send a request.\n    *   Try it with a valid key from your list to see the success response.\n    *   Change the `x-api-key` header to an invalid key to see the `401 Unauthorized` error.\n\n**For Production:** Replace the mock database part of this workflow (the `Get API Key` webhook and `Registered API Keys` node) with a real database node like Supabase, Postgres, or Baserow to look up keys.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Registered API Keys",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "API Key Identified",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Respond to Webhook (success)",
      "type": "n8n-nodes-base.respondToWebhook",
      "role": "respondToWebhook",
      "configDescription": "Version 1.4"
    },
    {
      "name": "Respond to Webhook (unauthorized)",
      "type": "n8n-nodes-base.respondToWebhook",
      "role": "respondToWebhook",
      "configDescription": "Version 1.4"
    },
    {
      "name": "Secured Webhook",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 2"
    },
    {
      "name": "Check API Key",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Find API Key",
      "type": "n8n-nodes-base.filter",
      "role": "filter",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Get API Key",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 2"
    },
    {
      "name": "Split Out Users",
      "type": "n8n-nodes-base.splitOut",
      "role": "splitOut",
      "configDescription": "Version 1"
    },
    {
      "name": "Test Secure Webhook",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}