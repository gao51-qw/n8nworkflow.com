{
  "id": 2677,
  "slug": "2677",
  "title": "Analyze email headers for IP reputation and spoofing detection - Gmail",
  "description": "# Analyze Emails for Security Insights\n\n## Who is this for?\n\nThis workflow is ideal for IT professionals, security analysts, and organizations looking to enhance their email security practices. It is particularly useful for those who need to analyze Gmail email headers for IP tracking, spoofing detection, and sender reputation assessment. \n\n## What problem is this workflow solving?\n\nEmail spoofing and phishing attacks are significant cybersecurity threats. By analyzing email headers, this workflow provides detailed insights into the email's origin, authentication status, and the reputation of the sending IP address. It helps detect potential spoofing attempts and assess the trustworthiness of incoming emails.\n\n## What this workflow does\n\nThis n8n workflow automates the process of analyzing email headers received in Gmail. It performs the following key functions:\n\n1. **Triggering and Email Header Extraction:** It monitors Gmail inboxes for new emails and extracts their headers for analysis.\n2. **Authentication Analysis:** It validates SPF, DKIM, and DMARC authentication results to ensure the email adheres to industry-standard security protocols.\n3. **IP Analysis:** The workflow extracts the originating IP address and evaluates its reputation and geographic details using external APIs.\n4. **Reputation Scoring:** It integrates with IP Quality Score to detect spam activity and assess the sender's reputation.\n5. **Consolidation and Webhook Response:** All results are aggregated into a single JSON response, making it easy to integrate with third-party platforms or tools for further automation.\n\n## Setup\n\n1. **Authenticate Gmail:** Configure the `Gmail Trigger` node with your Gmail account credentials.\n2. **API Keys (Optional):**\n   - Obtain an API key for IP Quality Score (https://ipqualityscore.com).\n   - Ensure the IP-API endpoint is accessible.\n   - This step is optional as ipqualityscore.com will provide a limited number of free lookups each month. [See more details here](https://www.ipqualityscore.com/plans).  \n3. **Activate the Workflow:** Ensure the workflow is active to process incoming emails in real-time.\n\n## How to customize this workflow to your needs\n\n- **Add Alerts:** Use the `Gmail - Respond to Webhook` node to trigger notifications in Slack, email, or any other communication channel.\n- **Integrate with SIEM:** Forward the workflow output to SIEM tools like Splunk or ELK Stack for further analysis.\n- **Modify Validation Rules:** Update SPF, DKIM, or DMARC logic in the `Set` nodes to align with your organization’s security policies.\n- **Expand IP Analysis:** Add more APIs or services to enrich IP reputation data, such as VirusTotal or AbuseIPDB.\n\n---\n\nThis workflow provides a robust foundation for email security monitoring and can be tailored to fit your organization's unique requirements. With its modular design and integration options, it’s a versatile tool to enhance your cybersecurity operations.",
  "featuredImage": "/data/workflows/2677/2677.webp",
  "author": {
    "id": 101,
    "slug": "djangelic",
    "name": "Angel Menendez",
    "avatar": ""
  },
  "categories": [
    "SecOps"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 16362,
  "downloads": 1636,
  "createdAt": "2024-12-27T06:47:56.660Z",
  "updatedAt": "2026-01-16T08:25:57.186Z",
  "publishedAt": "2024-12-27T06:47:56.660Z",
  "nodes": 40,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/2677",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Analyze email headers for IP reputation and spoofing detection - Gmail",
    "workflowName": "Analyze email headers for IP reputation and spoofing detection - Gmail",
    "description": "# Analyze Emails for Security Insights\n\n## Who is this for?\n\nThis workflow is ideal for IT professionals, security analysts, and organizations looking to enhance their email security practices. It is particularly useful for those who need to analyze Gmail email headers for IP tracking, spoofing detection, and sender reputation assessment. \n\n## What problem is this workflow solving?\n\nEmail spoofing and phishing attacks are significant cybersecurity threats. By analyzing email headers, this workflow provides detailed insights into the email's origin, authentication status, and the reputation of the sending IP address. It helps detect potential spoofing attempts and assess the trustworthiness of incoming emails.\n\n## What this workflow does\n\nThis n8n workflow automates the process of analyzing email headers received in Gmail. It performs the following key functions:\n\n1. **Triggering and Email Header Extraction:** It monitors Gmail inboxes for new emails and extracts their headers for analysis.\n2. **Authentication Analysis:** It validates SPF, DKIM, and DMARC authentication results to ensure the email adheres to industry-standard security protocols.\n3. **IP Analysis:** The workflow extracts the originating IP address and evaluates its reputation and geographic details using external APIs.\n4. **Reputation Scoring:** It integrates with IP Quality Score to detect spam activity and assess the sender's reputation.\n5. **Consolidation and Webhook Response:** All results are aggregated into a single JSON response, making it easy to integrate with third-party platforms or tools for further automation.\n\n## Setup\n\n1. **Authenticate Gmail:** Configure the `Gmail Trigger` node with your Gmail account credentials.\n2. **API Keys (Optional):**\n   - Obtain an API key for IP Quality Score (https://ipqualityscore.com).\n   - Ensure the IP-API endpoint is accessible.\n   - This step is optional as ipqualityscore.com will provide a limited number of free lookups each month. [See more details here](https://www.ipqualityscore.com/plans).  \n3. **Activate the Workflow:** Ensure the workflow is active to process incoming emails in real-time.\n\n## How to customize this workflow to your needs\n\n- **Add Alerts:** Use the `Gmail - Respond to Webhook` node to trigger notifications in Slack, email, or any other communication channel.\n- **Integrate with SIEM:** Forward the workflow output to SIEM tools like Splunk or ELK Stack for further analysis.\n- **Modify Validation Rules:** Update SPF, DKIM, or DMARC logic in the `Set` nodes to align with your organization’s security policies.\n- **Expand IP Analysis:** Add more APIs or services to enrich IP reputation data, such as VirusTotal or AbuseIPDB.\n\n---\n\nThis workflow provides a robust foundation for email security monitoring and can be tailored to fit your organization's unique requirements. With its modular design and integration options, it’s a versatile tool to enhance your cybersecurity operations.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Gmail Trigger",
      "type": "n8n-nodes-base.gmailTrigger",
      "role": "gmailTrigger",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Gmail - Extract Received Headers",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Gmail - Extract Original From IP",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - Original IP Found?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Gmail - Query IP Quality Score API",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Gmail - Query IP API",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Gmail - Authentication-Results Header?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Gmail - Received-SPF Header?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Gmail - Extract Authentication-Results Header",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Gmail - Extract Received-SPF Header",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Gmail - Determine Auth Values",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - Set SPF Value",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - No SPF Found",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - Format Output",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - DKIM Signature Found",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - DKIM-Signature Header?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Gmail - No DKIM Signature Found",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - Set DMARC Value",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - Extract DMARC Header",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Gmail - DMARC Header?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Gmail - No DMARC Header",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Set Gmail Headers Here",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Format Individual Auth Outputs1",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Format Combined Auth Output1",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - Webhook",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 2"
    },
    {
      "name": "Gmail - Remove Extra Received Headers",
      "type": "n8n-nodes-base.limit",
      "role": "limit",
      "configDescription": "Version 1"
    },
    {
      "name": "Gmail - Merge",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3"
    },
    {
      "name": "Gmail - Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "role": "aggregate",
      "configDescription": "Version 1"
    },
    {
      "name": "Gmail - Set Headers",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Gmail - Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "role": "respondToWebhook",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Aggregate Received-SPF Headers1",
      "type": "n8n-nodes-base.aggregate",
      "role": "aggregate",
      "configDescription": "Version 1"
    },
    {
      "name": "Set Gmail Webhook Headers Here",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Skip IP Check",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    }
  ]
}