{
  "id": 11977,
  "slug": "11977",
  "title": "Automate customer retention with AI risk prediction, Stripe coupons & personalized Gmail",
  "description": "# Predict churn risk from customer data and send retention emails via OpenAI\n\n\n## ğŸ‘¥ Whoâ€™s it for\nThis workflow is designed for **Customer Success Managers**, **Growth Teams**, and **SaaS Business Owners** who want to proactively reduce churn using AI. It automates the analysis of customer health and the delivery of personalized retention offers without manual intervention.\n\n\n## ğŸš€ What it does\nThis template acts as an intelligent retention system that connects your data, AI, and communication channels.\n1. **Aggregates Data:** Pulls customer profiles from your **CRM**, support ticket history via API, and product usage logs from **PostgreSQL**.\n2. **Predicts Risk:** Uses **OpenAI** to analyze the combined data and calculate a \"Churn Risk Score\" for each customer.\n3. **Automates Action:** For customers identified as high-risk (score &gt; 0.7):\n    - Generates a unique, dynamic discount coupon via **Stripe**.\n    - Drafts a highly personalized retention email using OpenAI.\n    - Sends the email via **Gmail**.\n4. **Tracks Effectiveness:** Logs all actions to **Google Sheets**. It also checks back (via **SendGrid** and CRM data) to track email opens and verify if the customer was retained after 30 days.\n\n\n## âš™ï¸ How to set up\n1. **Prepare Google Sheet:** Create a sheet with columns for `customer_id`, `risk_score`, `offer_type`, `email_status`, and `retention_result`.\n2. **Configure Credentials:** Set up your credentials for OpenAI, Stripe, Gmail, Google Sheets, SendGrid, and PostgreSQL.\n3. **API Endpoints:** Update the **HTTP Request** nodes to point to your specific CRM and Support tool APIs (replace the placeholder URLs).\n4. **Customize Logic:**\n    - In the **Postgres node**, adjust the SQL query to match your product's event table.\n    - In the **Code node** (Offer Decision), define your rules for discounts (e.g., \"Give 20% off if MRR &gt; $10k\").\n5. **Activate:** The workflow is set to run daily at 3:00 AM. Toggle the **Schedule Trigger** to `Active` when ready.\n\n\n## ğŸ“¦ Requirements\n- **n8n** (v1.0 or later)\n- **OpenAI** API Key\n- **Google Workspace** (Gmail, Sheets)\n- **Stripe** Account (for coupon generation)\n- **SendGrid** Account (for email tracking)\n- **PostgreSQL** (or similar database)\n- Access to CRM and Support Tool APIs\n\n\n## ğŸ¨ How to customize the workflow\n- **Adjust the AI Prompt:** Edit the **OpenAI node** system message to match your brand's tone of voice.\n- **Change the Threshold:** Modify the **If node** to target customers with a risk score higher or lower than 0.7.\n- **Internal Alerts:** Instead of emailing the customer directly, replace the **Gmail node** with a **Slack node** to notify your CSM team to reach out manually.\n- **Swap Database:** If you use MySQL or Snowflake, simply replace the PostgreSQL node with the corresponding n8n node.",
  "featuredImage": "/data/workflows/11977/11977.webp",
  "author": {
    "id": 101,
    "slug": "hayatofujita",
    "name": "HayatoFujita/è—¤ç”°éš¼äºº",
    "avatar": ""
  },
  "categories": [
    "Lead Nurturing",
    "AI Summarization"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 35,
  "downloads": 3,
  "createdAt": "2025-12-20T05:29:01.939Z",
  "updatedAt": "2026-01-16T09:10:52.003Z",
  "publishedAt": "2025-12-20T05:29:01.939Z",
  "nodes": 27,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/11977",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Automate customer retention with AI risk prediction, Stripe coupons & personalized Gmail",
    "workflowName": "Automate customer retention with AI risk prediction, Stripe coupons & personalized Gmail",
    "description": "# Predict churn risk from customer data and send retention emails via OpenAI\n\n\n## ğŸ‘¥ Whoâ€™s it for\nThis workflow is designed for **Customer Success Managers**, **Growth Teams**, and **SaaS Business Owners** who want to proactively reduce churn using AI. It automates the analysis of customer health and the delivery of personalized retention offers without manual intervention.\n\n\n## ğŸš€ What it does\nThis template acts as an intelligent retention system that connects your data, AI, and communication channels.\n1. **Aggregates Data:** Pulls customer profiles from your **CRM**, support ticket history via API, and product usage logs from **PostgreSQL**.\n2. **Predicts Risk:** Uses **OpenAI** to analyze the combined data and calculate a \"Churn Risk Score\" for each customer.\n3. **Automates Action:** For customers identified as high-risk (score &gt; 0.7):\n    - Generates a unique, dynamic discount coupon via **Stripe**.\n    - Drafts a highly personalized retention email using OpenAI.\n    - Sends the email via **Gmail**.\n4. **Tracks Effectiveness:** Logs all actions to **Google Sheets**. It also checks back (via **SendGrid** and CRM data) to track email opens and verify if the customer was retained after 30 days.\n\n\n## âš™ï¸ How to set up\n1. **Prepare Google Sheet:** Create a sheet with columns for `customer_id`, `risk_score`, `offer_type`, `email_status`, and `retention_result`.\n2. **Configure Credentials:** Set up your credentials for OpenAI, Stripe, Gmail, Google Sheets, SendGrid, and PostgreSQL.\n3. **API Endpoints:** Update the **HTTP Request** nodes to point to your specific CRM and Support tool APIs (replace the placeholder URLs).\n4. **Customize Logic:**\n    - In the **Postgres node**, adjust the SQL query to match your product's event table.\n    - In the **Code node** (Offer Decision), define your rules for discounts (e.g., \"Give 20% off if MRR &gt; $10k\").\n5. **Activate:** The workflow is set to run daily at 3:00 AM. Toggle the **Schedule Trigger** to `Active` when ready.\n\n\n## ğŸ“¦ Requirements\n- **n8n** (v1.0 or later)\n- **OpenAI** API Key\n- **Google Workspace** (Gmail, Sheets)\n- **Stripe** Account (for coupon generation)\n- **SendGrid** Account (for email tracking)\n- **PostgreSQL** (or similar database)\n- Access to CRM and Support Tool APIs\n\n\n## ğŸ¨ How to customize the workflow\n- **Adjust the AI Prompt:** Edit the **OpenAI node** system message to match your brand's tone of voice.\n- **Change the Threshold:** Modify the **If node** to target customers with a risk score higher or lower than 0.7.\n- **Internal Alerts:** Instead of emailing the customer directly, replace the **Gmail node** with a **Slack node** to notify your CSM team to reach out manually.\n- **Swap Database:** If you use MySQL or Snowflake, simply replace the PostgreSQL node with the corresponding n8n node.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Workflow Overview",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Schedule Trigger - æ¯æ—¥03:00å®Ÿè¡Œ",
      "type": "n8n-nodes-base.scheduleTrigger",
      "role": "scheduleTrigger",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Note - Schedule",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "å¯¾è±¡é¡§å®¢ãƒªã‚¹ãƒˆå–å¾— (CRM)",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "ã‚µãƒãƒ¼ãƒˆãƒã‚±ãƒƒãƒˆæƒ…å ±å–å¾—",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "ã‚µãƒãƒ¼ãƒˆæŒ‡æ¨™é›†è¨ˆ",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "è£½å“åˆ©ç”¨ãƒ­ã‚°å–å¾—",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "ãƒ‡ãƒ¼ã‚¿çµ±åˆ (CRM+ã‚µãƒãƒ¼ãƒˆ)",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3"
    },
    {
      "name": "ãƒ‡ãƒ¼ã‚¿çµ±åˆ (å…¨ãƒ‡ãƒ¼ã‚¿)",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3"
    },
    {
      "name": "AIè§£ç´„ãƒªã‚¹ã‚¯äºˆæ¸¬",
      "type": "n8n-nodes-base.openAi",
      "role": "openAi",
      "configDescription": "Version 1.1"
    },
    {
      "name": "é«˜ãƒªã‚¹ã‚¯é¡§å®¢ãƒ•ã‚£ãƒ«ã‚¿",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2"
    },
    {
      "name": "ç‰¹åˆ¥ã‚ªãƒ•ã‚¡ãƒ¼ç”Ÿæˆ",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "ã‚ªãƒ•ã‚¡ãƒ¼å†…å®¹æ±ºå®š",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãƒ¡ãƒ¼ãƒ«ç”Ÿæˆ",
      "type": "n8n-nodes-base.openAi",
      "role": "openAi",
      "configDescription": "Version 1.1"
    },
    {
      "name": "ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãƒ¡ãƒ¼ãƒ«é€ä¿¡",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "æ–½ç­–ãƒ­ã‚°ä¿å­˜",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.5"
    },
    {
      "name": "æœªæ›´æ–°ãƒ­ã‚°å–å¾—",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.5"
    },
    {
      "name": "ãƒ¡ãƒ¼ãƒ«é–‹å°çŠ¶æ³å–å¾—",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "é–‹å°ãƒ‡ãƒ¼ã‚¿å‡¦ç†",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "åŠ¹æœæ¸¬å®šãƒ‡ãƒ¼ã‚¿æ›´æ–°",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.5"
    },
    {
      "name": "30æ—¥çµŒéãƒ¬ã‚³ãƒ¼ãƒ‰å–å¾—",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.5"
    },
    {
      "name": "é¡§å®¢ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "ç¶™ç¶šçŠ¶æ³åˆ¤å®š",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "æœ€çµ‚çµæœæ›´æ–°",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.5"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}