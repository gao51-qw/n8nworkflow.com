{
  "id": 10901,
  "slug": "10901",
  "title": "Automate travel expense extraction with OCR, Mistral AI and Supabase",
  "description": "# Travel Reimbursement - OCR & Expense Extraction Workflow\n\n## Overview\nThis is a lightweight n8n workflow that accepts chat input and uploaded receipts, runs OCR, stores parsed results in Supabase, and uses an AI agent to extract structured travel expense data and compute totals. Designed for zero retention operation and fast integration.\n\n---\n\n## Workflow Structure\n- **Frontend:** Chat UI trigger that accepts text and file uploads.\n- **Preprocessing:** Binary normalization + per-file OCR request.\n- **Storage:** Store OCR-parsed blocks in Supabase `temp_table`.\n- **Core AI:** Travel reimbursement agent that extracts fields, infers missing values, and calculates totals using the Calculator tool.\n- **Output:** Agent responds to the chat with a concise expense summary and breakdowns.\n\n---\n\n## Chat Trigger (Frontend)\n- **Trigger node:** `When chat message received`\n  - `public: true`, `allowFileUploads: true`, sessionId used to tie uploads to the chat session.\n  - Custom CSS + initial messages configured for user experience.\n\n## Binary Presence Check\n- **Node:** `CHECK IF BINARY FILE IS PRESENT OR NOT` (IF)\n  - Checks whether incoming payload contains `files`.\n  - If files present -&gt; route to `Split Out` -&gt; `NORMALIZE binary file` -&gt; `OCR (ANY OCR API)` -&gt; `STORE OCR OUTPUT` -&gt; `Merge`.\n  - If no files -&gt; route directly to `Merge` -&gt; `Travel reimbursement agent`.\n\n## Binary Normalization\n- **Node:** `Split Out` and `NORMALIZE binary file` (Code)\n  - `Split Out` extracts binary entries into a `data` field.\n  - `NORMALIZE binary file` picks the first binary key and rewrites payload to `binary.data` for consistent downstream shape.\n\n## OCR\n- **Node:** `OCR (ANY OCR API )` (HTTP Request)\n  - Sends multipart/form-data to OCR endpoint, expects JSONL or JSON with `blocks`.\n  - Body includes `mode=single`, `output_type=jsonl`, `include_images=false`.\n\n## Store OCR Output\n- **Node:** `STORE OCR OUTPUT` (Supabase)\n  - Upserts into `temp_table` with `session_id`, parsed `blocks`, and `file_name`.\n  - Used by agent to fetch previously uploaded receipts for same session.\n\n## Memory & Tooling\n- **Nodes:** `Simple Memory` and `Simple Memory1` (memoryBufferWindow)\n  - Keep last 10 messages for session context.\n- **Node:** `Calculator1` (toolCalculator)\n  - Used by agent to sum multiple charges, handle currency arithmetic and totals.\n\n## Travel Reimbursement Agent (Core)\n- **Node:** `Travel reimbursement agent` (LangChain agent)\n  - **Model:** `Mistral Cloud Chat Model` (mistral-medium-latest)\n  - **Behavior:**\n    - Parse OCR `blocks` and non-file chat input.\n    - Extract required fields: `vendor_name`, `category`, `invoice_date`, `checkin_date`, `checkout_date`, `time`, `currency`, `total_amount`, `notes`, `estimated`.\n    - When fields are missing, infer logically and mark `estimated: true`.\n    - Use Calculator tool to sum totals across multiple receipts.\n    - Fetch stored OCR entries from Supabase when user asks for session summaries.\n    - Always attempt extraction; never reply with \"unclear\" or ask for a reupload unless user requests audit-grade precision.\n  - **Final output:** Clean expense table and Grand Total formatted for chat.\n\n## Data Flow Summary\n1. User sends chat message plus or minus file.\n2. IF file present -&gt; Split Out -&gt; Normalize -&gt; OCR -&gt; Store OCR output -&gt; Merge with chat payload.\n3. Travel reimbursement agent consumes merged item, extracts fields, uses Calculator tool for sums, and replies with a formatted expense summary.\n\n---\n\n## Integrations Used\n| Service | Purpose | Credential |\n|---------|---------|-----------|\n| Mistral Cloud | LLM for agent | `Mistral  account ` |\n| Supabase | Store parsed OCR blocks and session data | `Supabase account ` |\n| OCR API | Text extraction from images/PDFs | Configurable HTTP endpoint |\n| n8n Core | Flow control, parsing, editing | Native |\n\n---\n\n## Agent System Prompt Summary\n&gt; You are a Travel Expense Extraction and Calculation AI. Extract vendor, dates, currency, category, and total amounts from uploaded receipts, invoices, hotel bills, PDFs, and images. Infer values when necessary and mark them as estimated. When asked, fetch session entries from Supabase and compute totals using the Calculator tool. Respond in a concise business professional format with a category wise breakdown and a Grand Total. Never reply \"unclear\" or ask for a reupload unless explicitly asked.\n\nRequired final response format example:\n\n\n---\n\n## Key Features\n-  Zero retention friendly design: OCR output stored only to `temp_table` per session.\n-  Robust extraction with inference when OCR quality is imperfect.\n-  Session aware: agent retrieves stored receipts for consolidated totals.\n- Calculator integration for accurate numeric sums and currency handling.\n-  Configurable OCR endpoint so you can swap providers without changing logic.\n\n---\n\n## Setup Checklist\n1. Add Mistral Cloud and Supabase credentials.\n2. Configure OCR endpoint to accept multipart uploads and return `blocks`.\n3. Create `temp_table` schema with `session_id`, `file`, `file_name`.\n4. Test with single receipts, multipage PDFs, and mixed uploads.\n5. Validate agent responses and Calculator totals.\n\n---\n\n## Summary\nA practical n8n workflow for travel expense automation: accept receipts, run OCR, store parsed data per session, extract structured fields via an AI agent, compute totals, and return clean expense summaries in chat. Built for reliability and easy integration.\n\n---\n\n### Need Help or More Workflows?\nWe can integrate this into your environment, tune the agent prompt, or adapt it for different OCR providers.\n \n We can help you set it up for free — from connecting credentials to deploying it live.\n\nContact: [shilpa.raju@digitalbiz.tech](mailto:shilpa.raju@digitalbiz.tech)  \nWebsite: [https://www.digitalbiz.tech](https://www.digitalbiz.tech)  \nLinkedIn: [https://www.linkedin.com/company/digital-biz-tech/](https://www.linkedin.com/company/digital-biz-tech/)   \nYou can also DM us on LinkedIn for any help.\n",
  "featuredImage": "/data/workflows/10901/10901.webp",
  "author": {
    "id": 101,
    "slug": "dbt",
    "name": "DIGITAL BIZ TECH",
    "avatar": ""
  },
  "categories": [
    "Invoice Processing",
    "AI Chatbot"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 151,
  "downloads": 15,
  "createdAt": "2025-11-17T05:13:10.956Z",
  "updatedAt": "2026-01-16T09:06:46.590Z",
  "publishedAt": "2025-11-17T05:13:10.956Z",
  "nodes": 24,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/10901",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Automate travel expense extraction with OCR, Mistral AI and Supabase",
    "workflowName": "Automate travel expense extraction with OCR, Mistral AI and Supabase",
    "description": "# Travel Reimbursement - OCR & Expense Extraction Workflow\n\n## Overview\nThis is a lightweight n8n workflow that accepts chat input and uploaded receipts, runs OCR, stores parsed results in Supabase, and uses an AI agent to extract structured travel expense data and compute totals. Designed for zero retention operation and fast integration.\n\n---\n\n## Workflow Structure\n- **Frontend:** Chat UI trigger that accepts text and file uploads.\n- **Preprocessing:** Binary normalization + per-file OCR request.\n- **Storage:** Store OCR-parsed blocks in Supabase `temp_table`.\n- **Core AI:** Travel reimbursement agent that extracts fields, infers missing values, and calculates totals using the Calculator tool.\n- **Output:** Agent responds to the chat with a concise expense summary and breakdowns.\n\n---\n\n## Chat Trigger (Frontend)\n- **Trigger node:** `When chat message received`\n  - `public: true`, `allowFileUploads: true`, sessionId used to tie uploads to the chat session.\n  - Custom CSS + initial messages configured for user experience.\n\n## Binary Presence Check\n- **Node:** `CHECK IF BINARY FILE IS PRESENT OR NOT` (IF)\n  - Checks whether incoming payload contains `files`.\n  - If files present -&gt; route to `Split Out` -&gt; `NORMALIZE binary file` -&gt; `OCR (ANY OCR API)` -&gt; `STORE OCR OUTPUT` -&gt; `Merge`.\n  - If no files -&gt; route directly to `Merge` -&gt; `Travel reimbursement agent`.\n\n## Binary Normalization\n- **Node:** `Split Out` and `NORMALIZE binary file` (Code)\n  - `Split Out` extracts binary entries into a `data` field.\n  - `NORMALIZE binary file` picks the first binary key and rewrites payload to `binary.data` for consistent downstream shape.\n\n## OCR\n- **Node:** `OCR (ANY OCR API )` (HTTP Request)\n  - Sends multipart/form-data to OCR endpoint, expects JSONL or JSON with `blocks`.\n  - Body includes `mode=single`, `output_type=jsonl`, `include_images=false`.\n\n## Store OCR Output\n- **Node:** `STORE OCR OUTPUT` (Supabase)\n  - Upserts into `temp_table` with `session_id`, parsed `blocks`, and `file_name`.\n  - Used by agent to fetch previously uploaded receipts for same session.\n\n## Memory & Tooling\n- **Nodes:** `Simple Memory` and `Simple Memory1` (memoryBufferWindow)\n  - Keep last 10 messages for session context.\n- **Node:** `Calculator1` (toolCalculator)\n  - Used by agent to sum multiple charges, handle currency arithmetic and totals.\n\n## Travel Reimbursement Agent (Core)\n- **Node:** `Travel reimbursement agent` (LangChain agent)\n  - **Model:** `Mistral Cloud Chat Model` (mistral-medium-latest)\n  - **Behavior:**\n    - Parse OCR `blocks` and non-file chat input.\n    - Extract required fields: `vendor_name`, `category`, `invoice_date`, `checkin_date`, `checkout_date`, `time`, `currency`, `total_amount`, `notes`, `estimated`.\n    - When fields are missing, infer logically and mark `estimated: true`.\n    - Use Calculator tool to sum totals across multiple receipts.\n    - Fetch stored OCR entries from Supabase when user asks for session summaries.\n    - Always attempt extraction; never reply with \"unclear\" or ask for a reupload unless user requests audit-grade precision.\n  - **Final output:** Clean expense table and Grand Total formatted for chat.\n\n## Data Flow Summary\n1. User sends chat message plus or minus file.\n2. IF file present -&gt; Split Out -&gt; Normalize -&gt; OCR -&gt; Store OCR output -&gt; Merge with chat payload.\n3. Travel reimbursement agent consumes merged item, extracts fields, uses Calculator tool for sums, and replies with a formatted expense summary.\n\n---\n\n## Integrations Used\n| Service | Purpose | Credential |\n|---------|---------|-----------|\n| Mistral Cloud | LLM for agent | `Mistral  account ` |\n| Supabase | Store parsed OCR blocks and session data | `Supabase account ` |\n| OCR API | Text extraction from images/PDFs | Configurable HTTP endpoint |\n| n8n Core | Flow control, parsing, editing | Native |\n\n---\n\n## Agent System Prompt Summary\n&gt; You are a Travel Expense Extraction and Calculation AI. Extract vendor, dates, currency, category, and total amounts from uploaded receipts, invoices, hotel bills, PDFs, and images. Infer values when necessary and mark them as estimated. When asked, fetch session entries from Supabase and compute totals using the Calculator tool. Respond in a concise business professional format with a category wise breakdown and a Grand Total. Never reply \"unclear\" or ask for a reupload unless explicitly asked.\n\nRequired final response format example:\n\n\n---\n\n## Key Features\n-  Zero retention friendly design: OCR output stored only to `temp_table` per session.\n-  Robust extraction with inference when OCR quality is imperfect.\n-  Session aware: agent retrieves stored receipts for consolidated totals.\n- Calculator integration for accurate numeric sums and currency handling.\n-  Configurable OCR endpoint so you can swap providers without changing logic.\n\n---\n\n## Setup Checklist\n1. Add Mistral Cloud and Supabase credentials.\n2. Configure OCR endpoint to accept multipart uploads and return `blocks`.\n3. Create `temp_table` schema with `session_id`, `file`, `file_name`.\n4. Test with single receipts, multipage PDFs, and mixed uploads.\n5. Validate agent responses and Calculator totals.\n\n---\n\n## Summary\nA practical n8n workflow for travel expense automation: accept receipts, run OCR, store parsed data per session, extract structured fields via an AI agent, compute totals, and return clean expense summaries in chat. Built for reliability and easy integration.\n\n---\n\n### Need Help or More Workflows?\nWe can integrate this into your environment, tune the agent prompt, or adapt it for different OCR providers.\n \n We can help you set it up for free — from connecting credentials to deploying it live.\n\nContact: [shilpa.raju@digitalbiz.tech](mailto:shilpa.raju@digitalbiz.tech)  \nWebsite: [https://www.digitalbiz.tech](https://www.digitalbiz.tech)  \nLinkedIn: [https://www.linkedin.com/company/digital-biz-tech/](https://www.linkedin.com/company/digital-biz-tech/)   \nYou can also DM us on LinkedIn for any help.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Split Out",
      "type": "n8n-nodes-base.splitOut",
      "role": "splitOut",
      "configDescription": "Version 1"
    },
    {
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3.1"
    },
    {
      "name": "Supabase Get",
      "type": "n8n-nodes-base.supabaseTool",
      "role": "supabaseTool",
      "configDescription": "Version 1"
    },
    {
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "role": "chatTrigger",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "role": "memoryBufferWindow",
      "configDescription": "Version 1.3"
    },
    {
      "name": "Mistral Cloud Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatMistralCloud",
      "role": "lmChatMistralCloud",
      "configDescription": "Version 1"
    },
    {
      "name": "Calculator1",
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "role": "toolCalculator",
      "configDescription": "Version 1"
    },
    {
      "name": "CHECK IF BINARY FILE IS PRESENT OR NOT",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "NORMALIZE binary file",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "OCR (ANY OCR API )",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "STORE OCR OUTPUT",
      "type": "n8n-nodes-base.supabase",
      "role": "supabase",
      "configDescription": "Version 1"
    },
    {
      "name": "Travel reimbursement agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.9"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Simple Memory1",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "role": "memoryBufferWindow",
      "configDescription": "Version 1.3"
    }
  ]
}