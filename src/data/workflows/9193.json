{
  "id": 9193,
  "slug": "9193",
  "title": "AI-powered Gmail assistant: send replies by analyzing thread ID with Sonnet 4.5",
  "description": "This workflow automates **analyzing Gmail threads and drafting AI-powered replies** with the new model Anthropic **Sonnet 4.5**.\n\nThis workflow automates the process of analyzing incoming emails and generating context-aware draft replies by examining the entire email thread.\n\n---\n\n### **Key Advantages**\n\n* ✅ **Time-Saving** – Automates repetitive email replies, reducing manual workload.\n* ✅ **Context-Aware Responses** – Replies are generated using the entire email thread, not just the latest message.\n* ✅ **Smart Filtering** – The classifier prevents unnecessary drafts for spam or promotional emails.\n* ✅ **Human-in-the-Loop** – Drafts are created instead of being sent immediately, allowing manual review and corrections.\n* ✅ **Scalable & Flexible** – Can be adapted to different accounts, reply styles, or workflows.\n* ✅ **Seamless Gmail Integration** – Directly interacts with Gmail threads and drafts via OAuth.\n\n---\n\n### **How it Works**\n\nThis workflow automates the process of analyzing incoming emails and generating context-aware draft replies by examining the entire email thread.\n\n1.  **Trigger & Initial Filtering:** The workflow is automatically triggered every minute by the **Gmail Trigger** node, which detects new emails. For each new email, it immediately performs a crucial first step: it uses an AI **Email Classifier** to analyze the email snippet. The AI determines if the email is a legitimate message that warrants a reply (categorized as \"ok\") or if it's spam, a newsletter, or an advertisement. This prevents the system from generating replies for unwanted emails.\n\n2.  **Context Aggregation:** If an email is classified as \"ok,\" the workflow fetches the **entire conversation thread** from Gmail using the `threadId`. A **Code Node** then processes all the messages in the thread, structuring them into a consistent format that the AI can easily understand.\n\n3.  **AI-Powered Draft Generation:** The structured conversation history is passed to the **Replying email Agent** with **Sonnet 4.5**. This agent, powered by a language model, analyzes the entire thread to understand the context and the latest inquiry. It then drafts a relevant and coherent HTML email reply. The system prompt instructs the AI not to invent information and to use placeholders for any missing details.\n\n4.  **Draft Creation:** The final step takes the AI-generated reply and the original email's metadata (subject, recipient, threadId) and uses them to **create a new draft email** in Gmail. This draft is automatically placed in the correct email thread, ready for the user to review and send.\n---\n\n\n### **Set up Steps**\n\nTo implement this automated email reply system, you need to configure the following:\n\n1.  **Configure Gmail & OpenAI Credentials:** Ensure the following credentials are set up in your n8n instance:\n    *   **Gmail OAuth2 Credentials:** The workflow uses the same Gmail account for the trigger, fetching threads, and creating drafts. Configure this in the \"Gmail Trigger,\" \"Get a thread,\" and \"Create a draft\" nodes.\n    *   **OpenAI API Credentials:** Required for both the \"Email Classifier\". Provide your API key in the respective OpenAI Chat Model nodes.\n  \n\t *   **Anthropic API Credentials:** Required for the main \"Replying email Agent.\" Provide your API key in the respective Antrhopic Chat Model nodes.\n\n2.  **Review AI Classification & Prompting:**\n    *   **Email Filtering:** Check the categories in the **Email Classifier** node. The current setup marks only non-advertising, non-newsletter emails as \"ok.\" You can modify these categories to fit your specific needs and reduce false positives.\n    *   **Reply Agent Instructions:** Review the system message in the **Replying email Agent**. You can customize the AI's persona, tone, and instructions (e.g., making it more formal, or instructing it to sign with a specific name) to better align with your communication style.\n\n---\n### **Need help customizing?**  \n[Contact me](mailto:info@n3w.it) for consulting and support or add me on [Linkedin](https://www.linkedin.com/in/davideboizza/). \n",
  "featuredImage": "/data/workflows/9193/9193.webp",
  "author": {
    "id": 101,
    "slug": "n3witalia",
    "name": "Davide",
    "avatar": ""
  },
  "categories": [
    "AI Chatbot"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 348,
  "downloads": 34,
  "createdAt": "2025-10-02T13:13:47.353Z",
  "updatedAt": "2026-01-16T08:59:23.663Z",
  "publishedAt": "2025-10-02T13:13:47.353Z",
  "nodes": 11,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/9193",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "AI-powered Gmail assistant: send replies by analyzing thread ID with Sonnet 4.5",
    "workflowName": "AI-powered Gmail assistant: send replies by analyzing thread ID with Sonnet 4.5",
    "description": "This workflow automates **analyzing Gmail threads and drafting AI-powered replies** with the new model Anthropic **Sonnet 4.5**.\n\nThis workflow automates the process of analyzing incoming emails and generating context-aware draft replies by examining the entire email thread.\n\n---\n\n### **Key Advantages**\n\n* ✅ **Time-Saving** – Automates repetitive email replies, reducing manual workload.\n* ✅ **Context-Aware Responses** – Replies are generated using the entire email thread, not just the latest message.\n* ✅ **Smart Filtering** – The classifier prevents unnecessary drafts for spam or promotional emails.\n* ✅ **Human-in-the-Loop** – Drafts are created instead of being sent immediately, allowing manual review and corrections.\n* ✅ **Scalable & Flexible** – Can be adapted to different accounts, reply styles, or workflows.\n* ✅ **Seamless Gmail Integration** – Directly interacts with Gmail threads and drafts via OAuth.\n\n---\n\n### **How it Works**\n\nThis workflow automates the process of analyzing incoming emails and generating context-aware draft replies by examining the entire email thread.\n\n1.  **Trigger & Initial Filtering:** The workflow is automatically triggered every minute by the **Gmail Trigger** node, which detects new emails. For each new email, it immediately performs a crucial first step: it uses an AI **Email Classifier** to analyze the email snippet. The AI determines if the email is a legitimate message that warrants a reply (categorized as \"ok\") or if it's spam, a newsletter, or an advertisement. This prevents the system from generating replies for unwanted emails.\n\n2.  **Context Aggregation:** If an email is classified as \"ok,\" the workflow fetches the **entire conversation thread** from Gmail using the `threadId`. A **Code Node** then processes all the messages in the thread, structuring them into a consistent format that the AI can easily understand.\n\n3.  **AI-Powered Draft Generation:** The structured conversation history is passed to the **Replying email Agent** with **Sonnet 4.5**. This agent, powered by a language model, analyzes the entire thread to understand the context and the latest inquiry. It then drafts a relevant and coherent HTML email reply. The system prompt instructs the AI not to invent information and to use placeholders for any missing details.\n\n4.  **Draft Creation:** The final step takes the AI-generated reply and the original email's metadata (subject, recipient, threadId) and uses them to **create a new draft email** in Gmail. This draft is automatically placed in the correct email thread, ready for the user to review and send.\n---\n\n\n### **Set up Steps**\n\nTo implement this automated email reply system, you need to configure the following:\n\n1.  **Configure Gmail & OpenAI Credentials:** Ensure the following credentials are set up in your n8n instance:\n    *   **Gmail OAuth2 Credentials:** The workflow uses the same Gmail account for the trigger, fetching threads, and creating drafts. Configure this in the \"Gmail Trigger,\" \"Get a thread,\" and \"Create a draft\" nodes.\n    *   **OpenAI API Credentials:** Required for both the \"Email Classifier\". Provide your API key in the respective OpenAI Chat Model nodes.\n  \n\t *   **Anthropic API Credentials:** Required for the main \"Replying email Agent.\" Provide your API key in the respective Antrhopic Chat Model nodes.\n\n2.  **Review AI Classification & Prompting:**\n    *   **Email Filtering:** Check the categories in the **Email Classifier** node. The current setup marks only non-advertising, non-newsletter emails as \"ok.\" You can modify these categories to fit your specific needs and reduce false positives.\n    *   **Reply Agent Instructions:** Review the system message in the **Replying email Agent**. You can customize the AI's persona, tone, and instructions (e.g., making it more formal, or instructing it to sign with a specific name) to better align with your communication style.\n\n---\n### **Need help customizing?**  \n[Contact me](mailto:info@n3w.it) for consulting and support or add me on [Linkedin](https://www.linkedin.com/in/davideboizza/).",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Gmail Trigger",
      "type": "n8n-nodes-base.gmailTrigger",
      "role": "gmailTrigger",
      "configDescription": "Version 1.3"
    },
    {
      "name": "Get a thread",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Create a draft",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3.2"
    },
    {
      "name": "OpenAI Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "role": "lmChatOpenAi",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Email Classifier",
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "role": "textClassifier",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Replying email Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Anthropic Sonnet 4.5",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "role": "lmChatAnthropic",
      "configDescription": "Version 1.3"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}