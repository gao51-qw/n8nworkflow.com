{
  "id": 6693,
  "slug": "6693",
  "title": "Home Assistant event triggering with AppDaemon Webhooks",
  "description": "## Summary\nThis is a minimal template that focuses on how to integrate n8n and Home Assistant for event-based triggering from Home Assistant using the AppDaemon addon to call a webhook node. \n\n## Problem Solved: \nThere is no Home Assistant trigger node in n8n. You can poll the Home Assistant API on a schedule. A more efficient work around is to use the AppDaemon addon to create a listener app within Home Assistant. When the listener detects the event, it is subscribed to. An AppDaemon app is initiated that calls a N8N webhook passing the the event data to the workflow.\n\nAppDaemon runs python code. The template contains a sticky note. Within the sticky note there is a code example (repeated below) for a AppDeamon app, the code contains annotated instructions on configuration.\n\n## Steps:\n\n## Install the AppDaemon Add-on\nA. Open Home Assistant. In your Home Assistant UI, go to Settings - Add-ons (or Supervisor -  Add-on Store, depending on your version).\n\nB. Search and Install. In the Add-on Store, search for \"AppDaemon 4\". Click on the result and then the Install button to start the installation.\n\nC. Start the Add-on. Once installed, open the AppDaemon 4 add-on page. Click Start to launch AppDaemon. (Optional but recommended) Enable Start on boot and Watchdog options to make sure AppDaemon starts automatically and restarts if it crashes.\n\nD. Verify Installation. Check the logs in the AppDaemon add-on page to ensure it’s running without issues. No need to set access tokens or Home Assistant URL manually; the add-on is pre-configured to connect with your Home Assistant.\n\nE. Configure AppDaemon. After installation, a directory named appdaemon will appear inside your Home Assistant config directory (/config/appdaemon/). Inside, you’ll find a file called appdaemon.yaml. For most uses, the default configuration is fine, but you can customize it as needed.\n\n## Create the AppDaemon App. \n\nF. Prepare Your Apps Directory. Inside /config/appdaemon/, locate or create an apps folder. Path: /config/appdaemon/apps/. \n\nG. Create a Python App \nInside the apps folder, create a new Python file (example: n8n_WebHook.py).\n\nOpen the file in an editor and paste the example code into the file.\n\n``` python\nimport appdaemon.plugins.hass.hassapi as hass\nimport requests\nimport json\nclass EventTon8nWebhook(hass.Hass):\n    \"\"\"\n    AppDaemon app that listens for Home Assistant events and forwards them to n8n webhook\n    \"\"\"\n#\n# \n    def initialize(self):\n        \"\"\"\n        Initialize the event listener and configure webhook settings\n        \"\"\"\n        # EDIT: Replace 'your_event_name' with the actual event you want to listen for\n        # Common HA events: 'state_changed', 'call_service', 'automation_triggered', etc.\n        self.target_event = self.args.get('target_event', 'your_event_name')\n        \n        # EDIT: Set your n8n webhook URL in apps.yaml or replace the default here\n        self.webhook_url = self.args.get('webhook_url', 'n8n_webhook_url')\n        \n        # EDIT: Optional - set timeout for webhook requests (seconds)\n        self.webhook_timeout = self.args.get('webhook_timeout', 10)\n        \n        # EDIT: Optional - enable/disable SSL verification\n        self.verify_ssl = self.args.get('verify_ssl', True)\n        \n        # Set up the event listener\n        self.listen_event(self.event_handler, self.target_event)\n        \n        self.log(f\"Event listener initialized for event: {self.target_event}\")\n        self.log(f\"Webhook URL configured: {self.webhook_url}\")\n#\n#\n    def event_handler(self, event_name, data, kwargs):\n        \"\"\"\n        Handle the triggered event and forward to n8n webhook\n        Args:\n            event_name (str): Name of the triggered event\n            data (dict): Event data from Home Assistant\n            kwargs (dict): Additional keyword arguments from the event\n        \"\"\"\n        try:\n            # Prepare payload for n8n webhook\n            payload = {\n                'event_name': event_name,\n                'event_data': data,\n                'event_kwargs': kwargs,\n                'timestamp': self.datetime().isoformat(),\n                'source': 'home_assistant_appdaemon'\n            }\n            \n            self.log(f\"Received event '{event_name}' - forwarding to n8n\")\n            self.log(f\"Event data: {data}\")\n            \n            # Send to n8n webhook\n            self.send_to_n8n(payload)\n            \n        except Exception as e:\n            self.log(f\"Error handling event {event_name}: {str(e)}\", level=\"ERROR\")\n#\n#\n    def send_to_n8n(self, payload):\n        \"\"\"\n        Send payload to n8n webhook\n        Args:payload (dict): Data to send to n8n\n        \"\"\"\n        try:\n            headers = {\n                'Content-Type': 'application/json',\n#EDIT assume header authentication parameter and value below need to match what is set in the credential used in the node.\n                'CredName': 'credValue', #set to what you set up as a credential for the webhook node\n            }\n            \n            response = requests.post(\n                self.webhook_url,\n                json=payload,\n                headers=headers,\n                timeout=self.webhook_timeout,\n                verify=self.verify_ssl\n            )\n            \n            response.raise_for_status()\n            \n            self.log(f\"Successfully sent event to n8n webhook. Status: {response.status_code}\")\n            \n            # EDIT: Optional - log response from n8n for debugging\n            if response.text:\n                self.log(f\"n8n response: {response.text}\")\n                \n        except requests.exceptions.Timeout:\n            self.log(f\"Timeout sending to n8n webhook after {self.webhook_timeout}s\", level=\"ERROR\")\n        except requests.exceptions.RequestException as e:\n            self.log(f\"Error sending to n8n webhook: {str(e)}\", level=\"ERROR\")\n        except Exception as e:\n            self.log(f\"Unexpected error sending to n8n: {str(e)}\", level=\"ERROR\")\n```\n\nH. Register Your App\n\nIn the same apps folder, locate or create a file named apps.yaml.\n\nAdd an entry to register your app:\n\n```yaml\nEventTon8nWebhook:\n  module: n8n_WebHook\n  class: EventTon8nWebhook\n```\n\n\nModule should match your Python filename (without the .py).\nclass matches the class name inside your Python file, i.e. *EventTon8nWebHook*\n\nI. Reload AppDaemon\nIn Home Assistant, return to the AppDaemon 4 add-on page and click Restart.\n\nWatch the logs; you should see a log entry from your app confirming it is initialised running.\n\n## Set Up n8n\nJ. In your workflow create a webhook trigger node as the first node, or use the template as your starting point.\n\nEnsure the webhook URL (production or test) is correctly copied to the python code.\n\nIf you are using authentication this needs a credential creating for the webhook. The example uses header auth. Naturally this should match what is in the code. For security likely better to put the credentials in a *\"secrets.yaml\"*  file rather than hard code like this demo.\n\nExecute the workflow or activate if using the production webhook. Either wait for an event in Home Assistant or one can be manually triggered from the developer settings page, event tab.\n\nK. Finally develop your workflow to process the received event per your use case.\n\nSee the Home Assistant docs on events for details of the event types you can subscribe to: [Home Assistant Events](https://www.home-assistant.io/docs/configuration/events/)",
  "featuredImage": "/data/workflows/6693/6693.webp",
  "author": {
    "id": 101,
    "slug": "akendall1966",
    "name": "Adrian Kendall",
    "avatar": ""
  },
  "categories": [
    "Personal Productivity"
  ],
  "complexityLevel": "beginner",
  "price": 0,
  "visitors": 135,
  "downloads": 13,
  "createdAt": "2025-07-30T10:21:15.567Z",
  "updatedAt": "2026-01-16T08:46:32.063Z",
  "publishedAt": "2025-07-30T10:21:15.567Z",
  "nodes": 4,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/6693",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Home Assistant event triggering with AppDaemon Webhooks",
    "workflowName": "Home Assistant event triggering with AppDaemon Webhooks",
    "description": "## Summary\nThis is a minimal template that focuses on how to integrate n8n and Home Assistant for event-based triggering from Home Assistant using the AppDaemon addon to call a webhook node. \n\n## Problem Solved: \nThere is no Home Assistant trigger node in n8n. You can poll the Home Assistant API on a schedule. A more efficient work around is to use the AppDaemon addon to create a listener app within Home Assistant. When the listener detects the event, it is subscribed to. An AppDaemon app is initiated that calls a N8N webhook passing the the event data to the workflow.\n\nAppDaemon runs python code. The template contains a sticky note. Within the sticky note there is a code example (repeated below) for a AppDeamon app, the code contains annotated instructions on configuration.\n\n## Steps:\n\n## Install the AppDaemon Add-on\nA. Open Home Assistant. In your Home Assistant UI, go to Settings - Add-ons (or Supervisor -  Add-on Store, depending on your version).\n\nB. Search and Install. In the Add-on Store, search for \"AppDaemon 4\". Click on the result and then the Install button to start the installation.\n\nC. Start the Add-on. Once installed, open the AppDaemon 4 add-on page. Click Start to launch AppDaemon. (Optional but recommended) Enable Start on boot and Watchdog options to make sure AppDaemon starts automatically and restarts if it crashes.\n\nD. Verify Installation. Check the logs in the AppDaemon add-on page to ensure it’s running without issues. No need to set access tokens or Home Assistant URL manually; the add-on is pre-configured to connect with your Home Assistant.\n\nE. Configure AppDaemon. After installation, a directory named appdaemon will appear inside your Home Assistant config directory (/config/appdaemon/). Inside, you’ll find a file called appdaemon.yaml. For most uses, the default configuration is fine, but you can customize it as needed.\n\n## Create the AppDaemon App. \n\nF. Prepare Your Apps Directory. Inside /config/appdaemon/, locate or create an apps folder. Path: /config/appdaemon/apps/. \n\nG. Create a Python App \nInside the apps folder, create a new Python file (example: n8n_WebHook.py).\n\nOpen the file in an editor and paste the example code into the file.\n\n``` python\nimport appdaemon.plugins.hass.hassapi as hass\nimport requests\nimport json\nclass EventTon8nWebhook(hass.Hass):\n    \"\"\"\n    AppDaemon app that listens for Home Assistant events and forwards them to n8n webhook\n    \"\"\"\n#\n# \n    def initialize(self):\n        \"\"\"\n        Initialize the event listener and configure webhook settings\n        \"\"\"\n        # EDIT: Replace 'your_event_name' with the actual event you want to listen for\n        # Common HA events: 'state_changed', 'call_service', 'automation_triggered', etc.\n        self.target_event = self.args.get('target_event', 'your_event_name')\n        \n        # EDIT: Set your n8n webhook URL in apps.yaml or replace the default here\n        self.webhook_url = self.args.get('webhook_url', 'n8n_webhook_url')\n        \n        # EDIT: Optional - set timeout for webhook requests (seconds)\n        self.webhook_timeout = self.args.get('webhook_timeout', 10)\n        \n        # EDIT: Optional - enable/disable SSL verification\n        self.verify_ssl = self.args.get('verify_ssl', True)\n        \n        # Set up the event listener\n        self.listen_event(self.event_handler, self.target_event)\n        \n        self.log(f\"Event listener initialized for event: {self.target_event}\")\n        self.log(f\"Webhook URL configured: {self.webhook_url}\")\n#\n#\n    def event_handler(self, event_name, data, kwargs):\n        \"\"\"\n        Handle the triggered event and forward to n8n webhook\n        Args:\n            event_name (str): Name of the triggered event\n            data (dict): Event data from Home Assistant\n            kwargs (dict): Additional keyword arguments from the event\n        \"\"\"\n        try:\n            # Prepare payload for n8n webhook\n            payload = {\n                'event_name': event_name,\n                'event_data': data,\n                'event_kwargs': kwargs,\n                'timestamp': self.datetime().isoformat(),\n                'source': 'home_assistant_appdaemon'\n            }\n            \n            self.log(f\"Received event '{event_name}' - forwarding to n8n\")\n            self.log(f\"Event data: {data}\")\n            \n            # Send to n8n webhook\n            self.send_to_n8n(payload)\n            \n        except Exception as e:\n            self.log(f\"Error handling event {event_name}: {str(e)}\", level=\"ERROR\")\n#\n#\n    def send_to_n8n(self, payload):\n        \"\"\"\n        Send payload to n8n webhook\n        Args:payload (dict): Data to send to n8n\n        \"\"\"\n        try:\n            headers = {\n                'Content-Type': 'application/json',\n#EDIT assume header authentication parameter and value below need to match what is set in the credential used in the node.\n                'CredName': 'credValue', #set to what you set up as a credential for the webhook node\n            }\n            \n            response = requests.post(\n                self.webhook_url,\n                json=payload,\n                headers=headers,\n                timeout=self.webhook_timeout,\n                verify=self.verify_ssl\n            )\n            \n            response.raise_for_status()\n            \n            self.log(f\"Successfully sent event to n8n webhook. Status: {response.status_code}\")\n            \n            # EDIT: Optional - log response from n8n for debugging\n            if response.text:\n                self.log(f\"n8n response: {response.text}\")\n                \n        except requests.exceptions.Timeout:\n            self.log(f\"Timeout sending to n8n webhook after {self.webhook_timeout}s\", level=\"ERROR\")\n        except requests.exceptions.RequestException as e:\n            self.log(f\"Error sending to n8n webhook: {str(e)}\", level=\"ERROR\")\n        except Exception as e:\n            self.log(f\"Unexpected error sending to n8n: {str(e)}\", level=\"ERROR\")\n```\n\nH. Register Your App\n\nIn the same apps folder, locate or create a file named apps.yaml.\n\nAdd an entry to register your app:\n\n```yaml\nEventTon8nWebhook:\n  module: n8n_WebHook\n  class: EventTon8nWebhook\n```\n\n\nModule should match your Python filename (without the .py).\nclass matches the class name inside your Python file, i.e. *EventTon8nWebHook*\n\nI. Reload AppDaemon\nIn Home Assistant, return to the AppDaemon 4 add-on page and click Restart.\n\nWatch the logs; you should see a log entry from your app confirming it is initialised running.\n\n## Set Up n8n\nJ. In your workflow create a webhook trigger node as the first node, or use the template as your starting point.\n\nEnsure the webhook URL (production or test) is correctly copied to the python code.\n\nIf you are using authentication this needs a credential creating for the webhook. The example uses header auth. Naturally this should match what is in the code. For security likely better to put the credentials in a *\"secrets.yaml\"*  file rather than hard code like this demo.\n\nExecute the workflow or activate if using the production webhook. Either wait for an event in Home Assistant or one can be manually triggered from the developer settings page, event tab.\n\nK. Finally develop your workflow to process the received event per your use case.\n\nSee the Home Assistant docs on events for details of the event types you can subscribe to: [Home Assistant Events](https://www.home-assistant.io/docs/configuration/events/)",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Home Assistant Event Trigger",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 2"
    },
    {
      "name": "Process data from webhook",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}