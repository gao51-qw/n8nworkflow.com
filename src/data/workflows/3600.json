{
  "id": 3600,
  "slug": "3600",
  "title": "Line chatbot with Google Sheets memory and Gemini AI",
  "description": "### Main Use Case\nThis workflow enables automated, AI-assisted replies to users messaging a LINE Official Account, while storing and referencing chat history from Google Sheets to maintain context. Ideal for businesses or support teams that want to provide smart, personalized customer interactions using AI with memory.\n\n### How It Works (Step-by-Step)\n1. Connect to LINE Official Account's API\n* A Webhook listens for incoming messages from users on LINE.\n* When a message is received, it triggers the workflow.\n\n2. Prepare the Data\n* An Edit Fields module structures incoming data (e.g. extracts user ID, message content).\n* This ensures data is clean and usable downstream.\n\n3. Retrieve Chat History\n* The user‚Äôs previous conversations are fetched from a Google Sheet.\n* This ensures the AI has memory and can continue conversations contextually.\n\n4. Prepare Prompt\n* The retrieved chat history is combined with the new message to form a complete prompt for the AI.\n* Example format: ‚ÄúUser previously said X. Now they said Y. How should we respond?‚Äù\n\n5. AI Agent: Google Gemini\n* The formatted prompt is passed to an AI Agent (Google Gemini Chat Model).\n* The AI generates a response based on the message + history.\n* Tools used: Chat ModeMemory, ToolOutputParser for accurate replies.\n\n6. Split & Clean History\n* The conversation history is split into smaller chunks for cleaning and storage.\n* This ensures the Google Sheet remains readable and manageable over time.\n\n7. Save Chat History\n* The cleaned new message and AI reply are saved to Google Sheets.\n* This updates the chat history for future context.\n\n8. Send Reply to LINE\n* The AI-generated reply is sent back to the user via a POST HTTP Request to the LINE Messaging API.\n\n### How to Set Up\nPrerequisites:\n* LINE Official Account\n* Google Sheet to store chat history\n* Google Gemini API or AI agent with context memory\n* Automation platform (e.g., n8n, as this seems visually similar)\n\n### Step-by-Step:\n1. Create a Webhook on LINE:\n* Set the webhook URL to your automation service.\n* Enable webhook events.\n\n2. Design Your Google Sheet:\n* Create a sheet with columns: User ID, Timestamp, Message, AI Reply.\n\n3. Set Up Modules in Automation Platform:\n* Webhook: receives user messages.\n* Edit Fields: extract user ID and message.\n* Google Sheets Read: fetch message history.\n* Prompt Composer: format prompt using past history + new message.\n* AI Agent: connect to Google Gemini for smart replies.\n* Split & Clean: clean and chunk history if needed.\n* Google Sheets Write: save the updated conversation.\n* HTTP Request: send reply to LINE via Messaging API.\n\n4. Test Your Workflow:\n* Send a message from LINE.\n* Watch the full loop: receive ‚Üí process ‚Üí AI ‚Üí store ‚Üí reply.\n\n5. Deploy & Monitor:\n* Ensure error handling is in place (e.g., for blank messages or failed API calls).\n* Regularly check your Google Sheets for storage limits. (If limits reached, you can increase the history row.)\n\nüì¶ Benefits\n* Maintains context in conversations\n* Personalized, AI-driven responses\n* Easy history tracking via Google Sheets\n* Fully automated and scalable",
  "featuredImage": "/data/workflows/3600/3600.webp",
  "author": {
    "id": 101,
    "slug": "guitarpmacc",
    "name": "Jakkrapat Ampring",
    "avatar": ""
  },
  "categories": [
    "Support Chatbot",
    "AI Chatbot"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 4858,
  "downloads": 485,
  "createdAt": "2025-04-18T09:18:31.925Z",
  "updatedAt": "2026-01-16T08:30:32.632Z",
  "publishedAt": "2025-04-18T09:18:31.925Z",
  "nodes": 17,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/3600",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Line chatbot with Google Sheets memory and Gemini AI",
    "workflowName": "Line chatbot with Google Sheets memory and Gemini AI",
    "description": "### Main Use Case\nThis workflow enables automated, AI-assisted replies to users messaging a LINE Official Account, while storing and referencing chat history from Google Sheets to maintain context. Ideal for businesses or support teams that want to provide smart, personalized customer interactions using AI with memory.\n\n### How It Works (Step-by-Step)\n1. Connect to LINE Official Account's API\n* A Webhook listens for incoming messages from users on LINE.\n* When a message is received, it triggers the workflow.\n\n2. Prepare the Data\n* An Edit Fields module structures incoming data (e.g. extracts user ID, message content).\n* This ensures data is clean and usable downstream.\n\n3. Retrieve Chat History\n* The user‚Äôs previous conversations are fetched from a Google Sheet.\n* This ensures the AI has memory and can continue conversations contextually.\n\n4. Prepare Prompt\n* The retrieved chat history is combined with the new message to form a complete prompt for the AI.\n* Example format: ‚ÄúUser previously said X. Now they said Y. How should we respond?‚Äù\n\n5. AI Agent: Google Gemini\n* The formatted prompt is passed to an AI Agent (Google Gemini Chat Model).\n* The AI generates a response based on the message + history.\n* Tools used: Chat ModeMemory, ToolOutputParser for accurate replies.\n\n6. Split & Clean History\n* The conversation history is split into smaller chunks for cleaning and storage.\n* This ensures the Google Sheet remains readable and manageable over time.\n\n7. Save Chat History\n* The cleaned new message and AI reply are saved to Google Sheets.\n* This updates the chat history for future context.\n\n8. Send Reply to LINE\n* The AI-generated reply is sent back to the user via a POST HTTP Request to the LINE Messaging API.\n\n### How to Set Up\nPrerequisites:\n* LINE Official Account\n* Google Sheet to store chat history\n* Google Gemini API or AI agent with context memory\n* Automation platform (e.g., n8n, as this seems visually similar)\n\n### Step-by-Step:\n1. Create a Webhook on LINE:\n* Set the webhook URL to your automation service.\n* Enable webhook events.\n\n2. Design Your Google Sheet:\n* Create a sheet with columns: User ID, Timestamp, Message, AI Reply.\n\n3. Set Up Modules in Automation Platform:\n* Webhook: receives user messages.\n* Edit Fields: extract user ID and message.\n* Google Sheets Read: fetch message history.\n* Prompt Composer: format prompt using past history + new message.\n* AI Agent: connect to Google Gemini for smart replies.\n* Split & Clean: clean and chunk history if needed.\n* Google Sheets Write: save the updated conversation.\n* HTTP Request: send reply to LINE via Messaging API.\n\n4. Test Your Workflow:\n* Send a message from LINE.\n* Watch the full loop: receive ‚Üí process ‚Üí AI ‚Üí store ‚Üí reply.\n\n5. Deploy & Monitor:\n* Ensure error handling is in place (e.g., for blank messages or failed API calls).\n* Regularly check your Google Sheets for storage limits. (If limits reached, you can increase the history row.)\n\nüì¶ Benefits\n* Maintains context in conversations\n* Personalized, AI-driven responses\n* Easy history tracking via Google Sheets\n* Fully automated and scalable",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 2"
    },
    {
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.8"
    },
    {
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "role": "lmChatGoogleGemini",
      "configDescription": "Version 1"
    },
    {
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Get History",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.5"
    },
    {
      "name": "Prepare Prompt",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Save History",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.5"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Split History",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}