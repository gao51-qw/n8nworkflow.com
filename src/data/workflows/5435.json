{
  "id": 5435,
  "slug": "5435",
  "title": "AI agent to chat with Snowflake database",
  "description": "### Video Guide\n\nI prepared a detailed guide showcasing the process of building an AI agent that interacts with a Snowflake database using n8n. This setup enables conversational querying, secure execution of SQL queries, and dynamic report generation with rich visualization capabilities.\n\n[![Youtube Thumbnail](https://res.cloudinary.com/de9jgixzm/image/upload/nvg4dvgajspjzqudh2wa)](https://youtu.be/r7er-HCRsX4)\n\n[Youtube Link](https://youtu.be/r7er-HCRsX4)\n\n### Who is this for?\n\nThis workflow is designed for developers, data analysts, and business professionals who want to interact with their Snowflake data conversationally. It suits users looking to automate SQL query generation with AI, manage large datasets efficiently, and produce interactive reports without deep technical knowledge.\n\n### What problem does this workflow solve?\n\nQuerying Snowflake databases typically requires SQL proficiency and can lead to heavy token usage if large datasets are sent to AI models directly. This workflow addresses these challenges by:\n\n- Guiding AI to generate accurate SQL queries based on user chat input while referencing live database schema to avoid errors.\n- Executing queries safely on Snowflake with proper credential management.\n- Aggregating large result sets to reduce token consumption.\n- Offering a user-friendly report link with pagination, filtering, charts, and CSV export instead of returning overwhelming raw data.\n- Providing an error-resilient environment that prompts regenerations for SQL errors or connectivity issues.\n\n### What this workflow does\n\nThe scenario consists of multiple focused n8n workflows orchestrated for smooth, secure, and scalable interactions:\n\n1. **Agent Workflow**  \n   - Starts with a chat node and sets the system role as \"Snowflake SQL assistant.\"  \n   - AI generates SQL after verifying database schema and table definitions to avoid hallucinations.  \n   - Reinforcement rules ensure schema validation before query creation.\n\n2. **Data Retrieval Workflow**  \n   - Receives SQL queries from the agent workflow.  \n   - Executes them against the Snowflake database using user-provided credentials (hostname, account, warehouse, database, schema, username, password).  \n   - Optionally applies safety checks on SQL to prevent injection attacks.\n\n3. **Aggregation and Reporting Decision**  \n   - Aggregates returned data into arrays for efficient processing.  \n   - Applies a threshold (default 100 records) to decide whether to return raw data or generate a dynamic report link.  \n   - Prepares report links embedding URL-encoded SQL queries to securely invoke a separate report workflow.\n\n4. **Report Viewing Workflow**  \n   - Triggered via webhook from the report link.  \n   - Re-executes SQL queries to fetch fresh data.  \n   - Displays data with pagination, column filtering, and selectable chart visualizations.  \n   - Supports CSV export and custom HTML layouts for tailored user experience.  \n   - Provides proper error pages in case of SQL or data issues.\n\n5. **Schema and Table Definition Retrieval Tools**  \n   - Two helper workflows that fetch the list of tables and column metadata from Snowflake.  \n   - Require the user to replace placeholders with actual database and data source names.  \n   - Crucial for AI to maintain accurate understanding of the database structure.\n\n### N8N Workflow\n\n**Preparation**  \n- Create your Snowflake credentials in n8n with required host and account details, warehouse (e.g., \"computer_warehouse\"), database, schema, username, and password.  \n- Replace placeholder variables in schema retrieval workflows with your actual database and data source names.  \n- Verify the credentials by testing the connection; reset passwords if needed.\n\n**Workflow Logic**  \n- The Agent Workflow listens to user chats, employs system role \"Snowflake SQL assistant,\" and ensures schema validation before generating SQL queries.  \n- Generated SQL queries pass to the Data Retrieval Workflow, which executes them against Snowflake securely.  \n- Retrieved data is aggregated and evaluated against a configurable threshold to decide between returning raw data or creating a report link.  \n- When a report link is generated, the Report Viewing Workflow renders a dynamic interactive HTML-based report webpage, including pagination, filters, charts, and CSV export options.  \n- Helper workflows periodically fetch or update the current database schema and table definitions to maintain AI accuracy and prevent hallucinations in SQL generation.  \n- Error handling mechanisms provide user-friendly messages both in the agent chat and report pages when issues arise with SQL or connectivity.\n\nThis modular, secure, and extensible setup empowers you to build intelligent AI-driven data interactions with Snowflake through n8n automations and custom reporting.",
  "featuredImage": "/data/workflows/5435/5435.webp",
  "author": {
    "id": 101,
    "slug": "lowcodingdev",
    "name": "Mark Shcherbakov",
    "avatar": ""
  },
  "categories": [
    "Internal Wiki",
    "AI Chatbot"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 2604,
  "downloads": 260,
  "createdAt": "2025-06-28T13:33:34.514Z",
  "updatedAt": "2026-01-16T08:39:40.236Z",
  "publishedAt": "2025-06-28T13:33:34.514Z",
  "nodes": 28,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/5435",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "AI agent to chat with Snowflake database",
    "workflowName": "AI agent to chat with Snowflake database",
    "description": "### Video Guide\n\nI prepared a detailed guide showcasing the process of building an AI agent that interacts with a Snowflake database using n8n. This setup enables conversational querying, secure execution of SQL queries, and dynamic report generation with rich visualization capabilities.\n\n[![Youtube Thumbnail](https://res.cloudinary.com/de9jgixzm/image/upload/nvg4dvgajspjzqudh2wa)](https://youtu.be/r7er-HCRsX4)\n\n[Youtube Link](https://youtu.be/r7er-HCRsX4)\n\n### Who is this for?\n\nThis workflow is designed for developers, data analysts, and business professionals who want to interact with their Snowflake data conversationally. It suits users looking to automate SQL query generation with AI, manage large datasets efficiently, and produce interactive reports without deep technical knowledge.\n\n### What problem does this workflow solve?\n\nQuerying Snowflake databases typically requires SQL proficiency and can lead to heavy token usage if large datasets are sent to AI models directly. This workflow addresses these challenges by:\n\n- Guiding AI to generate accurate SQL queries based on user chat input while referencing live database schema to avoid errors.\n- Executing queries safely on Snowflake with proper credential management.\n- Aggregating large result sets to reduce token consumption.\n- Offering a user-friendly report link with pagination, filtering, charts, and CSV export instead of returning overwhelming raw data.\n- Providing an error-resilient environment that prompts regenerations for SQL errors or connectivity issues.\n\n### What this workflow does\n\nThe scenario consists of multiple focused n8n workflows orchestrated for smooth, secure, and scalable interactions:\n\n1. **Agent Workflow**  \n   - Starts with a chat node and sets the system role as \"Snowflake SQL assistant.\"  \n   - AI generates SQL after verifying database schema and table definitions to avoid hallucinations.  \n   - Reinforcement rules ensure schema validation before query creation.\n\n2. **Data Retrieval Workflow**  \n   - Receives SQL queries from the agent workflow.  \n   - Executes them against the Snowflake database using user-provided credentials (hostname, account, warehouse, database, schema, username, password).  \n   - Optionally applies safety checks on SQL to prevent injection attacks.\n\n3. **Aggregation and Reporting Decision**  \n   - Aggregates returned data into arrays for efficient processing.  \n   - Applies a threshold (default 100 records) to decide whether to return raw data or generate a dynamic report link.  \n   - Prepares report links embedding URL-encoded SQL queries to securely invoke a separate report workflow.\n\n4. **Report Viewing Workflow**  \n   - Triggered via webhook from the report link.  \n   - Re-executes SQL queries to fetch fresh data.  \n   - Displays data with pagination, column filtering, and selectable chart visualizations.  \n   - Supports CSV export and custom HTML layouts for tailored user experience.  \n   - Provides proper error pages in case of SQL or data issues.\n\n5. **Schema and Table Definition Retrieval Tools**  \n   - Two helper workflows that fetch the list of tables and column metadata from Snowflake.  \n   - Require the user to replace placeholders with actual database and data source names.  \n   - Crucial for AI to maintain accurate understanding of the database structure.\n\n### N8N Workflow\n\n**Preparation**  \n- Create your Snowflake credentials in n8n with required host and account details, warehouse (e.g., \"computer_warehouse\"), database, schema, username, and password.  \n- Replace placeholder variables in schema retrieval workflows with your actual database and data source names.  \n- Verify the credentials by testing the connection; reset passwords if needed.\n\n**Workflow Logic**  \n- The Agent Workflow listens to user chats, employs system role \"Snowflake SQL assistant,\" and ensures schema validation before generating SQL queries.  \n- Generated SQL queries pass to the Data Retrieval Workflow, which executes them against Snowflake securely.  \n- Retrieved data is aggregated and evaluated against a configurable threshold to decide between returning raw data or creating a report link.  \n- When a report link is generated, the Report Viewing Workflow renders a dynamic interactive HTML-based report webpage, including pagination, filters, charts, and CSV export options.  \n- Helper workflows periodically fetch or update the current database schema and table definitions to maintain AI accuracy and prevent hallucinations in SQL generation.  \n- Error handling mechanisms provide user-friendly messages both in the agent chat and report pages when issues arise with SQL or connectivity.\n\nThis modular, secure, and extensible setup empowers you to build intelligent AI-driven data interactions with Snowflake through n8n automations and custom reporting.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "role": "chatTrigger",
      "configDescription": "Version 1.1"
    },
    {
      "name": "AI Agent1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 2"
    },
    {
      "name": "OpenAI Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "role": "lmChatOpenAi",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Simple Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "role": "memoryBufferWindow",
      "configDescription": "Version 1.3"
    },
    {
      "name": "DB Schema1",
      "type": "n8n-nodes-base.snowflakeTool",
      "role": "snowflakeTool",
      "configDescription": "Version 1"
    },
    {
      "name": "Get table definition",
      "type": "n8n-nodes-base.snowflakeTool",
      "role": "snowflakeTool",
      "configDescription": "Version 1"
    },
    {
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 2"
    },
    {
      "name": "Set HTML",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "role": "respondToWebhook",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Snowflake1",
      "type": "n8n-nodes-base.snowflake",
      "role": "snowflake",
      "configDescription": "Version 1"
    },
    {
      "name": "Aggregate1",
      "type": "n8n-nodes-base.aggregate",
      "role": "aggregate",
      "configDescription": "Version 1"
    },
    {
      "name": "When Executed by Another Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "role": "executeWorkflowTrigger",
      "configDescription": "Version 1.1"
    },
    {
      "name": "Retrieve Data",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "role": "toolWorkflow",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Execute SQL",
      "type": "n8n-nodes-base.snowflake",
      "role": "snowflake",
      "configDescription": "Version 1"
    },
    {
      "name": "Aggregate Data",
      "type": "n8n-nodes-base.aggregate",
      "role": "aggregate",
      "configDescription": "Version 1"
    },
    {
      "name": "If Count>100",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Link to Report",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Return Data",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Return Error",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Error page",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}