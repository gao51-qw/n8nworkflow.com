{
  "id": 10398,
  "slug": "10398",
  "title": "Smart CSM assignment & AI welcome emails for HubSpot deal wins with Gmail",
  "description": "## Who's it for\nThis template is for Customer Success and Sales teams who use HubSpot. It automates the critical handoff from sales to success, ensuring every new customer gets a fast, personalized welcome. It's perfect for anyone looking to standardize their onboarding process, save time on manual tasks, and improve the new customer experience using AI.\n\n## What it does\nThis workflow triggers when a deal's \"Is closed won\" property is set to `True` in HubSpot. It assigns a Customer Success Manager (CSM) by querying an **n8n Data Table to find the 'least busy' CSM (based on a deal count)** and fetches the deal's details to find all associated contacts.\n\nIt then loops to identify the \"Champion\" contact by checking their \"Buying Role\" (`hs_buying_role`). An AI agent (in the `AI: Write Welcome Email` node) generates a personalized welcome email, which is converted to HTML and sent via Gmail. Finally, the workflow updates the Champion's contact record in HubSpot and **updates the CSM's deal count in the Data Table** to keep the logic in sync.\n\n## How to set up\n1.  **Create and Populate Data Table:** This template requires an n8n Data Table to manage CSM assignments.\n    * Create a Data Table named `csm_assignments`.\n    * Add two columns: `csm_id` (String) and `deal_count` (Number).\n    * Add one row for each CSM with their HubSpot Owner ID and a starting `deal_count` of `0`.\n2.  **Link Data Table Nodes:** Open the `Get CSM List` and `Increment CSM Deal Count` nodes and select the `csm_assignments` table you just created from the **Table** dropdown.\n3.  **Configure Variables:** In the `Configure Template Variables` node, you must set your sender info (`company_name`, `sender_name`, and `sender_email`).\n4.  **Customize AI Prompt:** In the `AI: Write Welcome Email` node, update the placeholder `[Link to Your Video]` and `[Link to Your Help Doc]` links with your own URLs.\n5.  **Check HubSpot Property:** This workflow assumes you use the \"Buying Role\" (`hs_buying_role`) contact property to identify your \"Champion\". If you use a different property, you must update the `HubSpot: Get Contact Details` and `If Role is 'Champion'` nodes.\n\n## Requirements\n* Access to **n8n Data Tables**.\n* **HubSpot (Developer API):** A credential for the `Trigger: Deal Is 'Closed Won'` node.\n* **HubSpot (OAuth2):** A credential for all other HubSpot nodes (`Get Deal Details`, `Get Contact Details`, `Assign Contact Owner`).\n* **AI Credentials:** (e.g., OpenAI) Credentials for the `AI Model` node (the node connected to `AI: Write Welcome Email`).\n* **Email Credentials:** (e.g., Gmail) Credentials for the `Gmail: Send Welcome Email` node.\n\n## How to customize the workflow\nYou can easily customize this workflow to send different emails based on deal properties. Add an `If` node after the `HubSpot: Get Deal Details` node to check for the deal's value, product line, or region.\n\nBased on these properties, you can route the flow to different `AI: Write Welcome Email` nodes with unique prompts. For example, you could **check the contact's 'industry' or 'company size' to send them links to different, more relevant 'Getting Started' videos and documentation.**",
  "featuredImage": "/data/workflows/10398/10398.webp",
  "author": {
    "id": 101,
    "slug": "Pollup",
    "name": "PollupAI",
    "avatar": ""
  },
  "categories": [
    "CRM",
    "Multimodal AI"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 106,
  "downloads": 10,
  "createdAt": "2025-10-31T16:17:11.912Z",
  "updatedAt": "2026-01-16T09:04:53.073Z",
  "publishedAt": "2025-10-31T16:17:11.912Z",
  "nodes": 22,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/10398",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Smart CSM assignment & AI welcome emails for HubSpot deal wins with Gmail",
    "workflowName": "Smart CSM assignment & AI welcome emails for HubSpot deal wins with Gmail",
    "description": "## Who's it for\nThis template is for Customer Success and Sales teams who use HubSpot. It automates the critical handoff from sales to success, ensuring every new customer gets a fast, personalized welcome. It's perfect for anyone looking to standardize their onboarding process, save time on manual tasks, and improve the new customer experience using AI.\n\n## What it does\nThis workflow triggers when a deal's \"Is closed won\" property is set to `True` in HubSpot. It assigns a Customer Success Manager (CSM) by querying an **n8n Data Table to find the 'least busy' CSM (based on a deal count)** and fetches the deal's details to find all associated contacts.\n\nIt then loops to identify the \"Champion\" contact by checking their \"Buying Role\" (`hs_buying_role`). An AI agent (in the `AI: Write Welcome Email` node) generates a personalized welcome email, which is converted to HTML and sent via Gmail. Finally, the workflow updates the Champion's contact record in HubSpot and **updates the CSM's deal count in the Data Table** to keep the logic in sync.\n\n## How to set up\n1.  **Create and Populate Data Table:** This template requires an n8n Data Table to manage CSM assignments.\n    * Create a Data Table named `csm_assignments`.\n    * Add two columns: `csm_id` (String) and `deal_count` (Number).\n    * Add one row for each CSM with their HubSpot Owner ID and a starting `deal_count` of `0`.\n2.  **Link Data Table Nodes:** Open the `Get CSM List` and `Increment CSM Deal Count` nodes and select the `csm_assignments` table you just created from the **Table** dropdown.\n3.  **Configure Variables:** In the `Configure Template Variables` node, you must set your sender info (`company_name`, `sender_name`, and `sender_email`).\n4.  **Customize AI Prompt:** In the `AI: Write Welcome Email` node, update the placeholder `[Link to Your Video]` and `[Link to Your Help Doc]` links with your own URLs.\n5.  **Check HubSpot Property:** This workflow assumes you use the \"Buying Role\" (`hs_buying_role`) contact property to identify your \"Champion\". If you use a different property, you must update the `HubSpot: Get Contact Details` and `If Role is 'Champion'` nodes.\n\n## Requirements\n* Access to **n8n Data Tables**.\n* **HubSpot (Developer API):** A credential for the `Trigger: Deal Is 'Closed Won'` node.\n* **HubSpot (OAuth2):** A credential for all other HubSpot nodes (`Get Deal Details`, `Get Contact Details`, `Assign Contact Owner`).\n* **AI Credentials:** (e.g., OpenAI) Credentials for the `AI Model` node (the node connected to `AI: Write Welcome Email`).\n* **Email Credentials:** (e.g., Gmail) Credentials for the `Gmail: Send Welcome Email` node.\n\n## How to customize the workflow\nYou can easily customize this workflow to send different emails based on deal properties. Add an `If` node after the `HubSpot: Get Deal Details` node to check for the deal's value, product line, or region.\n\nBased on these properties, you can route the flow to different `AI: Write Welcome Email` nodes with unique prompts. For example, you could **check the contact's 'industry' or 'company size' to send them links to different, more relevant 'Getting Started' videos and documentation.**",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Structured Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "role": "outputParserStructured",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "If Deal Is Won",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Configure Template Variables",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "If Role is 'Champion'",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "HubSpot: Get Deal Details",
      "type": "n8n-nodes-base.hubspot",
      "role": "hubspot",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Split Contact IDs",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "HubSpot: Get Contact Details",
      "type": "n8n-nodes-base.hubspot",
      "role": "hubspot",
      "configDescription": "Version 2.2"
    },
    {
      "name": "AI: Write Welcome Email",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.9"
    },
    {
      "name": "AI Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "role": "lmChatOpenAi",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Util: Markdown to HTML",
      "type": "n8n-nodes-base.markdown",
      "role": "markdown",
      "configDescription": "Version 1"
    },
    {
      "name": "Gmail: Send Welcome Email",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "HubSpot: Assign Contact Owner",
      "type": "n8n-nodes-base.hubspot",
      "role": "hubspot",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Trigger: Deal Is 'Closed Won'",
      "type": "n8n-nodes-base.hubspotTrigger",
      "role": "hubspotTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Get CSM List",
      "type": "n8n-nodes-base.dataTable",
      "role": "dataTable",
      "configDescription": "Version 1"
    },
    {
      "name": "Find Least Busy CSM",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Increment CSM Deal Count",
      "type": "n8n-nodes-base.dataTable",
      "role": "dataTable",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}