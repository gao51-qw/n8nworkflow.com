{
  "id": 8871,
  "slug": "8871",
  "title": "Sync Gmail emails to PostgreSQL with S3 attachment storage",
  "description": "## Sync Gmail emails to PostgreSQL with S3 attachment storage\n\n**Automated Gmail Email Processing System**\n\n## Who's it for\nBusinesses and individuals who need to:\n- Archive email communications in a searchable database\n- Backup email attachments to cloud storage\n- Analyze email patterns and communication data\n- Comply with data retention policies\n- Integrate emails with other business systems\n\n## What it does\nThis workflow automatically captures, processes, and stores Gmail emails in a PostgreSQL database while uploading file attachments to S3/MinIO storage. It handles both individual emails (via Gmail Trigger) and bulk processing (via Schedule Trigger).\n\n**Key features:**\n- Dual processing: real-time individual emails + scheduled bulk retrieval\n- Complete email metadata extraction (sender, recipients, labels, timestamps)\n- HTML to plain text conversion for searchable content\n- Binary attachment processing with metadata extraction\n- Organized S3/MinIO file storage structure\n- UPSERT database operations to prevent duplicates\n\n## How it works\n1. **Email Capture**: Gmail Trigger detects new emails, Schedule Trigger gets bulk emails from last hour\n2. **Parallel Processing**: Emails with attachments go through binary processing, others go directly to transformation\n3. **Attachment Handling**: Extract metadata, upload to S3/MinIO, create database references\n4. **Data Transformation**: Convert Gmail API format to PostgreSQL structure\n5. **Storage**: UPSERT emails to database with linked attachment information\n\n## Requirements\n**Credentials needed:**\n- Gmail OAuth2 (gmail.readonly scope)\n- PostgreSQL database connection\n- S3/MinIO storage credentials\n\n**Database setup:**\nRun the provided SQL schema to create the messages table with JSONB fields for flexible data storage.\n\n## How to set up\n1. **Gmail OAuth2**: Enable Gmail API in Google Cloud Console, create OAuth2 credentials\n2. **PostgreSQL**: Create database and run the SQL schema provided in setup sticky note\n3. **S3/MinIO**: Create bucket \"gmail-attachments\" with proper upload permissions\n4. **Configure**: Update authenticatedUserEmail in transform scripts to your email\n5. **Test**: Start with single email before enabling bulk processing\n\n## How to customize\n- **Email filters**: Modify Gmail queries (in:sent, in:inbox) to target specific emails\n- **Storage structure**: Change S3 file path format in Upload node\n- **Processing schedule**: Adjust trigger frequencies based on email volume\n- **Database fields**: Extend PostgreSQL schema for additional metadata\n- **Attachment types**: Add file type filtering in binary processing logic\n\n**Note**: This workflow processes emails from the last hour to avoid overwhelming the system. Adjust timeframes based on your email volume and processing needs.",
  "featuredImage": "/data/workflows/8871/8871.webp",
  "author": {
    "id": 101,
    "slug": "josecuartas",
    "name": "Jose Cuartas",
    "avatar": ""
  },
  "categories": [
    "Document Extraction"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 186,
  "downloads": 18,
  "createdAt": "2025-09-23T15:48:29.816Z",
  "updatedAt": "2026-01-16T08:58:06.680Z",
  "publishedAt": "2025-09-23T15:48:29.816Z",
  "nodes": 30,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/8871",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Sync Gmail emails to PostgreSQL with S3 attachment storage",
    "workflowName": "Sync Gmail emails to PostgreSQL with S3 attachment storage",
    "description": "## Sync Gmail emails to PostgreSQL with S3 attachment storage\n\n**Automated Gmail Email Processing System**\n\n## Who's it for\nBusinesses and individuals who need to:\n- Archive email communications in a searchable database\n- Backup email attachments to cloud storage\n- Analyze email patterns and communication data\n- Comply with data retention policies\n- Integrate emails with other business systems\n\n## What it does\nThis workflow automatically captures, processes, and stores Gmail emails in a PostgreSQL database while uploading file attachments to S3/MinIO storage. It handles both individual emails (via Gmail Trigger) and bulk processing (via Schedule Trigger).\n\n**Key features:**\n- Dual processing: real-time individual emails + scheduled bulk retrieval\n- Complete email metadata extraction (sender, recipients, labels, timestamps)\n- HTML to plain text conversion for searchable content\n- Binary attachment processing with metadata extraction\n- Organized S3/MinIO file storage structure\n- UPSERT database operations to prevent duplicates\n\n## How it works\n1. **Email Capture**: Gmail Trigger detects new emails, Schedule Trigger gets bulk emails from last hour\n2. **Parallel Processing**: Emails with attachments go through binary processing, others go directly to transformation\n3. **Attachment Handling**: Extract metadata, upload to S3/MinIO, create database references\n4. **Data Transformation**: Convert Gmail API format to PostgreSQL structure\n5. **Storage**: UPSERT emails to database with linked attachment information\n\n## Requirements\n**Credentials needed:**\n- Gmail OAuth2 (gmail.readonly scope)\n- PostgreSQL database connection\n- S3/MinIO storage credentials\n\n**Database setup:**\nRun the provided SQL schema to create the messages table with JSONB fields for flexible data storage.\n\n## How to set up\n1. **Gmail OAuth2**: Enable Gmail API in Google Cloud Console, create OAuth2 credentials\n2. **PostgreSQL**: Create database and run the SQL schema provided in setup sticky note\n3. **S3/MinIO**: Create bucket \"gmail-attachments\" with proper upload permissions\n4. **Configure**: Update authenticatedUserEmail in transform scripts to your email\n5. **Test**: Start with single email before enabling bulk processing\n\n## How to customize\n- **Email filters**: Modify Gmail queries (in:sent, in:inbox) to target specific emails\n- **Storage structure**: Change S3 file path format in Upload node\n- **Processing schedule**: Adjust trigger frequencies based on email volume\n- **Database fields**: Extend PostgreSQL schema for additional metadata\n- **Attachment types**: Add file type filtering in binary processing logic\n\n**Note**: This workflow processes emails from the last hour to avoid overwhelming the system. Adjust timeframes based on your email volume and processing needs.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "SYSTEM OVERVIEW",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "SETUP REQUIREMENTS",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "SYSTEM TRIGGERS",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "EMAIL RETRIEVAL",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "ATTACHMENT PROCESSING",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "DATA MAPPING",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "DATA TRANSFORMATION",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "DATABASE STORAGE",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "SCRIPT: Extract Binary",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "SCRIPT: Email Transform",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Process Items Loop",
      "type": "n8n-nodes-base.splitInBatches",
      "role": "splitInBatches",
      "configDescription": "Version 3"
    },
    {
      "name": "Extract Binary Metadata",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Link Email Attachments",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Structure Fields",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Final Merge",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3.2"
    },
    {
      "name": "Aggregate Attachments",
      "type": "n8n-nodes-base.aggregate",
      "role": "aggregate",
      "configDescription": "Version 1"
    },
    {
      "name": "Insert or Update Database",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.6"
    },
    {
      "name": "Binary Data Filter",
      "type": "n8n-nodes-base.filter",
      "role": "filter",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Upload to Storage",
      "type": "n8n-nodes-base.s3",
      "role": "s3",
      "configDescription": "Version 1"
    },
    {
      "name": "Flow Convergence",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "End Loop",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "Get Individual Message",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Get Many Sent",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Get Many Inbox",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "role": "scheduleTrigger",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Gmail Trigger",
      "type": "n8n-nodes-base.gmailTrigger",
      "role": "gmailTrigger",
      "configDescription": "Version 1.3"
    },
    {
      "name": "Email to PostgreSQL Transform",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Split Attachments",
      "type": "n8n-nodes-base.splitOut",
      "role": "splitOut",
      "configDescription": "Version 1"
    },
    {
      "name": "Merge Attachments",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 3.2"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}