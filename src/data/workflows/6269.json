{
  "id": 6269,
  "slug": "6269",
  "title": "üõ†Ô∏è State Management System for Long-Running Workflows with Wait Nodes",
  "description": "## How it works\n\nThis template is a powerful, reusable utility for managing **stateful, long-running processes**. It allows a main workflow to be paused indefinitely at \"checkpoints\" and then be resumed by external, asynchronous events.\n\nThis pattern is essential for complex automations and I often call it the **\"Async Portal\"** or **\"Teleport\"** pattern.\n\nThe template consists of two distinct parts:\n1.  **The Main Process (Top Flow):** This represents your primary business logic. It starts, performs some actions, and then calls the Portal to register itself before pausing at a `Wait` node (a \"Checkpoint\").\n2.  **The Async Portal (Bottom Flow):** This is the state-management engine. It uses **Workflow Static Data** as a persistent memory to keep track of all paused processes. When an external event (like a new chat message or an approval webhook) comes in with a specific `session_id`, the Portal looks up the corresponding paused workflow and \"teleports\" the new data to it by calling its unique `resume_url`.\n\nThis architecture allows you to build sophisticated systems where the state is managed centrally, and your main business logic remains clean and easy to follow.\n\n## When to use this pattern\n\nThis is an advanced utility ideal for:\n*   **Chatbots:** Maintaining conversation history and context across multiple user messages.\n*   **Human-in-the-Loop Processes:** Pausing a workflow to wait for a manager's approval from an email link or a form submission.\n*   **Multi-Day Sequences:** Building user onboarding flows or drip campaigns that need to pause for hours or days between steps.\n*   **Any process that needs to wait for an unpredictable external event** without timing out.\n\n## Set up steps\n\nThis template is a utility designed to be copied into your own projects. The workflow itself is a live demonstration of how to use it.\n\n1.  **Copy the Async Portal:** In your own project, copy the entire **Async Portal** (the bottom flow, starting with the `A. Entry: Receive Session Info` trigger) into your workflow. This will be your state management engine.\n\n2.  **Register Your Main Process:** At the beginning of your main workflow, use an `Execute Workflow` node to call the Portal's trigger. You must pass it a unique `session_id` for the process and the `resume_url` from a `Wait` node.\n\n3.  **Add Checkpoints:** Place `Wait` nodes in your main workflow wherever you need the process to pause and wait for an external event.\n\n4.  **Trigger the Portal:** Configure your external triggers (e.g., your chatbot's webhook) to call the **Portal's entry trigger**, not your main workflow's trigger. You must pass the same `session_id` so the Portal knows which paused process to resume.\n\n**To see it in action, follow the detailed instructions in the \"How to Test This Workflow\" sticky note on the canvas.**",
  "featuredImage": "/data/workflows/6269/6269.webp",
  "author": {
    "id": 101,
    "slug": "lucaspeyrin",
    "name": "Lucas Peyrin",
    "avatar": ""
  },
  "categories": [
    "Engineering"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 1984,
  "downloads": 198,
  "createdAt": "2025-07-22T12:00:36.288Z",
  "updatedAt": "2026-01-16T08:44:09.101Z",
  "publishedAt": "2025-07-22T12:00:36.288Z",
  "nodes": 42,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/6269",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "üõ†Ô∏è State Management System for Long-Running Workflows with Wait Nodes",
    "workflowName": "üõ†Ô∏è State Management System for Long-Running Workflows with Wait Nodes",
    "description": "## How it works\n\nThis template is a powerful, reusable utility for managing **stateful, long-running processes**. It allows a main workflow to be paused indefinitely at \"checkpoints\" and then be resumed by external, asynchronous events.\n\nThis pattern is essential for complex automations and I often call it the **\"Async Portal\"** or **\"Teleport\"** pattern.\n\nThe template consists of two distinct parts:\n1.  **The Main Process (Top Flow):** This represents your primary business logic. It starts, performs some actions, and then calls the Portal to register itself before pausing at a `Wait` node (a \"Checkpoint\").\n2.  **The Async Portal (Bottom Flow):** This is the state-management engine. It uses **Workflow Static Data** as a persistent memory to keep track of all paused processes. When an external event (like a new chat message or an approval webhook) comes in with a specific `session_id`, the Portal looks up the corresponding paused workflow and \"teleports\" the new data to it by calling its unique `resume_url`.\n\nThis architecture allows you to build sophisticated systems where the state is managed centrally, and your main business logic remains clean and easy to follow.\n\n## When to use this pattern\n\nThis is an advanced utility ideal for:\n*   **Chatbots:** Maintaining conversation history and context across multiple user messages.\n*   **Human-in-the-Loop Processes:** Pausing a workflow to wait for a manager's approval from an email link or a form submission.\n*   **Multi-Day Sequences:** Building user onboarding flows or drip campaigns that need to pause for hours or days between steps.\n*   **Any process that needs to wait for an unpredictable external event** without timing out.\n\n## Set up steps\n\nThis template is a utility designed to be copied into your own projects. The workflow itself is a live demonstration of how to use it.\n\n1.  **Copy the Async Portal:** In your own project, copy the entire **Async Portal** (the bottom flow, starting with the `A. Entry: Receive Session Info` trigger) into your workflow. This will be your state management engine.\n\n2.  **Register Your Main Process:** At the beginning of your main workflow, use an `Execute Workflow` node to call the Portal's trigger. You must pass it a unique `session_id` for the process and the `resume_url` from a `Wait` node.\n\n3.  **Add Checkpoints:** Place `Wait` nodes in your main workflow wherever you need the process to pause and wait for an external event.\n\n4.  **Trigger the Portal:** Configure your external triggers (e.g., your chatbot's webhook) to call the **Portal's entry trigger**, not your main workflow's trigger. You must pass the same `session_id` so the Portal knows which paused process to resume.\n\n**To see it in action, follow the detailed instructions in the \"How to Test This Workflow\" sticky note on the canvas.**",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "D. TELEPORT: Resume Paused Workflow",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "E. Stop This Execution",
      "type": "n8n-nodes-base.filter",
      "role": "filter",
      "configDescription": "Version 2.2"
    },
    {
      "name": "B. Check if Session is New or Existing",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "F. Prepare Initial Data",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "G. Return Data to Main Workflow",
      "type": "n8n-nodes-base.splitOut",
      "role": "splitOut",
      "configDescription": "Version 1"
    },
    {
      "name": "C. Route Based on Session State",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Stop Session On Error ?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Reset Session",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Respond with Input Items",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "Wait Node Sent Response Items ?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Send Items From Checkpoint",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note13",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "A. Entry: Receive Session Info",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "role": "executeWorkflowTrigger",
      "configDescription": "Version 1.1"
    },
    {
      "name": "1. Start Main Workflow (Manual)",
      "type": "n8n-nodes-base.manualTrigger",
      "role": "manualTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "2. Call Async Portal",
      "type": "n8n-nodes-base.executeWorkflow",
      "role": "executeWorkflow",
      "configDescription": "Version 1.2"
    },
    {
      "name": "3. Process Initial Data (Before Checkpoint 1)",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "4. PAUSE at Checkpoint 1",
      "type": "n8n-nodes-base.wait",
      "role": "wait",
      "configDescription": "Version 1.1"
    },
    {
      "name": "5a. Receive Resumed Data",
      "type": "n8n-nodes-base.splitOut",
      "role": "splitOut",
      "configDescription": "Version 1"
    },
    {
      "name": "6. PAUSE at Checkpoint 2",
      "type": "n8n-nodes-base.wait",
      "role": "wait",
      "configDescription": "Version 1.1"
    },
    {
      "name": "7. Process Final Data (After Checkpoint 2)",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note14",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "5b. Send Back Data to Portal",
      "type": "n8n-nodes-base.respondToWebhook",
      "role": "respondToWebhook",
      "configDescription": "Version 1.4"
    },
    {
      "name": "Response From Checkpoint",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Split Out Teleported Items",
      "type": "n8n-nodes-base.splitOut",
      "role": "splitOut",
      "configDescription": "Version 1"
    },
    {
      "name": "How to Test",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note15",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note16",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note17",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note18",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note20",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}