{
  "id": 3079,
  "slug": "3079",
  "title": "Query Google Sheets/CSV data through an AI agent using PostgreSQL",
  "description": "Want to see it in action? Watch the full breakdown here: [ðŸ“º Video Link](https://www.youtube.com/watch?v=uj_XpLSMRmk)  \n\n### **Template Description**  \nThis n8n workflow empowers you to query structured financial data from Google Sheets or CSV files using AI-generated SQL. Unlike traditional vector database solutions that falter with numerical queries, this template leverages PostgreSQL for efficient data storage and an AI agent to dynamically create optimized SQL queries from natural language inputs.\n\n#### **What It Does**  \n- Retrieves data from Google Sheets or CSV files  \n- Infers the data schema and builds a PostgreSQL table  \n- Populates the table with your data  \n- Uses an AI agent to translate natural language questions into SQL queries  \n- Returns precise numerical results quickly and efficiently  \n\n#### **Why Use This?**  \n- No SQL knowledge requiredâ€”the AI generates queries for you  \n- Bypasses the inefficiencies and costs of vector database approaches  \n- Scales effortlessly without overwhelming the language model  \n- Fully free and open-source  \n\n---\n\n### **Setup Requirements**  \n\n#### **Pre-Conditions**  \n- **PostgreSQL Database**: A running PostgreSQL instance (no specific extensions required beyond standard installation).  \n- **Google Sheets Access**: A publicly accessible or shared Google Sheet URL with structured data (e.g., financial records). Need a starting point? Use this [Sample Google Sheet Template](insert-link-here).  \n- **n8n Instance**: A working n8n setup with access to the Google Drive and PostgreSQL nodes.  \n\n#### **Step-by-Step Instructions**  \n1. **Add Your Google Sheets URL**  \n   - Open the \"Google Drive Trigger\" node.  \n   - Replace the placeholder URL with your Google Sheetâ€™s link.  \n   - Verify the sheet name matches your data source.  \n\n2. **Configure PostgreSQL**  \n   - Update the \"PostgreSQL\" nodes with your database credentials (host, database, user, password).  \n   - The workflow automatically creates and populates the table based on your data schema.  \n\n3. **Run the Workflow**  \n   - Execute the workflow manually to set up the database.  \n   - Once initialized, use the AI agent by asking questions like:  \n     - _\"How much did I sell last week?\"_  \n     - _\"What were the total sales for Product X in February?\"_  \n\n4. **(Optional) Automate Updates**  \n   - Add a \"Schedule Trigger\" node to sync your Google Sheets data with PostgreSQL on a regular basis.  \n\n---\n\n### **How It Works**  \n- **Schema Detection**: The workflow analyzes your Google Sheets or CSV data to infer its structure and create an appropriate PostgreSQL table.  \n- **AI-Powered Queries**: An optimized AI agent converts your natural language questions into precise SQL queries, ensuring accurate results.  \n- **Efficient Retrieval**: By using PostgreSQL instead of vector-based methods, this template avoids common pitfalls like slow performance or inaccurate numerical outputs.  \n\n---\n\n### **Tips for Success**  \n- Ensure your Google Sheet or CSV has consistent column headers for smooth schema detection.  \n- Test with simple questions first to verify the AI agentâ€™s query generation.  \n- Check out the [n8n Template Submission Guidelines](insert-link-here) for more best practices.  ",
  "featuredImage": "/data/workflows/3079/3079.webp",
  "author": {
    "id": 101,
    "slug": "leonardogrig",
    "name": "Leonardo Grigorio",
    "avatar": ""
  },
  "categories": [
    "Document Extraction",
    "AI RAG"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 9915,
  "downloads": 991,
  "createdAt": "2025-03-04T20:13:37.139Z",
  "updatedAt": "2026-01-16T08:27:57.579Z",
  "publishedAt": "2025-03-04T20:13:37.139Z",
  "nodes": 23,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/3079",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Query Google Sheets/CSV data through an AI agent using PostgreSQL",
    "workflowName": "Query Google Sheets/CSV data through an AI agent using PostgreSQL",
    "description": "Want to see it in action? Watch the full breakdown here: [ðŸ“º Video Link](https://www.youtube.com/watch?v=uj_XpLSMRmk)  \n\n### **Template Description**  \nThis n8n workflow empowers you to query structured financial data from Google Sheets or CSV files using AI-generated SQL. Unlike traditional vector database solutions that falter with numerical queries, this template leverages PostgreSQL for efficient data storage and an AI agent to dynamically create optimized SQL queries from natural language inputs.\n\n#### **What It Does**  \n- Retrieves data from Google Sheets or CSV files  \n- Infers the data schema and builds a PostgreSQL table  \n- Populates the table with your data  \n- Uses an AI agent to translate natural language questions into SQL queries  \n- Returns precise numerical results quickly and efficiently  \n\n#### **Why Use This?**  \n- No SQL knowledge requiredâ€”the AI generates queries for you  \n- Bypasses the inefficiencies and costs of vector database approaches  \n- Scales effortlessly without overwhelming the language model  \n- Fully free and open-source  \n\n---\n\n### **Setup Requirements**  \n\n#### **Pre-Conditions**  \n- **PostgreSQL Database**: A running PostgreSQL instance (no specific extensions required beyond standard installation).  \n- **Google Sheets Access**: A publicly accessible or shared Google Sheet URL with structured data (e.g., financial records). Need a starting point? Use this [Sample Google Sheet Template](insert-link-here).  \n- **n8n Instance**: A working n8n setup with access to the Google Drive and PostgreSQL nodes.  \n\n#### **Step-by-Step Instructions**  \n1. **Add Your Google Sheets URL**  \n   - Open the \"Google Drive Trigger\" node.  \n   - Replace the placeholder URL with your Google Sheetâ€™s link.  \n   - Verify the sheet name matches your data source.  \n\n2. **Configure PostgreSQL**  \n   - Update the \"PostgreSQL\" nodes with your database credentials (host, database, user, password).  \n   - The workflow automatically creates and populates the table based on your data schema.  \n\n3. **Run the Workflow**  \n   - Execute the workflow manually to set up the database.  \n   - Once initialized, use the AI agent by asking questions like:  \n     - _\"How much did I sell last week?\"_  \n     - _\"What were the total sales for Product X in February?\"_  \n\n4. **(Optional) Automate Updates**  \n   - Add a \"Schedule Trigger\" node to sync your Google Sheets data with PostgreSQL on a regular basis.  \n\n---\n\n### **How It Works**  \n- **Schema Detection**: The workflow analyzes your Google Sheets or CSV data to infer its structure and create an appropriate PostgreSQL table.  \n- **AI-Powered Queries**: An optimized AI agent converts your natural language questions into precise SQL queries, ensuring accurate results.  \n- **Efficient Retrieval**: By using PostgreSQL instead of vector-based methods, this template avoids common pitfalls like slow performance or inaccurate numerical outputs.  \n\n---\n\n### **Tips for Success**  \n- Ensure your Google Sheet or CSV has consistent column headers for smooth schema detection.  \n- Test with simple questions first to verify the AI agentâ€™s query generation.  \n- Check out the [n8n Template Submission Guidelines](insert-link-here) for more best practices.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "create table query",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "create insertion query",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Google Drive Trigger",
      "type": "n8n-nodes-base.googleDriveTrigger",
      "role": "googleDriveTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "execute_query_tool",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "role": "toolWorkflow",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "role": "lmChatGoogleGemini",
      "configDescription": "Version 1"
    },
    {
      "name": "get_postgres_schema",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "role": "toolWorkflow",
      "configDescription": "Version 2"
    },
    {
      "name": "change_this",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "is not in database",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "table exists?",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "fetch sheet data",
      "type": "n8n-nodes-base.googleSheets",
      "role": "googleSheets",
      "configDescription": "Version 4.5"
    },
    {
      "name": "remove table",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "create table",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "perform insertion",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "Execute Workflow Trigger",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "role": "executeWorkflowTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "When chat message received",
      "type": "@n8n/n8n-nodes-langchain.manualChatTrigger",
      "role": "manualChatTrigger",
      "configDescription": "Version 1.1"
    },
    {
      "name": "response output",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "sql query executor",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "schema finder",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.5"
    },
    {
      "name": "schema to string",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "AI Agent With SQL Query Prompt",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 1.7"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}