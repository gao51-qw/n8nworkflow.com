{
  "id": 1993,
  "slug": "1993",
  "title": "Suspicious login detection",
  "description": "This n8n workflow is designed for security monitoring and incident response when suspicious login events are detected. It can be initiated either manually from within the n8n UI for testing or automatically triggered by a webhook when a new login event occurs.\n\nThe workflow first extracts relevant data from the incoming webhook payload, including the IP address, user agent, timestamp, URL, and user ID. It then splits into three parallel processing paths.\n\nIn the first path, it queries GreyNoise's Community API to retrieve information about the investigated IP address. Depending on the classification and trust level received from GreyNoise, the alert is given a High, Medium, or Low priority. This priority is assigned based on the best practices documentation from GreyNoise on how to apply their data to analysis. Once a priority is assigned, a message is sent to a Slack channel to notify users about the alert.\n\nThe second path involves fetching geolocation data about the IP address using IP-API's Geolocation API and merging it with data from the UserParser node. This data is then combined with the data obtained from GreyNoise.\n\nIn the third path, the UserParser node queries the Userparser IP address and user agent lookup API to obtain information about the user's IP and user agent. This data is merged with the IP-API data and GreyNoise data.\n\nThe workflow then checks if the IP address is considered an unknown threat by examining both the noise and riot fields from GreyNoise. If it is considered an unknown threat, the workflow proceeds to retrieve the last 10 login records for the same user from a Postgres database.\n\nIf there are any discrepancies in the login information, indicating a new location or device/browser, the user is informed via email.\n\nPotential issues when setting up this workflow include ensuring that credentials are correctly entered for GreyNoise and UserParser nodes, and addressing any discrepancies in the data sources that could lead to false positives or negatives in threat detection. Additionally, the usage of hardcoded API keys should be replaced with credentials for security and flexibility. Thorough testing and validation with sample data are crucial to ensure the workflow performs as expected and aligns with security incident response procedures.",
  "featuredImage": "/data/workflows/1993/1993.webp",
  "author": {
    "id": 101,
    "slug": "n8n-team",
    "name": "n8n Team",
    "avatar": ""
  },
  "categories": [
    "SecOps"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 7157,
  "downloads": 715,
  "createdAt": "2023-11-27T12:16:59.192Z",
  "updatedAt": "2026-01-16T08:22:33.536Z",
  "publishedAt": "2023-11-27T12:16:59.192Z",
  "nodes": 43,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/1993",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Suspicious login detection",
    "workflowName": "Suspicious login detection",
    "description": "This n8n workflow is designed for security monitoring and incident response when suspicious login events are detected. It can be initiated either manually from within the n8n UI for testing or automatically triggered by a webhook when a new login event occurs.\n\nThe workflow first extracts relevant data from the incoming webhook payload, including the IP address, user agent, timestamp, URL, and user ID. It then splits into three parallel processing paths.\n\nIn the first path, it queries GreyNoise's Community API to retrieve information about the investigated IP address. Depending on the classification and trust level received from GreyNoise, the alert is given a High, Medium, or Low priority. This priority is assigned based on the best practices documentation from GreyNoise on how to apply their data to analysis. Once a priority is assigned, a message is sent to a Slack channel to notify users about the alert.\n\nThe second path involves fetching geolocation data about the IP address using IP-API's Geolocation API and merging it with data from the UserParser node. This data is then combined with the data obtained from GreyNoise.\n\nIn the third path, the UserParser node queries the Userparser IP address and user agent lookup API to obtain information about the user's IP and user agent. This data is merged with the IP-API data and GreyNoise data.\n\nThe workflow then checks if the IP address is considered an unknown threat by examining both the noise and riot fields from GreyNoise. If it is considered an unknown threat, the workflow proceeds to retrieve the last 10 login records for the same user from a Postgres database.\n\nIf there are any discrepancies in the login information, indicating a new location or device/browser, the user is informed via email.\n\nPotential issues when setting up this workflow include ensuring that credentials are correctly entered for GreyNoise and UserParser nodes, and addressing any discrepancies in the data sources that could lead to false positives or negatives in threat detection. Additionally, the usage of hardcoded API keys should be replaced with credentials for security and flexibility. Thorough testing and validation with sample data are crucial to ensure the workflow performs as expected and aligns with security incident response procedures.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Extract relevant data",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 2"
    },
    {
      "name": "New /login event",
      "type": "n8n-nodes-base.webhook",
      "role": "webhook",
      "configDescription": "Version 1"
    },
    {
      "name": "Unknown threat?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 1"
    },
    {
      "name": "Get last 10 logins from the same user",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Query IP API1",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.1"
    },
    {
      "name": "New location?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 1"
    },
    {
      "name": "Parse User Agent",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.1"
    },
    {
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 2.1"
    },
    {
      "name": "New Device/Browser?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 1"
    },
    {
      "name": "Complete login info",
      "type": "n8n-nodes-base.merge",
      "role": "merge",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Query user by ID",
      "type": "n8n-nodes-base.postgres",
      "role": "postgres",
      "configDescription": "Version 2.2"
    },
    {
      "name": "New Location",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "New Device/Browser",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "User has email?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 1"
    },
    {
      "name": "HTML",
      "type": "n8n-nodes-base.html",
      "role": "html",
      "configDescription": "Version 1"
    },
    {
      "name": "Inform user",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2"
    },
    {
      "name": "noise?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 1"
    },
    {
      "name": "Slack",
      "type": "n8n-nodes-base.slack",
      "role": "slack",
      "configDescription": "Version 2"
    },
    {
      "name": "Check trust level",
      "type": "n8n-nodes-base.switch",
      "role": "switch",
      "configDescription": "Version 1"
    },
    {
      "name": "Check classification",
      "type": "n8n-nodes-base.switch",
      "role": "switch",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "riot?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 1"
    },
    {
      "name": "ðŸ”´ Priority: HIGH",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 2"
    },
    {
      "name": "ðŸŸ¡ Priority: MEDIUM",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 2"
    },
    {
      "name": "ðŸŸ¢ Priority: LOW",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 2"
    },
    {
      "name": "GreyNoise",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.1"
    },
    {
      "name": "IP API",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.1"
    },
    {
      "name": "UserParser",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.1"
    },
    {
      "name": "When clicking \"Execute Workflow\"",
      "type": "n8n-nodes-base.manualTrigger",
      "role": "manualTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Example event",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note11",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note12",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sticky Note13",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Known, Do Nothing",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "Known Location",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "Old Device/Browser",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    },
    {
      "name": "Not Riot",
      "type": "n8n-nodes-base.noOp",
      "role": "noOp",
      "configDescription": "Version 1"
    }
  ]
}