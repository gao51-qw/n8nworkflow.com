{
  "id": 3723,
  "slug": "3723",
  "title": "Create or find Stripe customers and automatically generate invoices",
  "description": "Save hours of manual billing work with this Stripe automation workflow!  \nDesigned for entrepreneurs, SaaS founders, and online business owners, this template checks if a customer already exists in Stripe based on their email. If no customer is found, it automatically creates a new one, generates a draft invoice, adds a product line item using a Stripe Price ID, and finalizes the invoice — making it ready for payment.  \nThis workflow helps ensure clean customer data and efficient billing without manual input.\n\n### How it works\n\n- Search Stripe for an existing customer based on the provided email address.\n- If no customer is found, create a new one in Stripe automatically.\n- Generate a draft invoice associated with the customer.\n- Add a line item to the invoice using a Stripe Price ID.\n- Finalize the invoice to make it ready to send or collect payment.\n\n### Set up steps\n\n1. **Stripe account setup**:  \n   - Ensure you have a valid Stripe account.  \n   - Create a **restricted Stripe API key** with permissions to `read` and `write` Customers, Invoices, and Invoice Items.  \n\n2. **Connect Stripe to n8n**:  \n   - Set up an HTTP Basic Auth credential in n8n using your Stripe secret API key.  \n   - No username is needed; the API key goes into the password field.\n\n3. **Customize dynamic data**:  \n   - Replace the sample email (`test@example.com`) with your real dynamic customer email input.  \n   - Replace the example Price ID (`price_fromStripeDashboard`) with your actual product Price ID from the Stripe dashboard.\n\n4. **Test your workflow**:  \n   - Manually trigger the workflow inside n8n to ensure customers and invoices are being created correctly.\n   - Check your Stripe dashboard to confirm that new customers and invoices appear as expected.\n\n5. **Deploy to production**:  \n   - Integrate this workflow with a real trigger (e.g., webhook, form submission) to automate the process live.\n\n### Troubleshooting\n\n- **Invalid API Key**:  \n  Double-check that your Stripe API key is active and has the necessary permissions. Test it by making a simple API call manually if needed.\n\n- **Invoice Creation Fails**:  \n  Make sure you are using a valid `Price ID` from Stripe. The price must be active and available for the correct product.\n\n- **Customer Not Found Error**:  \n  If the search fails due to formatting issues, ensure emails are valid and the query syntax matches Stripe's customer search format.\n\n- **Authentication Errors**:  \n  If authentication fails, ensure you have selected **HTTP Basic Auth** in the HTTP Request nodes and left the username field empty.\n\n### Stripe prerequisites\n\n- You must have at least one active Price object created in your Stripe dashboard.  \n- Your Stripe account must be live or have access to test mode if you're working in development.  \n- Ensure your account has API access enabled for Customers, Invoices, and Products.",
  "featuredImage": "/data/workflows/3723/3723.webp",
  "author": {
    "id": 101,
    "slug": "xqus",
    "name": "Audun",
    "avatar": ""
  },
  "categories": [
    "Invoice Processing"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 504,
  "downloads": 50,
  "createdAt": "2025-04-26T19:19:08.972Z",
  "updatedAt": "2026-01-16T08:31:16.914Z",
  "publishedAt": "2025-04-26T19:19:08.972Z",
  "nodes": 10,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/3723",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Create or find Stripe customers and automatically generate invoices",
    "workflowName": "Create or find Stripe customers and automatically generate invoices",
    "description": "Save hours of manual billing work with this Stripe automation workflow!  \nDesigned for entrepreneurs, SaaS founders, and online business owners, this template checks if a customer already exists in Stripe based on their email. If no customer is found, it automatically creates a new one, generates a draft invoice, adds a product line item using a Stripe Price ID, and finalizes the invoice — making it ready for payment.  \nThis workflow helps ensure clean customer data and efficient billing without manual input.\n\n### How it works\n\n- Search Stripe for an existing customer based on the provided email address.\n- If no customer is found, create a new one in Stripe automatically.\n- Generate a draft invoice associated with the customer.\n- Add a line item to the invoice using a Stripe Price ID.\n- Finalize the invoice to make it ready to send or collect payment.\n\n### Set up steps\n\n1. **Stripe account setup**:  \n   - Ensure you have a valid Stripe account.  \n   - Create a **restricted Stripe API key** with permissions to `read` and `write` Customers, Invoices, and Invoice Items.  \n\n2. **Connect Stripe to n8n**:  \n   - Set up an HTTP Basic Auth credential in n8n using your Stripe secret API key.  \n   - No username is needed; the API key goes into the password field.\n\n3. **Customize dynamic data**:  \n   - Replace the sample email (`test@example.com`) with your real dynamic customer email input.  \n   - Replace the example Price ID (`price_fromStripeDashboard`) with your actual product Price ID from the Stripe dashboard.\n\n4. **Test your workflow**:  \n   - Manually trigger the workflow inside n8n to ensure customers and invoices are being created correctly.\n   - Check your Stripe dashboard to confirm that new customers and invoices appear as expected.\n\n5. **Deploy to production**:  \n   - Integrate this workflow with a real trigger (e.g., webhook, form submission) to automate the process live.\n\n### Troubleshooting\n\n- **Invalid API Key**:  \n  Double-check that your Stripe API key is active and has the necessary permissions. Test it by making a simple API call manually if needed.\n\n- **Invoice Creation Fails**:  \n  Make sure you are using a valid `Price ID` from Stripe. The price must be active and available for the correct product.\n\n- **Customer Not Found Error**:  \n  If the search fails due to formatting issues, ensure emails are valid and the query syntax matches Stripe's customer search format.\n\n- **Authentication Errors**:  \n  If authentication fails, ensure you have selected **HTTP Basic Auth** in the HTTP Request nodes and left the username field empty.\n\n### Stripe prerequisites\n\n- You must have at least one active Price object created in your Stripe dashboard.  \n- Your Stripe account must be live or have access to test mode if you're working in development.  \n- Ensure your account has API access enabled for Customers, Invoices, and Products.",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Get Stripe Customer",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Customer exists?",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Create customer",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Create invoice",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "Finalize invoice",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    },
    {
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "role": "manualTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Set invoice data",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Set customer id",
      "type": "n8n-nodes-base.set",
      "role": "set",
      "configDescription": "Version 3.4"
    },
    {
      "name": "Add item to invoice",
      "type": "n8n-nodes-base.httpRequest",
      "role": "httpRequest",
      "configDescription": "Version 4.2"
    }
  ]
}