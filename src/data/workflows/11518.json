{
  "id": 11518,
  "slug": "11518",
  "title": "Smart Gmail auto-labeler with Gemini AI & sender history",
  "description": "# n8n Gmail AI Auto-Labeler\n\n&gt; An intelligent **n8n workflow** that automatically classifies and labels Gmail emails using **Google Gemini AI**, keeping your inbox organized with zero manual effort.\n\nThis workflow uses AI-powered classification to analyze email content, learn from sender patterns, and automatically apply appropriate labels while archiving processed emails.\n\n---\n\n## How It Works\n\n1. **Trigger**: The workflow runs automatically every minute to check for new unread emails (or manually for bulk processing).\n2. **Check for Existing Labels**: Before processing, it verifies if the email already has an AI-assigned label to avoid duplicate processing.\n3. **AI Classification**: If unlabeled, the AI agent analyzes the email using:\n   * **Sender History Tool** - Fetches up to 10 previous emails from the same sender to identify patterns\n   * **80% Majority Rule** - If 80%+ of sender's past emails have the same label, strongly prefers that category\n   * **Label Examples Tool** - When uncertain, compares the email with existing examples from suspected categories\n4. **Smart Decision**: The AI returns a structured JSON response:\n   ```json\n   {\n     \"label\": \"Category Name\"\n   }\n   ```\n   Or `\"None\"` if no category fits.\n5. **Apply & Archive**:\n   * **Label Applied** → The workflow adds the appropriate Gmail label to the thread.\n   * **Auto-Archive** → Removes the email from INBOX (archives it) to maintain zero-inbox.\n6. **Loop**: Processes the next email in the batch, ensuring all new emails are classified.\n\n---\n\n## Requirements\n\n* **Gmail OAuth2 Credentials** - Connected Gmail account with API access.\n* **Google Gemini API Key** - [Get it here](https://ai.google.dev/)\n  * Free tier: 15 requests/minute\n* **Gmail Labels** - Must be created in Gmail exactly as listed:\n  * Meetings\n  * Income\n  * Inquiries\n  * Notify / Verify\n  * Expenses\n  * Orders / Deliveries\n  * Trash Likely\n\n---\n\n## How to Use\n\n1. **Import the Workflow**:\n   * Copy the provided JSON file.\n   * In your n8n instance → click **Import Workflow** → select the JSON file.\n\n2. **Create Gmail Labels**:\n   * Open Gmail → Settings → Labels → Create new labels.\n   * Use the exact names listed above (case-sensitive).\n\n3. **Get Your Label IDs**:\n   * In the workflow, click **\"When clicking 'Execute workflow'\"** manual trigger.\n   * Execute the **\"Get Labels Info\"** node only.\n   * Copy each label's ID (format: `Label_1234567890123456789`).\n\n4. **Update Code Nodes with Your Label IDs**:\n   \n   **Node 1: \"Check Label Existence\"**\n   ```javascript\n   const labelMap = {\n     \"Label_YOUR_ID_HERE\": \"Meetings\",\n     \"Label_YOUR_ID_HERE\": \"Inquiries\",\n     \"Label_YOUR_ID_HERE\": \"Notify / Verify\",\n     \"Label_YOUR_ID_HERE\": \"Expenses\",\n     \"Label_YOUR_ID_HERE\": \"Orders / Deliveries\",\n     \"Label_YOUR_ID_HERE\": \"Trash Likely\"\n   };\n   ```\n\n   **Node 2: \"Convert Label to Label ID\"**\n   ```javascript\n   const labelToId = {\n     \"Meetings\": \"Label_YOUR_ID_HERE\",\n     \"Inquiries\": \"Label_YOUR_ID_HERE\",\n     \"Notify / Verify\": \"Label_YOUR_ID_HERE\",\n     \"Expenses\": \"Label_YOUR_ID_HERE\",\n     \"Orders / Deliveries\": \"Label_YOUR_ID_HERE\",\n     \"Trash Likely\": \"Label_YOUR_ID_HERE\"\n   };\n   ```\n\n5. **Set Up Credentials**:\n   * **Gmail OAuth2** → Authorize your Gmail account in n8n.\n   * **Google Gemini API** → Add your API key in n8n credentials.\n\n6. **Test the Workflow**:\n   * Send yourself test emails with clear content (e.g., invoice, meeting invite).\n   * Use the manual trigger to process them.\n   * Verify labels are applied correctly.\n\n7. **Activate for Auto Mode**:\n   * Toggle the workflow to **Active**.\n   * New unread emails will be processed automatically every minute.\n\n---\n\n## Notes\n\n* **Dual Execution Modes**:\n  * **Auto Mode** - Gmail Trigger polls inbox every minute for unread emails (real-time processing).\n  * **Manual Mode** - Use the manual trigger to bulk process existing emails (adjust limit in \"Get many messages\" node).\n\n* **AI Learning from Patterns**:\n  * The workflow applies an **80% majority rule** - if 80% or more of a sender's historical emails share the same label, the AI strongly prefers that category for new emails from that sender.\n  * This creates intelligent sender-based routing over time.\n\n* **Skip Already Labeled Emails**:\n  * The \"Check Label Existence\" node prevents re-processing emails that already have an AI-assigned label.\n  * Ensures efficient execution and avoids duplicate work.\n\n* **Structured AI Output**:\n  * Uses a **Structured Output Parser** to ensure the AI always returns valid JSON: `{ \"label\": \"Category\" }`.\n  * If uncertain, returns `{ \"label\": \"None\" }` and the email stays in inbox.\n\n* **Background Archiving**:\n  * After labeling, emails are automatically removed from INBOX (archived).\n  * Maintains a zero-inbox workflow while preserving emails under their labels.\n\n* **Rate Limits**:\n  * Google Gemini free tier: 15 requests/minute.\n  * Adjust polling frequency if hitting limits.\n\n---\n\n## Example Behavior\n\n* **Minute 1**: New invoice email arrives → AI fetches sender history → 85% were labeled \"Expenses\" → applies \"Expenses\" label → archives email.\n* **Minute 2**: Meeting invite arrives → No sender history → AI analyzes content (Zoom link, time) → applies \"Meetings\" label → archives email.\n* **Minute 3**: Promotional email arrives → AI compares with \"Trash Likely\" examples → applies label → archives email.\n* **Minute 4**: Already-labeled email detected → skipped silently.\n\n---\n\n## Label Categories\n\n| Label | Description |\n|-------|-------------|\n| **Meetings** | Calendar invites, Zoom/Meet links, appointments, scheduled events |\n| **Expenses** | Bills, invoices, receipts, payment reminders, subscription renewals |\n| **Income** | Payments received, payouts, deposits, earnings notifications |\n| **Notify / Verify** | Verification codes, login alerts, 2FA codes, account notifications |\n| **Orders / Deliveries** | Order confirmations, shipping updates, tracking numbers, deliveries |\n| **Inquiries** | Business outreach, sales proposals, partnerships, cold emails |\n| **Trash Likely** | Spam, newsletters, promotions, marketing blasts, ads |\n\n&gt; If no category fits clearly, the email returns `\"None\"` and remains in the inbox.\n\n---\n\n## Customization\n\n* **Change Polling Frequency**: Edit the \"Gmail Trigger\" node → `pollTimes` → `mode` (e.g., `every5Minutes`).\n* **Adjust Email Limit**: Modify `limit: 10` in \"Get many messages\" node for manual bulk processing.\n* **Add Custom Labels**: Create in Gmail → Get ID → Update both Code nodes + AI system prompt.\n* **Modify 80% Rule**: Edit the AI agent's system message to adjust the majority threshold.\n* **Increase Tool Limits**: Change `limit: 10` in Gmail tool nodes to fetch more historical data.\n\n---\n\n**Author:** Muhammad Anas Farooq\n",
  "featuredImage": "/data/workflows/11518/11518.webp",
  "author": {
    "id": 101,
    "slug": "anasn-farooq",
    "name": "Muhammad Anas Farooq",
    "avatar": ""
  },
  "categories": [
    "Ticket Management",
    "AI Summarization"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 100,
  "downloads": 10,
  "createdAt": "2025-12-05T06:14:38.421Z",
  "updatedAt": "2026-01-16T09:09:02.126Z",
  "publishedAt": "2025-12-05T06:14:38.421Z",
  "nodes": 25,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/11518",
  "disclaimer": "This workflow is provided as-is. Please review and test before using in production.",
  "overview": {
    "title": "Smart Gmail auto-labeler with Gemini AI & sender history",
    "workflowName": "Smart Gmail auto-labeler with Gemini AI & sender history",
    "description": "# n8n Gmail AI Auto-Labeler\n\n&gt; An intelligent **n8n workflow** that automatically classifies and labels Gmail emails using **Google Gemini AI**, keeping your inbox organized with zero manual effort.\n\nThis workflow uses AI-powered classification to analyze email content, learn from sender patterns, and automatically apply appropriate labels while archiving processed emails.\n\n---\n\n## How It Works\n\n1. **Trigger**: The workflow runs automatically every minute to check for new unread emails (or manually for bulk processing).\n2. **Check for Existing Labels**: Before processing, it verifies if the email already has an AI-assigned label to avoid duplicate processing.\n3. **AI Classification**: If unlabeled, the AI agent analyzes the email using:\n   * **Sender History Tool** - Fetches up to 10 previous emails from the same sender to identify patterns\n   * **80% Majority Rule** - If 80%+ of sender's past emails have the same label, strongly prefers that category\n   * **Label Examples Tool** - When uncertain, compares the email with existing examples from suspected categories\n4. **Smart Decision**: The AI returns a structured JSON response:\n   ```json\n   {\n     \"label\": \"Category Name\"\n   }\n   ```\n   Or `\"None\"` if no category fits.\n5. **Apply & Archive**:\n   * **Label Applied** → The workflow adds the appropriate Gmail label to the thread.\n   * **Auto-Archive** → Removes the email from INBOX (archives it) to maintain zero-inbox.\n6. **Loop**: Processes the next email in the batch, ensuring all new emails are classified.\n\n---\n\n## Requirements\n\n* **Gmail OAuth2 Credentials** - Connected Gmail account with API access.\n* **Google Gemini API Key** - [Get it here](https://ai.google.dev/)\n  * Free tier: 15 requests/minute\n* **Gmail Labels** - Must be created in Gmail exactly as listed:\n  * Meetings\n  * Income\n  * Inquiries\n  * Notify / Verify\n  * Expenses\n  * Orders / Deliveries\n  * Trash Likely\n\n---\n\n## How to Use\n\n1. **Import the Workflow**:\n   * Copy the provided JSON file.\n   * In your n8n instance → click **Import Workflow** → select the JSON file.\n\n2. **Create Gmail Labels**:\n   * Open Gmail → Settings → Labels → Create new labels.\n   * Use the exact names listed above (case-sensitive).\n\n3. **Get Your Label IDs**:\n   * In the workflow, click **\"When clicking 'Execute workflow'\"** manual trigger.\n   * Execute the **\"Get Labels Info\"** node only.\n   * Copy each label's ID (format: `Label_1234567890123456789`).\n\n4. **Update Code Nodes with Your Label IDs**:\n   \n   **Node 1: \"Check Label Existence\"**\n   ```javascript\n   const labelMap = {\n     \"Label_YOUR_ID_HERE\": \"Meetings\",\n     \"Label_YOUR_ID_HERE\": \"Inquiries\",\n     \"Label_YOUR_ID_HERE\": \"Notify / Verify\",\n     \"Label_YOUR_ID_HERE\": \"Expenses\",\n     \"Label_YOUR_ID_HERE\": \"Orders / Deliveries\",\n     \"Label_YOUR_ID_HERE\": \"Trash Likely\"\n   };\n   ```\n\n   **Node 2: \"Convert Label to Label ID\"**\n   ```javascript\n   const labelToId = {\n     \"Meetings\": \"Label_YOUR_ID_HERE\",\n     \"Inquiries\": \"Label_YOUR_ID_HERE\",\n     \"Notify / Verify\": \"Label_YOUR_ID_HERE\",\n     \"Expenses\": \"Label_YOUR_ID_HERE\",\n     \"Orders / Deliveries\": \"Label_YOUR_ID_HERE\",\n     \"Trash Likely\": \"Label_YOUR_ID_HERE\"\n   };\n   ```\n\n5. **Set Up Credentials**:\n   * **Gmail OAuth2** → Authorize your Gmail account in n8n.\n   * **Google Gemini API** → Add your API key in n8n credentials.\n\n6. **Test the Workflow**:\n   * Send yourself test emails with clear content (e.g., invoice, meeting invite).\n   * Use the manual trigger to process them.\n   * Verify labels are applied correctly.\n\n7. **Activate for Auto Mode**:\n   * Toggle the workflow to **Active**.\n   * New unread emails will be processed automatically every minute.\n\n---\n\n## Notes\n\n* **Dual Execution Modes**:\n  * **Auto Mode** - Gmail Trigger polls inbox every minute for unread emails (real-time processing).\n  * **Manual Mode** - Use the manual trigger to bulk process existing emails (adjust limit in \"Get many messages\" node).\n\n* **AI Learning from Patterns**:\n  * The workflow applies an **80% majority rule** - if 80% or more of a sender's historical emails share the same label, the AI strongly prefers that category for new emails from that sender.\n  * This creates intelligent sender-based routing over time.\n\n* **Skip Already Labeled Emails**:\n  * The \"Check Label Existence\" node prevents re-processing emails that already have an AI-assigned label.\n  * Ensures efficient execution and avoids duplicate work.\n\n* **Structured AI Output**:\n  * Uses a **Structured Output Parser** to ensure the AI always returns valid JSON: `{ \"label\": \"Category\" }`.\n  * If uncertain, returns `{ \"label\": \"None\" }` and the email stays in inbox.\n\n* **Background Archiving**:\n  * After labeling, emails are automatically removed from INBOX (archived).\n  * Maintains a zero-inbox workflow while preserving emails under their labels.\n\n* **Rate Limits**:\n  * Google Gemini free tier: 15 requests/minute.\n  * Adjust polling frequency if hitting limits.\n\n---\n\n## Example Behavior\n\n* **Minute 1**: New invoice email arrives → AI fetches sender history → 85% were labeled \"Expenses\" → applies \"Expenses\" label → archives email.\n* **Minute 2**: Meeting invite arrives → No sender history → AI analyzes content (Zoom link, time) → applies \"Meetings\" label → archives email.\n* **Minute 3**: Promotional email arrives → AI compares with \"Trash Likely\" examples → applies label → archives email.\n* **Minute 4**: Already-labeled email detected → skipped silently.\n\n---\n\n## Label Categories\n\n| Label | Description |\n|-------|-------------|\n| **Meetings** | Calendar invites, Zoom/Meet links, appointments, scheduled events |\n| **Expenses** | Bills, invoices, receipts, payment reminders, subscription renewals |\n| **Income** | Payments received, payouts, deposits, earnings notifications |\n| **Notify / Verify** | Verification codes, login alerts, 2FA codes, account notifications |\n| **Orders / Deliveries** | Order confirmations, shipping updates, tracking numbers, deliveries |\n| **Inquiries** | Business outreach, sales proposals, partnerships, cold emails |\n| **Trash Likely** | Spam, newsletters, promotions, marketing blasts, ads |\n\n&gt; If no category fits clearly, the email returns `\"None\"` and remains in the inbox.\n\n---\n\n## Customization\n\n* **Change Polling Frequency**: Edit the \"Gmail Trigger\" node → `pollTimes` → `mode` (e.g., `every5Minutes`).\n* **Adjust Email Limit**: Modify `limit: 10` in \"Get many messages\" node for manual bulk processing.\n* **Add Custom Labels**: Create in Gmail → Get ID → Update both Code nodes + AI system prompt.\n* **Modify 80% Rule**: Edit the AI agent's system message to adjust the majority threshold.\n* **Increase Tool Limits**: Change `limit: 10` in Gmail tool nodes to fetch more historical data.\n\n---\n\n**Author:** Muhammad Anas Farooq",
    "features": [],
    "useCases": []
  },
  "logicalBlocks": [],
  "nodeDetails": [
    {
      "name": "Gmail Trigger",
      "type": "n8n-nodes-base.gmailTrigger",
      "role": "gmailTrigger",
      "configDescription": "Version 1.2"
    },
    {
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "role": "splitInBatches",
      "configDescription": "Version 3"
    },
    {
      "name": "Google Gemini Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "role": "lmChatGoogleGemini",
      "configDescription": "Version 1"
    },
    {
      "name": "Get Emails By Sender Email",
      "type": "n8n-nodes-base.gmailTool",
      "role": "gmailTool",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Get Emails By Label",
      "type": "n8n-nodes-base.gmailTool",
      "role": "gmailTool",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Email Classifier Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "role": "agent",
      "configDescription": "Version 3"
    },
    {
      "name": "Structured Output Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "role": "outputParserStructured",
      "configDescription": "Version 1.3"
    },
    {
      "name": "Add label to thread",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Check Label Existence",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "If Not Assigned",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "If not None",
      "type": "n8n-nodes-base.if",
      "role": "if",
      "configDescription": "Version 2.2"
    },
    {
      "name": "Get many messages",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "When clicking ‘Execute workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "role": "manualTrigger",
      "configDescription": "Version 1"
    },
    {
      "name": "Get Labels Info",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Convert Label to Label ID",
      "type": "n8n-nodes-base.code",
      "role": "code",
      "configDescription": "Version 2"
    },
    {
      "name": "Remove Inbox label from thread",
      "type": "n8n-nodes-base.gmail",
      "role": "gmail",
      "configDescription": "Version 2.1"
    },
    {
      "name": "Workflow Overview",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Setup Instructions",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Gmail Trigger Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Label Check Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "AI Agent Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Sender Tool Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Label Tool Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Label Application Note",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    },
    {
      "name": "Get Label IDs",
      "type": "n8n-nodes-base.stickyNote",
      "role": "stickyNote",
      "configDescription": "Version 1"
    }
  ]
}