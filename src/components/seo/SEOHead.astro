---
/**
 * SEO Head 组件
 * 提供完整的 SEO Meta 标签，包括 Open Graph、Twitter Card 和结构化数据
 */

import type { SEOMeta } from '../../lib/types/workflow';

interface Props extends SEOMeta {
  siteName?: string;
}

const {
  title,
  description,
  canonical,
  image,
  type = 'website',
  publishedTime,
  modifiedTime,
  author,
  tags = [],
  noindex = false,
  siteName = 'N8N Workflows',
} = Astro.props;

// 获取站点 URL
const siteUrl = import.meta.env.PUBLIC_SITE_URL || 'https://n8nworkflows.xyz';

// 构建完整的 canonical URL
const fullCanonical = canonical
  ? canonical.startsWith('http')
    ? canonical
    : `${siteUrl}${canonical}`
  : `${siteUrl}${Astro.url.pathname}`;

// 构建完整的图片 URL
const fullImage = image
  ? image.startsWith('http')
    ? image
    : `${siteUrl}${image}`
  : `${siteUrl}/og-image.png`;

// 构建完整的标题
const fullTitle = title.includes(siteName) ? title : `${title} | ${siteName}`;

// 构建结构化数据
const structuredData = {
  '@context': 'https://schema.org',
  '@type': type === 'article' ? 'Article' : 'WebPage',
  headline: title,
  description: description,
  image: fullImage,
  url: fullCanonical,
  ...(publishedTime && { datePublished: publishedTime }),
  ...(modifiedTime && { dateModified: modifiedTime }),
  ...(author && {
    author: {
      '@type': 'Person',
      name: author,
    },
  }),
  ...(tags.length > 0 && { keywords: tags.join(', ') }),
  publisher: {
    '@type': 'Organization',
    name: siteName,
    logo: {
      '@type': 'ImageObject',
      url: `${siteUrl}/logo.png`,
    },
  },
};
---

<!-- 基础 Meta 标签 -->
<title>{fullTitle}</title>
<meta name="description" content={description} />
<link rel="canonical" href={fullCanonical} />

<!-- Robots Meta -->
{noindex && <meta name="robots" content="noindex, nofollow" />}

<!-- Open Graph Meta 标签 -->
<meta property="og:type" content={type} />
<meta property="og:site_name" content={siteName} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:url" content={fullCanonical} />
<meta property="og:image" content={fullImage} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:locale" content="en_US" />

{publishedTime && <meta property="article:published_time" content={publishedTime} />}
{modifiedTime && <meta property="article:modified_time" content={modifiedTime} />}
{author && <meta property="article:author" content={author} />}
{tags.map((tag) => <meta property="article:tag" content={tag} />)}

<!-- Twitter Card Meta 标签 -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={fullImage} />
<meta name="twitter:site" content="@n8n_io" />
<meta name="twitter:creator" content="@n8n_io" />

<!-- 额外的 Meta 标签 -->
<meta name="keywords" content={tags.join(', ')} />
{author && <meta name="author" content={author} />}

<!-- 结构化数据 (JSON-LD) -->
<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />

<!-- 主题颜色 -->
<meta name="theme-color" content="#ff5e4d" media="(prefers-color-scheme: light)" />
<meta name="theme-color" content="#111827" media="(prefers-color-scheme: dark)" />

<!-- 移动端优化 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="format-detection" content="telephone=no" />
