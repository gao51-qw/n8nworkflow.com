---
/**
 * 工作流详情展示组件
 * 用于展示单个工作流的完整信息
 */

import type { Workflow } from '../../lib/types/workflow';

interface Props {
  workflow: Workflow;
}

const { workflow } = Astro.props;
---

<article class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
  <!-- Workflow Image -->
  <div class="aspect-video bg-gray-100 dark:bg-gray-700 overflow-hidden relative">
    <img
      src={workflow.thumbnail || '/placeholder-workflow.webp'}
      alt={`Preview of ${workflow.title}`}
      class="object-cover w-full h-full"
      loading="eager"
      onerror="this.onerror=null; this.src='/placeholder-workflow.webp';"
    />
    <div class="absolute top-4 right-4 flex gap-2">
      <span
        class="text-xs px-3 py-1.5 rounded-full whitespace-nowrap shadow-sm font-medium"
        style={`background-color: ${workflow.price ? 'rgba(255, 212, 71, 0.9)' : 'rgba(255, 94, 77, 0.9)'}; color: ${workflow.price ? 'black' : 'white'};`}
      >
        {workflow.price ? `$${workflow.price}` : 'Free'}
      </span>
      <span class="text-xs px-3 py-1.5 rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 whitespace-nowrap shadow-sm font-medium capitalize">
        {workflow.complexityLevel}
      </span>
    </div>
  </div>

  <!-- Content -->
  <div class="p-6 md:p-8">
    <!-- Title -->
    <h1 class="text-3xl md:text-4xl font-black text-gray-900 dark:text-white mb-4">
      {workflow.title}
    </h1>

    <!-- Description -->
    <p class="text-lg text-gray-600 dark:text-gray-300 mb-6 leading-relaxed">
      {workflow.description}
    </p>

    <!-- Categories -->
    {workflow.categories && workflow.categories.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-6">
        {workflow.categories.map((category) => (
          <a
            href={`/categories/${category.toLowerCase().replace(/\s+/g, '-')}`}
            class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200 hover:bg-primary-200 dark:hover:bg-primary-800 transition-colors"
          >
            {category}
          </a>
        ))}
      </div>
    )}

    <!-- Stats Grid -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 py-6 border-y border-gray-200 dark:border-gray-700">
      <div class="text-center">
        <div class="text-2xl font-black text-primary-600 mb-1">{workflow.visitors || 0}</div>
        <div class="text-sm text-gray-600 dark:text-gray-400">Views</div>
      </div>
      <div class="text-center">
        <div class="text-2xl font-black text-primary-600 mb-1">{workflow.downloads || 0}</div>
        <div class="text-sm text-gray-600 dark:text-gray-400">Downloads</div>
      </div>
      {workflow.nodes && (
        <div class="text-center">
          <div class="text-2xl font-black text-primary-600 mb-1">{workflow.nodes}</div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Nodes</div>
        </div>
      )}
      <div class="text-center">
        <div class="text-2xl font-black text-primary-600 mb-1">{workflow.date}</div>
        <div class="text-sm text-gray-600 dark:text-gray-400">Published</div>
      </div>
    </div>

    <!-- Actions -->
    <div class="flex flex-col sm:flex-row gap-3 mt-6">
      {workflow.sourceUrl && (
        <a
          href={workflow.sourceUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors"
        >
          <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
          </svg>
          Download Workflow
        </a>
      )}
      <button
        type="button"
        onclick="navigator.share ? navigator.share({title: this.dataset.title, url: window.location.href}) : navigator.clipboard.writeText(window.location.href)"
        data-title={workflow.title}
        class="inline-flex items-center justify-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors"
      >
        <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
        </svg>
        Share
      </button>
    </div>
  </div>
</article>
