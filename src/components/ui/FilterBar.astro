---
/**
 * 筛选栏组件
 * 用于工作流列表的筛选功能
 */

interface Props {
  currentCategory?: string;
  currentComplexity?: string;
  currentPrice?: string;
  categories?: Array<{ slug: string; name: string }>;
}

const { currentCategory, currentComplexity, currentPrice, categories = [] } = Astro.props;

const complexityLevels = [
  { value: 'all', label: 'All Levels' },
  { value: 'beginner', label: 'Beginner' },
  { value: 'intermediate', label: 'Intermediate' },
  { value: 'advanced', label: 'Advanced' },
];

const priceOptions = [
  { value: 'all', label: 'All Workflows' },
  { value: 'free', label: 'Free Only' },
  { value: 'paid', label: 'Paid Only' },
];
---

<div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-6">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="flex items-center gap-2">
      <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
      </svg>
      <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Filters</span>
    </div>

    <div class="flex flex-col sm:flex-row gap-3 flex-1 md:justify-end">
      <!-- Category Filter -->
      {categories.length > 0 && (
        <div class="flex-1 sm:flex-initial sm:min-w-[180px]">
          <select
            id="category-filter"
            class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors"
            data-filter="category"
          >
            <option value="all">All Categories</option>
            {categories.map((cat) => (
              <option
                value={cat.slug}
                selected={currentCategory === cat.slug}
              >
                {cat.name}
              </option>
            ))}
          </select>
        </div>
      )}

      <!-- Complexity Filter -->
      <div class="flex-1 sm:flex-initial sm:min-w-[160px]">
        <select
          id="complexity-filter"
          class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors"
          data-filter="complexity"
        >
          {complexityLevels.map((level) => (
            <option
              value={level.value}
              selected={currentComplexity === level.value}
            >
              {level.label}
            </option>
          ))}
        </select>
      </div>

      <!-- Price Filter -->
      <div class="flex-1 sm:flex-initial sm:min-w-[160px]">
        <select
          id="price-filter"
          class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-colors"
          data-filter="price"
        >
          {priceOptions.map((option) => (
            <option
              value={option.value}
              selected={currentPrice === option.value}
            >
              {option.label}
            </option>
          ))}
        </select>
      </div>
    </div>
  </div>
</div>

<script>
  // Handle filter changes while preserving other query parameters
  const filters = document.querySelectorAll('select[data-filter]');
  
  filters.forEach(filter => {
    filter.addEventListener('change', (e) => {
      const target = e.target as HTMLSelectElement;
      const filterName = target.getAttribute('data-filter');
      const filterValue = target.value;
      
      const url = new URL(window.location.href);
      if (filterValue === 'all') {
        url.searchParams.delete(filterName!);
      } else {
        url.searchParams.set(filterName!, filterValue);
      }
      
      // Reset to page 1 when filters change
      url.searchParams.delete('page');
      
      window.location.href = url.toString();
    });
  });
</script>
