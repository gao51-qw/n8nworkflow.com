---
import { initFilterSidebar } from '../../scripts/filter-sidebar';

/**
 * FilterSidebar ç»„ä»¶
 * è·¯å¾„: src/components/ui/FilterSidebar.astro
 *
 * ç”¨é€”: å±•ç¤ºå·¥ä½œæµç­›é€‰é¢æ¿ï¼ˆæ—¶é—´æ®µã€ä»·æ ¼ã€å¤æ‚åº¦ã€åˆ†ç±»ã€æ’åºï¼‰
 * ä¼˜å…ˆçº§: P0
 *
 * Props æ¥å£:
 * - currentFilters?: å½“å‰æ´»è·ƒçš„ç­›é€‰æ¡ä»¶
 * - filterCounts?: å„ç­›é€‰é€‰é¡¹çš„è®¡æ•°
 *
 * ç‰¹æ€§:
 * - å“åº”å¼è®¾è®¡ï¼šDesktopå›ºå®šä¾§è¾¹æ ï¼ŒMobileåº•éƒ¨Sheet
 * - å®æ—¶è®¡æ•°æ˜¾ç¤º
 * - å¯æŠ˜å åŒºé—´
 * - å¤šé€‰åˆ†ç±»æ”¯æŒ
 * - æ’åºä¸‹æ‹‰èœå•
 *
 * äº¤äº’:
 * - é€‰æ‹©ç­›é€‰æ¡ä»¶æ—¶æ›´æ–°URLå‚æ•°
 * - åŒæ­¥è°ƒç”¨filter-counts APIè·å–å®æ—¶è®¡æ•°
 * - ç¦ç”¨è®¡æ•°ä¸º0çš„é€‰é¡¹
 */

interface Props {
  currentFilters?: {
    timePeriod?: string | null;
    category?: string[];
    complexity?: string | null;
    price?: 'all' | 'free' | 'paid';
    sortBy?: string;
  };
  filterCounts?: {
    timePeriods: Record<string, number>;
    categories: Record<string, number>;
    complexities: Record<string, number>;
    price: Record<string, number>;
  };
}

const {
  currentFilters = {},
  filterCounts = {
    timePeriods: { all: 7947, '7days': 8, month: 374, '6months': 4508, year: 6758 },
    categories: { 'multimodal-ai': 2270, ai: 1600, 'ai-summarization': 1088 },
    complexities: { all: 7947, beginner: 500, intermediate: 2835, advanced: 4602 },
    price: { all: 7947, free: 6898, paid: 1049 },
  },
} = Astro.props;
---

<!--
  ç­›é€‰é¢æ¿å®¹å™¨
  åœ¨ Desktop (lg) æ˜¾ç¤ºä¸ºå›ºå®šå·¦ä¾§ä¾§è¾¹æ  (250px)
  åœ¨ Tablet (md) ä»¥ä¸Šæ˜¾ç¤ºä¸ºéšè—,é€šè¿‡æ±‰å ¡èœå•è§¦å‘
  åœ¨ Mobile (<md) æ˜¾ç¤ºä¸ºåº•éƒ¨ Sheet
-->
<aside
  class="filter-sidebar hidden lg:block"
>
  <!-- ç­›é€‰é¢æ¿æ ‡é¢˜ -->
  <h2 class="text-lg font-bold text-gray-900 dark:text-white mb-6">ç­›é€‰</h2>

    <!-- æ—¶é—´æ®µç­›é€‰ -->
    <div class="filter-group">
      <h3 class="filter-group-title">
        <span>ğŸ“…</span>
        <span>æ—¶é—´æ®µ</span>
      </h3>
      <div class="filter-options">
        {
          Object.entries(filterCounts.timePeriods).map(([period, count]) => (
            <label class="filter-option">
              <input
                type="checkbox"
                value={period}
                checked={currentFilters.timePeriod === period}
                class="filter-checkbox"
                data-filter="timePeriod"
              />
              <span class="filter-label">
                {period === 'all' ? 'å…¨éƒ¨' : period === '7days' ? 'æœ€è¿‘7å¤©' : period === 'month' ? 'æœ€è¿‘ä¸€æœˆ' : 'æœ€è¿‘6æœˆ'}
              </span>
              <span class="filter-count">({count})</span>
            </label>
          ))
        }
      </div>
    </div>

    <!-- ä»·æ ¼ç­›é€‰ -->
    <div class="filter-group">
      <h3 class="filter-group-title">
        <span>ğŸ’°</span>
        <span>ä»·æ ¼</span>
      </h3>
      <div class="filter-options">
        {
          Object.entries(filterCounts.price).map(([priceType, count]) => (
            <label class="filter-option">
              <input
                type="checkbox"
                value={priceType}
                checked={currentFilters.price === priceType}
                class="filter-checkbox"
                data-filter="price"
              />
              <span class="filter-label">
                {priceType === 'all' ? 'å…¨éƒ¨' : priceType === 'free' ? 'å…è´¹' : 'ä»˜è´¹'}
              </span>
              <span class="filter-count">({count})</span>
            </label>
          ))
        }
      </div>
    </div>

    <!-- å¤æ‚åº¦ç­›é€‰ -->
    <div class="filter-group">
      <h3 class="filter-group-title">
        <span>ğŸ¯</span>
        <span>éš¾åº¦</span>
      </h3>
      <div class="filter-options">
        {
          Object.entries(filterCounts.complexities).map(([complexity, count]) => (
            <label class="filter-option">
              <input
                type="checkbox"
                value={complexity}
                checked={currentFilters.complexity === complexity}
                class="filter-checkbox"
                data-filter="complexity"
              />
              <span class="filter-label">
                {complexity === 'all' ? 'å…¨éƒ¨' : complexity === 'beginner' ? 'åˆçº§' : complexity === 'intermediate' ? 'ä¸­çº§' : 'é«˜çº§'}
              </span>
              <span class="filter-count">({count})</span>
            </label>
          ))
        }
      </div>
    </div>

    <!-- æ’åºä¸‹æ‹‰èœå• -->
    <div class="filter-group">
      <h3 class="filter-group-title">
        <span>ğŸ“Š</span>
        <span>æ’åº</span>
      </h3>
      <select
        class="filter-select"
        data-filter="sortBy"
      >
        <option value="date">æœ€æ–°å‘å¸ƒ</option>
        <option value="downloads">ä¸‹è½½æ¬¡æ•°</option>
        <option value="views">æµè§ˆæ¬¡æ•°</option>
        <option value="likes">ç‚¹èµæ¬¡æ•°</option>
      </select>
    </div>

    <!-- åˆ†ç±»åˆ—è¡¨ï¼ˆå¸¦æ»šåŠ¨ï¼‰ -->
    <div class="filter-group">
      <h3 class="filter-group-title">
        <span>ğŸ“</span>
        <span>åˆ†ç±»</span>
      </h3>
      <div class="filter-options max-h-48 overflow-y-auto pr-2">
        {
          Object.entries(filterCounts.categories).map(([category, count]) => (
            <label class="filter-option">
              <input
                type="checkbox"
                value={category}
                checked={currentFilters.category?.includes(category) || false}
                class="filter-checkbox"
                data-filter="category"
              />
              <span class="filter-label truncate">
                {category}
              </span>
              <span class="filter-count">({count})</span>
            </label>
          ))
        }
      </div>
    </div>

    <!-- é‡ç½®ç­›é€‰æŒ‰é’® -->
    <button
      class="reset-filters-btn mt-6"
      data-action="reset-filters"
    >
      é‡ç½®ç­›é€‰
    </button>
  </div>
</aside>

<!-- Mobile ç‰ˆæœ¬: åº•éƒ¨ Sheet è§¦å‘æŒ‰é’® -->
<button
  class="mobile-filter-toggle"
  data-action="toggle-mobile-filters"
  aria-label="æ‰“å¼€ç­›é€‰é¢æ¿"
>
  <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
    />
  </svg>
</button>

<script>
  import { initFilterSidebar } from '../../scripts/filter-sidebar';
  
  // åˆå§‹åŒ–ç­›é€‰ä¾§è¾¹æ äº¤äº’
  initFilterSidebar();
</script>
