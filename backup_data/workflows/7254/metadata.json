{
  "id": 7254,
  "slug": "7254",
  "title": "On-demand email newsletter summaries from Gmail to Telegram with GPT-4.1-mini",
  "description": "## Summary\nSend a number to your Telegram bot (e.g., 2) and get a neatly formatted digest of all Gmail newsletters received since that date. Each email is summarized by an LLM into concise topics, merged into a single Telegram message, automatically split into chunks to fit Telegram limits, and safely formatted as HTML.\n\n## What this workflow does\n-  Triggers on your Telegram message containing a number of days, e.g., 1, 2, 7\n-  Fetches all Gmail messages since that date using a custom search query, optionally filtered by senders\n-  Retrieves and decodes each email’s HTML, subject, sender name, date\n-  Prompts an LLM (GPT‑4.1‑mini) to produce a consistent JSON summary of topics per email\n-  Merges topics from all emails into a single digest\n-  Builds a readable, enumerated message (with bold titles)\n-  Splits it into 3 500‑char parts and sanitizes Markdown to Telegram‑safe HTML\n-  Sends the digest to your Telegram chat with preview disabled\n\n## Apps and credentials\n-  Gmail OAuth2: Gmail account\n-  Telegram: Telegram account (bot)\n-  OpenAI: OpenAi account\n\n## Typical use cases\n-  Personal or team daily/weekly newsletter digests in Telegram\n-  Curated feeds from selected senders compiled on demand\n-  Lightweight knowledge briefings without leaving Telegram\n\n## How it works (node-by-node)\n-  Telegram Trigger\n\t- Waits for your message (e.g., \"2\"). Chat ID is restricted to your Telegram ID for safety.\n-  Get days (Code)\n\t- Takes the numeric daysAgo from the Telegram message text\n\t- Computes YYYY/MM/DD for Gmail’s after: filter\n-  Get many messages (Gmail → getAll, returnAll: true)\n\t- Uses a custom q filter like:\n    =(from:____@____.com) OR (from:____@____.com) OR (from:____@____.com -\"____\") after:{{ $json.dateString }}\n\t- Returns a list of message IDs\n-  Loop Over Items (Split in Batches)\n\t- Iterates through each message ID\n-  Get a message (Gmail → get)\n\t- Retrieves the full message/payload for the current email\n-  Get message data (Code)\n\t- Extracts HTML from Gmail’s payload (body/parts)\n\t- Normalizes sender to just the name\n  \t- Formats the date as DD.MM.YYYY\n  \t- Passes html, subject, from, date forward\n-  Clean (Code)\n  \t- Converts DD.MM.YYYY → MM.DD (for prompt brevity)\n  \t- Passes html, subject, from, date to the LLM\n-  Message a model (OpenAI, model: gpt‑4.1‑mini, JSON output)\n  \t- Prompt instructs:\n    \t\t- Produce JSON: { \"topics\": [ { \"title\", \"descr\", \"subject\", \"from\", \"date\" } ] }\n    \t- Split multi-news blocks into separate topics\n    \t- Combine or ignore specific blocks for particular senders (placeholders ____)\n    \t- Keep subject untranslated; other values in ____ language\n    \t- Injects subject/from/date/html from the current email\n-  Loop Over Items (continues)\n  \t- After all iterations complete, the aggregated per-email results are available\n-  Merge (Code)\n  \t- Flattens the topics arrays from all processed emails into one combined topics list\n-  Create TG message (Code)\n  \t- Renders an enumerated list:\n    \t- 1. Title (bold)\n    \t- Short description\n    \t- Original subject\n    \t- From — Date\n-  Split (Code)\n  \t- Splits into 3 500‑character chunks to stay below Telegram’s 4 096 limit with HTML overhead\n-  Sanitize (Code)\n  \t- Escapes &, &lt;, &gt;\n  \t- Fixes unbalanced * and _\n  \t- Converts basic Markdown markers to Telegram HTML\n-  Send a message (Telegram)\n  \t- Sends each part with parse_mode=HTML, previews disabled\n\nNode map\n| Node | Type | Purpose |\n|---|---|---|\n| Telegram Trigger | Trigger | Receive daysAgo command from Telegram |\n| Get days | Code | Compute Gmail after:YYYY/MM/DD from daysAgo |\n| Get many messages | Gmail (getAll) | Search emails since date with custom from: filters |\n| Loop Over Items | Split in Batches | Iterate messages one-by-one |\n| Get a message | Gmail (get) | Fetch full message payload |\n| Get message data | Code | Extract HTML/subject/from/date; normalize sender and date |\n| Clean | Code | Reformat date and forward fields to LLM |\n| Message a model | OpenAI | Summarize email into JSON topics |\n| Merge | Code | Merge topics from all emails |\n| Create TG message | Code | Build human-friendly digest text |\n| Split | Code | Chunk into 3 500‑char parts |\n| Sanitize | Code | Escape HTML and map Markdown to Telegram HTML |\n| Send a message | Telegram | Deliver digest to Telegram chat |\n\n## Before you start\n-  Create a Telegram bot and get its token (via @BotFather)\n-  Get your Telegram user ID to restrict access\n-  Connect Gmail OAuth2 in n8n\n-  Add your OpenAI API key\n-  Import the provided workflow JSON into n8n\n\n## Setup instructions\n1) Telegram\n-  Telegram Trigger node:\n  \t- additionalFields.chatIds = your Telegram user ID\n-  Send a message node:\n  \t- chatId = your Telegram user ID\n  \t- parse_mode = HTML\n  \t- disable_web_page_preview = true\n\n2) Gmail\n-  Connect a Gmail OAuth2 credential (Gmail account)\n-  In Get many messages, adjust filters.q to your senders and rules:\n \t - Example: =(from:news@publisher.com) OR (from:briefs@media.com -\"promo\") after:{{ $json.dateString }}\n-  If needed, add label: or category: filters\n\n3) OpenAI\n-  Message a model:\n  \t- Model: gpt‑4.1‑mini (can swap to gpt‑4o‑mini or your preferred)\n \t - Update the prompt placeholders:\n   \t\t - ____ language → your target language\n   \t\t - ____ sender rules → your special cases (combine blocks, ignore sections)\n\n4) Safety and formatting\n-  Keep parse_mode=HTML in Telegram\n-  The Sanitize node is designed for `<b>` and `<i>` only; avoid other HTML tags\n-  The Split node uses 3 500 chars per part to stay safe under Telegram limits\n\n## How to use\n-  In Telegram, send a number indicating “days ago”\n  \t- Example: 2 → will query Gmail after the date 2 days ago\n-  The workflow compiles and returns a digest in your chat\n-  Rerun anytime with a new number\n\n## Customization ideas\n-  Labels instead of global search: q = label:Newsletters after:{{ $json.dateString }}\n-  Time window control: add before: or exact date ranges\n-  Different language: set the ____ language in the LLM prompt\n-  Model choice: swap to cheaper/faster models if volume is high\n-  Chunk size: adjust from 3 500 to your needs\n-  Formatting: tweak Create TG message to include links parsed from HTML (if you add an HTML parser step)\n\n## Limits and notes\n-  Telegram messages are limited to ~4 096 characters; we chunk to 3 500 per part\n-  Gmail “after:” uses YYYY/MM/DD and Google’s interpretation of dates; your n8n server time influences the computed date\n-  LLM usage incurs cost and latency proportional to email size and count\n-  HTML extraction is robust for typical Gmail structures but may need tweaks for exotic MIME layouts\n\n## Privacy and safety\n-  Emails are sent to OpenAI for summarization—ensure that’s acceptable for your data policies\n-  The Telegram Trigger restricts chat access; keep your chatIds locked down\n-  Avoid sending raw HTML to Telegram; rely on the Sanitize node\n\nSample output format (Telegram)\n1. Bold topic title\n\nOne-sentence description\n\nOriginal Subject Line\n→ Sender Name — DD.MM.YYYY\n\n2. Next topic title\n\n...\n\n## Tips and troubleshooting\n-  Got empty digests? Check Gmail filters.q and make sure there really are emails after the computed date\n-  Model errors or empty JSON? Lower prompt complexity or switch model\n-  HTML formatting issues in Telegram? Ensure parse_mode=HTML and keep only `<b>`, `<i>`\n-  Long messages not fully delivered? Reduce chunk size from 3 500\n\n## Tags\n-  gmail, telegram, openai, llm, newsletters, digest, summarization, automation\n\n## Changelog\n-  v1: Initial release with sender filters, topic merging, Telegram HTML sanitization, and on-demand time window via Telegram message\n\n",
  "featuredImage": "/data/workflows/7254/7254.webp",
  "author": {
    "id": 101,
    "slug": "vladzima",
    "name": "Vlad Arbatov",
    "avatar": ""
  },
  "categories": [
    "Personal Productivity",
    "Multimodal AI"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 426,
  "downloads": 42,
  "createdAt": "2025-08-11T14:23:07.352Z",
  "updatedAt": "2026-01-16T08:49:17.789Z",
  "publishedAt": "2025-08-11T14:23:07.352Z",
  "nodes": 16,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/7254"
}