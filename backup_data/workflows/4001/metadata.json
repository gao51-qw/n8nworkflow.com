{
  "id": 4001,
  "slug": "4001",
  "title": "Automated daily customer win-back campaign with AI offers",
  "description": "Proactively retain customers predicted to churn with this automated n8n workflow. Running daily, it identifies high-risk customers from your Google Sheet, uses Google Gemini to generate personalized win-back offers based on their churn score and preferences, sends these offers via Gmail, and logs all actions for tracking.\n\n### What does this workflow do?\n\nThis workflow automates the critical process of customer retention by:\n\n*   **Running automatically every day** on a schedule you define.\n*   **Fetching customer data** from a designated Google Sheet containing metrics like predicted churn scores and preferred categories.\n*   **Filtering** to identify customers with a high churn risk (score &gt; 0.7) who haven't recently received a specific campaign (based on the `created_campaign_date` field - *you might need to adjust this logic*).\n*   Using **Google Gemini AI** to dynamically generate one of three types of win-back offers, personalized based on the customer's specific churn score and preferred product categories:\n    *   **Informational:** (Score 0.7-0.8) Highlights new items in preferred categories.\n    *   **Bonus Points:** (Score 0.8-0.9) Offers points for purchases in a target category (e.g., Books).\n    *   **Discount Percentage:** (Score 0.9-1.0) Offers a percentage discount in a target category (e.g., Books).\n*   **Sending the personalized offer** directly to the customer via **Gmail**.\n*   **Logging** each sent offer or the absence of eligible customers for the day in a separate 'SYSTEM_LOG' Google Sheet for monitoring and analysis.\n\n### Who is this for?\n\n*   **CRM Managers & Retention Specialists:** Automate personalized outreach to at-risk customers.\n*   **Marketing Teams:** Implement data-driven retention campaigns with minimal manual effort.\n*   **E-commerce Businesses & Subscription Services:** Proactively reduce churn and increase customer lifetime value.\n*   **Anyone** using customer data (especially churn prediction scores) who wants to automate personalized retention efforts via email.\n\n### Benefits\n\n*   **Automated Retention:** Set it up once, and it runs daily to engage at-risk customers automatically.\n*   **AI-Powered Personalization:** Go beyond generic offers; tailor messages based on churn risk and customer preferences using Gemini.\n*   **Proactive Churn Reduction:** Intervene *before* customers leave by addressing high churn scores with relevant offers.\n*   **Scalability:** Handle personalized outreach for many customers without manual intervention.\n*   **Improved Customer Loyalty:** Show customers you value them with relevant, timely offers.\n*   **Action Logging:** Keep track of which customers received offers and when the workflow ran.\n\n### How it Works\n\n1.  **Daily Trigger:** The workflow starts automatically based on the schedule set (e.g., daily at 9 AM).\n2.  **Fetch Data:** Reads all customer data from your 'Customer Data' Google Sheet.\n3.  **Filter Customers:** Selects customers where `predicted_churn_score &gt; 0.7` AND `created_campaign_date` is empty (*verify this condition fits your needs*).\n4.  **Check for Eligibility:** Determines if any customers passed the filter.\n5.  **IF Eligible Customers Found:**\n    *   **Loop:** Processes each eligible customer one by one.\n    *   **Generate Offer (Gemini):** Sends the customer's `predicted_churn_score` and `preferred_categories` to Gemini. Gemini analyzes these and the defined rules to create the appropriate offer type, value, title, and detailed message, returning it as structured JSON.\n    *   **Log Sent Offer:** Records `action_taken = SENT_WINBACK_OFFER`, the timestamp, and `customer_id` in the 'SYSTEM_LOG' sheet.\n    *   **Send Email:** Uses the Gmail node to send an email to the customer's `user_mail` with the generated `offer_title` as the subject and `offer_details` as the body.\n6.  **IF No Eligible Customers Found:**\n    *   **Set Status:** Creates a record indicating `system_log = NOT_FOUND`.\n    *   **Log Status:** Records this 'NOT_FOUND' status and the current timestamp in the 'SYSTEM_LOG' sheet.\n\n### n8n Nodes Used\n\n*   Schedule Trigger\n*   Google Sheets (x3 - Read Customers, Log Sent Offer, Log Not Found)\n*   Filter\n*   If\n*   SplitInBatches (Used for Looping)\n*   Langchain Chain - LLM (Gemini Offer Generation)\n*   Langchain Chat Model - Google Gemini\n*   Langchain Output Parser - Structured\n*   Set (Prepare 'Not Found' Log)\n*   Gmail (Send Offer Email)\n\n### Prerequisites\n\n*   Active n8n instance (Cloud or Self-Hosted).\n*   **Google Account** with access to Google Sheets and Gmail.\n*   **Google Sheets API Credentials (OAuth2):** Configured in n8n.\n*   **Two Google Sheets:**\n    *   **'Customer Data' Sheet:** Must contain columns like `customer_id`, `predicted_churn_score` (numeric), `preferred_categories` (string, e.g., `[\"Books\", \"Electronics\"]`), `user_mail` (string), and potentially `created_campaign_date` (date/string).\n    *   **'SYSTEM_LOG' Sheet:** Should have columns like `system_log` (string), `date` (string/timestamp), and `customer_id` (string, optional for 'NOT_FOUND' logs).\n*   **Google Cloud Project** with the Vertex AI API enabled.\n*   **Google Gemini API Credentials:** Configured in n8n (usually via Google Vertex AI credentials).\n*   **Gmail API Credentials (OAuth2):** Configured in n8n with permission to send emails.\n\n### Setup\n\n1.  Import the workflow JSON into your n8n instance.\n2.  **Configure Schedule Trigger:** Set the desired daily run time (e.g., `Hours` set to `9`).\n3.  **Configure Google Sheets Nodes:**\n    *   Select your Google Sheets OAuth2 credentials for all three Google Sheets nodes.\n    *   **`1. Fetch Customer Data...`:** Enter your 'Customer Data' Spreadsheet ID and Sheet Name.\n    *   **`5b. Log Sent Offer...`:** Enter your 'SYSTEM_LOG' Spreadsheet ID and Sheet Name. Verify column mapping.\n    *   **`3b. Log 'Not Found'...`:** Enter your 'SYSTEM_LOG' Spreadsheet ID and Sheet Name. Verify column mapping.\n4.  **Configure Filter Node (`2. Filter High Churn Risk...`):**\n    *   **Crucially, review the second condition:** `{{ $json.created_campaign_date.isEmpty() }}`. Ensure this field and logic correctly identify customers who *should* receive the offer based on your campaign strategy. Modify or remove if necessary.\n5.  **Configure Google Gemini Nodes:** Select your configured Google Vertex AI / Gemini credentials in the `Google Gemini Chat Model` node. Review the prompt in the `5a. Generate Win-Back Offer...` node to ensure the offer logic matches your business rules (especially category names like \"Books\").\n6.  **Configure Gmail Node (`5c. Send Win-Back Offer...`):** Select your Gmail OAuth2 credentials.\n7.  **Activate the workflow.**\n8.  Ensure your 'Customer Data' and 'SYSTEM_LOG' Google Sheets are correctly set up and populated. The workflow will run automatically at the next scheduled time.\n\nThis workflow provides a powerful, automated way to engage customers showing signs of churn, using personalized AI-driven offers to encourage them to stay. Adapt the filtering and offer logic to perfectly match your business needs!",
  "featuredImage": "/data/workflows/4001/4001.webp",
  "author": {
    "id": 101,
    "slug": "onurpolat05",
    "name": "Onur",
    "avatar": ""
  },
  "categories": [
    "Social Media",
    "Multimodal AI"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 1081,
  "downloads": 108,
  "createdAt": "2025-05-12T18:11:21.486Z",
  "updatedAt": "2026-01-16T08:32:33.325Z",
  "publishedAt": "2025-05-12T18:11:21.486Z",
  "nodes": 17,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/4001"
}