{
  "id": 10302,
  "slug": "10302",
  "title": "Automated Kubernetes testing with Robot Framework, ArgoCD & with KinD lifecycle",
  "description": "## Overview\n\nThis n8n workflow provides **automated CI/CD testing** for Kubernetes applications using **KinD (Kubernetes in Docker)**. It creates temporary infrastructure, runs tests, and cleans up everything automatically.\n\n---\n\n## Three-Phase Lifecycle\n\n### INIT Phase - Infrastructure Setup\n- Installs dependencies (sshpass, Docker, KinD)\n- Creates KinD cluster\n- Installs Helm and Nginx Ingress\n- Installs HAProxy for port forwarding\n- Deploys ArgoCD\n- Applies ApplicationSet\n\n### TEST Phase - Automated Testing\n- Downloads Robot Framework test script from GitLab\n- Installs Robot Framework and Browser library\n- Executes automated browser tests\n- Packages test results\n- Sends results via Telegram\n\n### DESTROY Phase - Complete Cleanup\n- Removes HAProxy\n- Deletes KinD cluster\n- Uninstalls KinD\n- Uninstalls Docker\n- Sends completion notification\n\n---\n\n## Execution Modes\n\n**Full Pipeline Mode** (`progress_only = false`)\n&gt; Automatically progresses through all phases: INIT → TEST → DESTROY\n\n**Single Phase Mode** (`progress_only = true`)\n&gt; Executes only the specified phase and stops\n\n---\n\n## Prerequisites\n\n### Local Environment (n8n Host)\n- n8n instance **version 1.0 or higher**\n- Community node `n8n-nodes-robotframework` installed\n- Network access to target host and GitLab\n- Minimum **4 GB RAM**, **20 GB disk space**\n\n### Remote Target Host\n- Linux server (Ubuntu, Debian, CentOS, Fedora, or Alpine)\n- SSH access with **sudo privileges**\n- Minimum **8 GB RAM** (16 GB recommended)\n- **20 GB** free disk space\n- Open ports: `22`, `80`, `60080`, `60443`, `56443`\n\n### External Services\n- **GitLab** account with OAuth2 application\n- Repository with test files (`test.robot`, `config.yaml`, `demo-applicationSet.yaml`)\n- **Telegram Bot** for notifications\n- Telegram **Chat ID**\n\n---\n\n## Setup Instructions\n\n### Step 1: Install Community Node\n\n1. In n8n web interface, navigate to **Settings** → **Community Nodes**\n2. Install `n8n-nodes-robotframework`\n3. Restart n8n if prompted\n\n### Step 2: Configure GitLab OAuth2\n\n#### Create GitLab OAuth2 Application\n1. Log in to GitLab\n2. Navigate to **User Settings** → **Applications**\n3. Create new application with redirect URI: `https://your-n8n-instance.com/rest/oauth2-credential/callback`\n4. Grant scopes: `read_api`, `read_repository`, `read_user`\n5. Copy **Application ID** and **Secret**\n\n#### Configure in n8n\n1. Create new **GitLab OAuth2 API** credential\n2. Enter GitLab server URL, Client ID, and Secret\n3. Connect and authorize\n\n### Step 3: Prepare GitLab Repository\n\nCreate repository structure:\n\n```\nyour-repo/\n├── test.robot\n├── config.yaml\n├── demo-applicationSet.yaml\n└── .gitlab-ci.yml\n```\n\nUpload your:\n- Robot Framework test script\n- KinD cluster configuration\n- ArgoCD ApplicationSet manifest\n\n### Step 4: Configure Telegram Bot\n\n#### Create Bot\n1. Open Telegram, search for **@BotFather**\n2. Send `/newbot` command\n3. Save the **API token**\n\n#### Get Chat ID\n**For personal chat:**\n- Send message to your bot\n- Visit: `https://api.telegram.org/bot&lt;YOUR_TOKEN&gt;/getUpdates`\n- Copy the chat ID (positive number)\n\n**For group chat:**\n- Add bot to group\n- Send message mentioning the bot\n- Visit getUpdates endpoint\n- Copy group chat ID (negative number)\n\n#### Configure in n8n\n1. Create **Telegram API** credential\n2. Enter bot token\n3. Save credential\n\n### Step 5: Prepare Target Host\n\nVerify SSH access:\n- Test connection: `ssh -p &lt;port&gt; &lt;username&gt;@&lt;host_ip&gt;`\n- Verify sudo: `sudo -v`\n\nThe workflow will automatically install dependencies.\n\n### Step 6: Import and Configure Workflow\n\n#### Import Workflow\n1. Copy workflow JSON\n2. In n8n, click **Workflows** → **Import from File/URL**\n3. Import the JSON\n\n#### Configure Parameters\n\nOpen **Set Parameters** node and update:\n\n| Parameter | Description | Example |\n|-----------|-------------|---------|\n| `target_host` | IP address of remote host | `192.168.1.100` |\n| `target_port` | SSH port | `22` |\n| `target_user` | SSH username | `ubuntu` |\n| `target_password` | SSH password | `your_password` |\n| `progress` | Starting phase | `INIT`, `TEST`, or `DESTROY` |\n| `progress_only` | Execution mode | `true` or `false` |\n| `KIND_CONFIG` | Path to config.yaml | `config.yaml` |\n| `ROBOT_SCRIPT` | Path to test.robot | `test.robot` |\n| `ARGOCD_APPSET` | Path to ApplicationSet | `demo-applicationSet.yaml` |\n\n&gt; **Security:** Use n8n credentials or environment variables instead of storing passwords in the workflow.\n\n#### Configure GitLab Nodes\n\nFor each of the three GitLab nodes:\n- Set **Owner** (username or organization)\n- Set **Repository** name\n- Set **File Path** (uses parameter from Set Parameters)\n- Set **Reference** (branch: `main` or `master`)\n- Select **Credentials** (GitLab OAuth2)\n\n#### Configure Telegram Nodes\n\n1. **Send ROBOT Script Export Pack** node:\n   - Set **Chat ID**\n   - Select **Credentials**\n\n2. **Process Finish Report** node:\n   - Update chat ID in command\n\n### Step 7: Test and Execute\n\n1. Test individual components first\n2. Run full workflow\n3. Monitor execution (30-60 minutes total)\n\n---\n\n## How to Use\n\n### Execution Examples\n\n#### Complete Testing Pipeline\n- `progress = \"INIT\"`\n- `progress_only = \"false\"`\n- Flow: INIT → TEST → DESTROY\n\n#### Setup Infrastructure Only\n- `progress = \"INIT\"`\n- `progress_only = \"true\"`\n- Flow: INIT → Stop\n\n#### Test Existing Infrastructure\n- `progress = \"TEST\"`\n- `progress_only = \"false\"`\n- Flow: TEST → DESTROY\n\n#### Cleanup Only\n- `progress = \"DESTROY\"`\n- Flow: DESTROY → Complete\n\n### Trigger Methods\n\n#### 1. Manual Execution\n- Open workflow in n8n\n- Set parameters\n- Click **Execute Workflow**\n\n#### 2. Scheduled Execution\n- Open **Schedule Trigger** node\n- Configure time (default: 1 AM daily)\n- Ensure workflow is **Active**\n\n#### 3. Webhook Trigger\n- Configure webhook in GitLab repository\n- Add webhook URL to GitLab CI\n\n### Monitoring Execution\n\n**In n8n Interface:**\n- View progress in **Executions** tab\n- Watch node-by-node execution\n- Check output details\n\n**Via Telegram:**\n- Receive test results after TEST phase\n- Receive completion notification after DESTROY phase\n\n**Execution Timeline:**\n| Phase | Duration |\n|-------|----------|\n| INIT | 15-25 minutes |\n| TEST | 5-10 minutes |\n| DESTROY | 5-10 minutes |\n\n### Understanding Test Results\n\nAfter TEST phase, receive `testing-export-pack.tar.gz` via Telegram containing:\n\n- `log.html` - Detailed test execution log\n- `report.html` - Test summary report\n- `output.xml` - Machine-readable results\n- `screenshots/` - Browser screenshots\n\n**To view:**\n1. Download `.tar.gz` from Telegram\n2. Extract: `tar -xzf testing-export-pack.tar.gz`\n3. Open `report.html` for summary\n4. Open `log.html` for detailed steps\n\n**Success indicators:**\n- All tests marked **PASS**\n- Screenshots show expected UI states\n- No error messages in logs\n\n**Failure indicators:**\n- Tests marked **FAIL**\n- Error messages in logs\n- Unexpected UI states in screenshots\n\n---\n\n## Configuration Files\n\n### test.robot\n\nRobot Framework test script structure:\n- Uses **Browser** library\n- Connects to `http://autotest.innersite`\n- Logs in with `autotest/autotest`\n- Takes screenshots\n- Runs in **headless Chromium**\n\n### config.yaml\n\nKinD cluster configuration:\n- **1 control-plane node**\n- **1 worker node**\n- Port mappings: `60080` (HTTP), `60443` (HTTPS), `56443` (API)\n- Kubernetes version: `v1.30.2`\n\n### demo-applicationSet.yaml\n\nArgoCD Application manifest:\n- Points to Git repository\n- Automatic sync enabled\n- Deploys to default namespace\n\n### gitlab-ci.yml\n\nTriggers n8n workflow on commits:\n- Installs curl\n- Sends POST request to webhook\n\n---\n\n## Troubleshooting\n\n### SSH Permission Denied\n\n**Symptoms:**\n```\nError: Permission denied (publickey,password)\n```\n\n**Solutions:**\n- Verify password is correct\n- Check SSH authentication method\n- Ensure user has sudo privileges\n- Use SSH keys instead of passwords\n\n### Docker Installation Fails\n\n**Symptoms:**\n```\nError: Package docker-ce is not available\n```\n\n**Solutions:**\n- Check OS version compatibility\n- Verify network connectivity\n- Manually add Docker repository\n\n### KinD Cluster Creation Timeout\n\n**Symptoms:**\n```\nError: Failed to create cluster: timed out\n```\n\n**Solutions:**\n- Check available resources (RAM/CPU/disk)\n- Verify Docker daemon status\n- Pre-pull images\n- Increase timeout\n\n### ArgoCD Not Accessible\n\n**Symptoms:**\n```\nError: Failed to connect to autotest.innersite\n```\n\n**Solutions:**\n- Check HAProxy status: `systemctl status haproxy`\n- Verify `/etc/hosts` entry\n- Check Ingress: `kubectl get ingress -n argocd`\n- Test port forwarding: `curl http://127.0.0.1:60080`\n\n### Robot Framework Tests Fail\n\n**Symptoms:**\n```\nError: Chrome failed to start\n```\n\n**Solutions:**\n- Verify Chromium installation\n- Check Browser library: `rfbrowser show-trace`\n- Ensure correct `executablePath` in test.robot\n- Install missing dependencies\n\n### Telegram Notification Not Received\n\n**Symptoms:**\n- Workflow completes but no message\n\n**Solutions:**\n- Verify Chat ID\n- Test Telegram API manually\n- Check bot status\n- Re-add bot to group\n\n### Workflow Hangs\n\n**Symptoms:**\n- Node shows \"Executing...\" indefinitely\n\n**Solutions:**\n- Check n8n logs\n- Test SSH connection manually\n- Verify target host status\n- Add timeouts to commands\n\n---\n\n## Best Practices\n\n### Development Workflow\n\n1. **Test locally first**\n   - Run Robot Framework tests on local machine\n   - Verify test script syntax\n\n2. **Version control**\n   - Keep all files in Git\n   - Use branches for experiments\n   - Tag stable versions\n\n3. **Incremental changes**\n   - Make small testable changes\n   - Test each change separately\n\n4. **Backup data**\n   - Export workflow regularly\n   - Save test results\n   - Store credentials securely\n\n### Production Deployment\n\n1. **Separate environments**\n   - Dev: Frequent testing\n   - Staging: Pre-production validation\n   - Production: Stable scheduled runs\n\n2. **Monitoring**\n   - Set up execution alerts\n   - Monitor host resources\n   - Track success/failure rates\n\n3. **Disaster recovery**\n   - Document cleanup procedures\n   - Keep backup host ready\n   - Test restoration process\n\n4. **Security**\n   - Use SSH keys\n   - Rotate credentials quarterly\n   - Implement network segmentation\n\n### Maintenance Schedule\n\n| Frequency | Tasks |\n|-----------|-------|\n| **Daily** | Review logs, check notifications |\n| **Weekly** | Review failures, check disk space |\n| **Monthly** | Update dependencies, test recovery |\n| **Quarterly** | Rotate credentials, security audit |\n\n---\n\n## Advanced Topics\n\n### Custom Configurations\n\n**Multi-node clusters:**\n- Add more worker nodes for production-like environments\n- Configure resource limits\n- Add custom port mappings\n\n**Advanced testing:**\n- Load testing with multiple iterations\n- Integration testing for full deployment pipeline\n- Chaos engineering with failure injection\n\n### Integration with Other Tools\n\n**Monitoring:**\n- Prometheus for metrics collection\n- Grafana for visualization\n\n**Logging:**\n- ELK stack for log aggregation\n- Custom dashboards\n\n**CI/CD Integration:**\n- Jenkins pipelines\n- GitHub Actions\n- Custom webhooks\n\n---\n\n## Resource Requirements\n\n### Minimum\n| Component | CPU | RAM | Disk |\n|-----------|-----|-----|------|\n| n8n Host | 2 | 4 GB | 20 GB |\n| Target Host | 4 | 8 GB | 20 GB |\n\n### Recommended\n| Component | CPU | RAM | Disk |\n|-----------|-----|-----|------|\n| n8n Host | 4 | 8 GB | 50 GB |\n| Target Host | 8 | 16 GB | 50 GB |\n\n---\n\n## Useful Commands\n\n### KinD\n- List clusters: `kind get clusters`\n- Get kubeconfig: `kind get kubeconfig --name automate-tst`\n- Export logs: `kind export logs --name automate-tst`\n\n### Docker\n- List containers: `docker ps -a --filter \"name=automate-tst\"`\n- Enter control plane: `docker exec -it automate-tst-control-plane bash`\n- View logs: `docker logs automate-tst-control-plane`\n\n### Kubernetes\n- Get all resources: `kubectl get all -A`\n- Describe pod: `kubectl describe pod -n argocd &lt;pod-name&gt;`\n- View logs: `kubectl logs -n argocd &lt;pod-name&gt; --follow`\n- Port forward: `kubectl port-forward -n argocd svc/argocd-server 8080:80`\n\n### Robot Framework\n- Run tests: `robot test.robot`\n- Run specific test: `robot -t \"Test Name\" test.robot`\n- Generate report: `robot --outputdir results test.robot`\n\n---\n\n## Additional Resources\n\n### Official Documentation\n- **n8n**: https://docs.n8n.io\n- **KinD**: https://kind.sigs.k8s.io\n- **ArgoCD**: https://argo-cd.readthedocs.io\n- **Robot Framework**: https://robotframework.org\n- **Browser Library**: https://marketsquare.github.io/robotframework-browser\n\n### Community\n- **n8n Community**: https://community.n8n.io\n- **Kubernetes Slack**: https://kubernetes.slack.com\n- **ArgoCD Slack**: https://argoproj.github.io/community/join-slack\n- **Robot Framework Forum**: https://forum.robotframework.org\n\n### Related Projects\n- **k3s**: Lightweight Kubernetes distribution\n- **minikube**: Local Kubernetes alternative\n- **Flux CD**: Alternative GitOps tool\n- **Playwright**: Alternative browser automation\n",
  "featuredImage": "/data/workflows/10302/10302.webp",
  "author": {
    "id": 101,
    "slug": "vighsandor",
    "name": "Vigh Sandor",
    "avatar": ""
  },
  "categories": [
    "DevOps"
  ],
  "complexityLevel": "advanced",
  "price": 0,
  "visitors": 142,
  "downloads": 14,
  "createdAt": "2025-10-30T04:17:48.039Z",
  "updatedAt": "2026-01-16T09:04:23.444Z",
  "publishedAt": "2025-10-30T04:17:48.039Z",
  "nodes": 73,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/10302"
}