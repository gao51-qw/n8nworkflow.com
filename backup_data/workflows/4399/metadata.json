{
  "id": 4399,
  "slug": "4399",
  "title": "Anthropic AI agent: Claude Sonnet 4 and Opus 4 with Think and Web Search tool",
  "description": "This workflow dynamically chooses between two new powerful Anthropic models ‚Äî **Claude Opus 4** and **Claude Sonnet 4** ‚Äî to handle user queries, based on their complexity and nature, maintaining scalability and context awareness with Anthropic **web search function** and **Think** tool.\n\n---\n\n###  **Key Advantages**\n\n1. **üîÅ Dynamic Model Selection**\n\n   * Automatically routes each user query to either **Claude Sonnet 4** (for routine tasks) or **Claude Opus 4** (for complex reasoning), ensuring optimal performance and cost-efficiency.\n\n2. **üß† AI Agent with Tool Use**\n\n   * The AI agent can utilize a **web search tool** to retrieve up-to-date information and a **Think tool** for complex reasoning processes ‚Äî improving response quality.\n\n3. **üìé Memory Integration**\n\n   * Uses session-based **memory** to maintain conversational context, making interactions more coherent and human-like.\n\n4. **üßÆ Built-in Calculation Tool**\n\n   * Handles numeric queries using an integrated **calculator tool**, reducing the need for external processing.\n\n5. **üì§ Structured Output Parser**\n\n   * Ensures outputs are always well-structured and formatted in JSON, which improves consistency and downstream integrations.\n\n6. **üåê Web Search Capability**\n\n   * Supports real-time information retrieval for current events, statistics, or details not available in the AI‚Äôs base knowledge.\n\n---\n\n###  Components Overview\n\n* **Trigger**: Listens for new chat messages.\n* **Routing Agent**: Analyzes the message and returns the best model to use.\n* **AI Agent**: Handles the conversation, decides when to use tools.\n* **Tools**:\n\n  * `web_search` for internet queries\n  * `Think` for reasoning\n  * `Calculator` for math tasks\n* **Models Used**:\n\n  * `claude-sonnet-4-20250514`: Optimized for general and business logic tasks.\n  * `claude-opus-4-20250514`: Best for deep, strategic, and analytical queries.\n\n---\n\n### **How It Works**\n1. **Dynamic Model Selection**  \n   - The workflow begins when a chat message is received. The **Anthropic Routing Agent** analyzes the user's query to determine the most suitable model (either **Claude Sonnet 4** or **Claude Opus 4**) based on the query's complexity and requirements.  \n   - The routing agent uses predefined criteria to decide:  \n     - **Claude Sonnet 4**: Best for standard tasks like real-time workflow routing, data validation, and routine business logic.  \n     - **Claude Opus 4**: Reserved for complex scenarios requiring deep reasoning, advanced analysis, or high-impact decisions.  \n\n2. **Query Processing and Response Generation**  \n   - The selected model processes the query, leveraging tools like **web_search** for real-time information retrieval, **Think** for internal reasoning, and **Calculator** for numerical tasks.  \n   - The **AI Agent** coordinates these tools, ensuring the response is accurate and context-aware. A **Simple Memory** node retains session context for coherent multi-turn conversations.  \n   - The final response is formatted and returned to the user without intermediate steps or metadata.  \n\n---\n\n### **Set Up Steps**\n1. **Node Configuration**  \n   - **Trigger**: Configure the *\"When chat message received\"* node to handle incoming user queries.  \n   - **Routing Agent**: Set up the *\"Anthropic Routing Agent\"* with the system message defining model selection logic. Ensure it outputs a JSON object with `prompt` and `model` fields.  \n   - **AI Model Nodes**: Link the *\"Sonnet 4 or Opus 4\"* node to dynamically use the selected model. The *\"Sonnet 3.7\"* node powers the routing agent itself.  \n\n2. **Tool Integration**  \n   - Attach the *\"web_search\"* HTTP tool to enable internet searches, ensuring the API endpoint and headers (e.g., `anthropic-version`) are correctly configured.  \n   - Connect auxiliary tools (*Think*, *Calculator*) to the *\"AI Agent\"* for extended functionality.  \n   - Add the *\"Simple Memory\"* node to maintain conversation history.  \n\n3. **Credentials**  \n   - Provide an **Anthropic API key** to all nodes requiring authentication (e.g., model nodes, web search).  \n\n4. **Testing**  \n   - Activate the workflow and test with sample queries to verify:  \n     - Correct model selection (e.g., Sonnet for simple queries, Opus for complex ones).  \n     - Proper tool usage (e.g., web searches trigger when needed).  \n     - Memory retention across chat turns.  \n\n5. **Deployment**  \n   - Once validated, set the workflow to **active** for live interactions.  \n\n----\n### **Need help customizing?**  \n[Contact me](mailto:info@n3w.it) for consulting and support or add me on [Linkedin](https://www.linkedin.com/in/davideboizza/). ",
  "featuredImage": "/data/workflows/4399/4399.webp",
  "author": {
    "id": 101,
    "slug": "n3witalia",
    "name": "Davide",
    "avatar": ""
  },
  "categories": [
    "Engineering",
    "AI Chatbot"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 8819,
  "downloads": 881,
  "createdAt": "2025-05-26T12:27:34.726Z",
  "updatedAt": "2026-01-16T08:34:11.498Z",
  "publishedAt": "2025-05-26T12:27:34.726Z",
  "nodes": 11,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/4399"
}