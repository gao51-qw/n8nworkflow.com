{
  "id": 9613,
  "slug": "9613",
  "title": "Kubernetes deployment & pod monitoring with Telegram alerts",
  "description": "\n## SETUP INSTRUCTIONS\n\n### 1. Configure Kubeconfig\n- Open the **\"Kubeconfig Setup\"** node\n- Paste your entire kubeconfig file content into the `kubeconfigContent` variable\n- Set your target namespace in the `namespace` variable (default: 'production')\n\n**Example kubeconfig format:**\n```yaml\napiVersion: v1\nkind: Config\nclusters:\n- cluster:\n    certificate-authority-data: LS0tLS1CRUd...\n    server: https://your-cluster.example.com:6443\n  name: your-cluster\ncontexts:\n- context:\n    cluster: your-cluster\n    user: your-user\n  name: your-context\ncurrent-context: your-context\nusers:\n- name: your-user\n  user:\n    token: eyJhbGciOiJSUzI1...\n```\n\n### 2. Telegram Configuration\n- Create a Telegram bot via [@BotFather](https://t.me/BotFather)\n- Get your bot token and add it as a credential in n8n (Telegram API)\n- Find your chat ID:\n  - Message your bot\n  - Visit: `https://api.telegram.org/bot&lt;YourBotToken&gt;/getUpdates`\n  - Look for `\"chat\":{\"id\":...}`\n- Open the **\"Send Telegram Alert\"** node\n- Replace `YOUR_TELEGRAM_CHAT_ID` with your actual chat ID\n- Select your Telegram API credential\n\n### 3. Schedule Configuration\n- Open the **\"Schedule Trigger\"** node\n- Default: runs every 1 minute\n- Adjust the interval based on your monitoring needs:\n  - Every 5 minutes: Change `field` to `minutes` and set `minutesInterval` to `5`\n  - Every hour: Change `field` to `hours` and set `hoursInterval` to `1`\n  - Cron expression: Use custom cron schedule\n\n### 4. kubectl Installation\n- The workflow automatically downloads kubectl (v1.34.0) during execution\n- No pre-installation required on the n8n host\n- kubectl is downloaded and used temporarily for each execution\n\n## HOW IT WORKS\n\n### Workflow Steps\n\n1. **Schedule Trigger**\n   - Runs automatically based on configured interval\n   - Initiates the monitoring cycle\n\n2. **Kubeconfig Setup**\n   - Loads the kubeconfig and namespace configuration\n   - Passes credentials to kubectl commands\n\n3. **Parallel Data Collection**\n   - **Get Pods**: Fetches all pods from the specified namespace\n   - **Get Deployments**: Fetches all deployments from the specified namespace\n   - Both commands run in parallel for efficiency\n\n4. **Process & Generate Report**\n   - Parses pod and deployment data\n   - Groups pods by their owner (Deployment, DaemonSet, StatefulSet, or Node)\n   - Calculates readiness statistics for each workload\n   - Detects alerts: workloads with 0 ready pods\n   - Generates a comprehensive Markdown report including:\n     - Deployments with replica counts and pod details\n     - Other workloads (DaemonSets, StatefulSets, Static Pods)\n     - Standalone pods (if any)\n     - Pod-level details: status, node, restart count\n\n5. **Has Alerts?**\n   - Checks if any workloads have 0 ready pods\n   - Routes to appropriate action\n\n6. **Send Telegram Alert** (if alerts exist)\n   - Sends formatted alert message to Telegram\n   - Includes:\n     - Namespace information\n     - List of problematic workloads\n     - Full status report\n\n7. **Save Report**\n   - Saves the Markdown report to a file\n   - Filename format: `k8s-report-YYYY-MM-DD-HHmmss.md`\n   - Always executes, regardless of alert status\n\n### Security Features\n\n- **Temporary kubectl**: Downloaded and used only during execution\n- **Temporary kubeconfig**: Written to `/tmp/kubeconfig-&lt;random&gt;.yaml`\n- **Automatic cleanup**: Kubeconfig file is deleted after each kubectl command\n- **No persistent credentials**: Nothing stored on disk between executions\n\n### Alert Logic\n\nAlerts are triggered when any workload has **zero ready pods**:\n- Deployments with `readyReplicas &lt; 1`\n- DaemonSets with `numberReady &lt; 1`\n- StatefulSets with `readyReplicas &lt; 1`\n- Static Pods (Node-owned) with no ready instances\n\n### Report Sections\n\n1. **Deployments**: All Deployment-managed pods (via ReplicaSets)\n2. **Other Workloads**: DaemonSets, StatefulSets, and Static Pods (kube-system components)\n3. **Standalone Pods**: Pods without recognized owners (rare)\n4. **Alerts**: Summary of workloads requiring attention\n\n## KEY FEATURES\n\n- **Automatic kubectl management** - No pre-installation needed\n- **Multi-workload support** - Deployments, DaemonSets, StatefulSets, Static Pods\n- **Smart pod grouping** - Uses Kubernetes ownerReferences\n- **Conditional alerting** - Only notifies when issues detected\n- **Detailed reporting** - Pod-level status, node placement, restart counts\n- **Secure credential handling** - Temporary files, automatic cleanup\n- **Markdown format** - Easy to read and store\n\n## TROUBLESHOOTING\n\n**Issue: \"Cannot read properties of undefined\"**\n- Ensure both \"Get Pods\" and \"Get Deployments\" nodes execute successfully\n- Check that kubectl can access your cluster with the provided kubeconfig\n\n**Issue: No alerts when there should be**\n- Verify the namespace contains deployments or workloads\n- Check that pods are actually not ready (use `kubectl get pods -n &lt;namespace&gt;`)\n\n**Issue: Telegram message not sent**\n- Verify Telegram API credential is configured correctly\n- Confirm chat ID is correct and the bot has permission to message you\n- Check that the bot was started (send `/start` to the bot)\n\n**Issue: kubectl download fails**\n- Check internet connectivity from n8n host\n- Verify access to dl.k8s.io domain\n- Consider pre-installing kubectl on the host and removing the download commands\n\n## CUSTOMIZATION\n\n### Change Alert Threshold\nEdit the `Process & Generate Report` node to change when alerts trigger:\n```javascript\n// Change from \"&lt; 1\" to your desired threshold\nif (readyReplicas &lt; 2) {  // Alert if less than 2 ready pods\n  alerts.push({...});\n}\n```\n\n### Monitor Multiple Namespaces\n- Duplicate the workflow for each namespace\n- Or modify \"Kubeconfig Setup\" to loop through multiple namespaces\n\n### Custom Report Format\nEdit the markdown generation in `Process & Generate Report` node to customize:\n- Section order\n- Information displayed\n- Formatting style\n\n### Additional Notification Channels\nAdd nodes after \"Has Alerts?\" to send notifications via:\n- Email (SMTP node)\n- Slack (Slack node)\n- Discord (Discord node)\n- Webhook (HTTP Request node)",
  "featuredImage": "/data/workflows/9613/9613.webp",
  "author": {
    "id": 101,
    "slug": "vighsandor",
    "name": "Vigh Sandor",
    "avatar": ""
  },
  "categories": [
    "SecOps"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 198,
  "downloads": 19,
  "createdAt": "2025-10-14T10:54:22.604Z",
  "updatedAt": "2026-01-16T09:01:13.264Z",
  "publishedAt": "2025-10-14T10:54:22.604Z",
  "nodes": 14,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/9613"
}