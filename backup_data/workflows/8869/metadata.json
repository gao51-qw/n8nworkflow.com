{
  "id": 8869,
  "slug": "8869",
  "title": "Enrich Google Sheets with Dun & Bradstreet data blocks",
  "description": "\nAutomate company enrichment directly in **Google Sheets** using **Dun & Bradstreet (D&B) Data Blocks**. This workflow reads DUNS numbers from a sheet, fetches a **Bearer token** (via Basic Auth ‚Üí `/v3/token`), calls the **Data Blocks API** for each row (`/v1/data/duns/...`), extracts **Paydex**, and **appends or updates** the sheet. A **Filter** node skips rows already marked `Complete` for efficient, idempotent runs.\n\n---\n\n## ‚úÖ What this template does\n- Pulls **DUNS** values from a Google Sheet\n- (Option A) Uses an **HTTP Header Auth** credential for D&B, or  \n  (Option B) Dynamically fetches a **Bearer token** from `/v3/token` (Basic Auth)\n- Calls **D&B Data Blocks** per row to retrieve payment insights\n- Extracts **Paydex** and **upserts** results back to the sheet\n- Skips rows already **Complete**\n\n---\n\n## üë§ Who's it for\n- RevOps/Data teams enriching company lists at scale  \n- SDR/Marketing teams validating firmographic/credit signals  \n- BI/Automation builders who want a **no-code/low-code** enrichment loop\n\n---\n\n## üß© How it works (node-by-node)\n1. **Get Companies (Google Sheets)** ‚Äì Reads rows with at least `duns`, `paydex`, `Complete`.  \n2. **Only New Rows (Filter)** ‚Äì Passes only rows where `Complete` is empty.  \n3. **D&B Info (HTTP Request)** ‚Äì Calls Data Blocks for each DUNS using a header credential (`Authorization: Bearer &lt;token&gt;`).  \n4. **Keep Score (Set)** ‚Äì Maps nested JSON to a single **Paydex** field:  \n   `{{$json.organization.businessTrading[0].summary[0].paydexScoreHistory[0].paydexScore}}`\n5. **Append to g-sheets (Google Sheets)** ‚Äì **Append or Update** by `duns`, writing `paydex` and setting `Complete = Yes`.\n\n&gt; The workflow also includes Sticky Notes with in-canvas setup help.\n\n---\n\n## üõ†Ô∏è Setup instructions (from the JSON)\n\n### 1) Connect Google Sheets (OAuth2)\n1. In **n8n ‚Üí Credentials ‚Üí New ‚Üí Google Sheets (OAuth2)** and sign in.  \n2. Use/prepare a sheet with columns like: **duns**, **paydex**, **Complete**.  \n3. In your **Google Sheets** nodes, select your credential and target spreadsheet/tab.  \n4. For upsert behavior, set **Operation** to **Append or Update** and **Matching column** to `duns`.\n\n&gt; Replace any example Sheet IDs/URLs with **your own** (avoid publishing private IDs).\n\n---\n\n### 2) Get a D&B Bearer Token (Basic Auth ‚Üí `/v3/token`) ‚Äî Optional Dynamic Token Node\n1. Add/enable **HTTP Request** node named `Get Bearer Token1`.  \n2. Configure:  \n   - **Authentication:** Basic Auth (your D&B **username**/**password**)  \n   - **Method:** `POST`  \n   - **URL:** `https://plus.dnb.com/v3/token`  \n   - **Body Parameters:** `grant_type = client_credentials`  \n   - **Headers:** `Accept = application/json`  \n3. Execute to receive `access_token`.  \n4. Reference the token in other nodes via:  \n   `Authorization: Bearer {{$node[\"Get Bearer Token1\"].json[\"access_token\"]}}`\n\n&gt; ‚ö†Ô∏è **Security:** Don't hardcode tokens. Prefer credentials or fetch dynamically.\n\n---\n\n### 3) Call D&B Data Blocks (use Header Auth or dynamic token)\n**Node:** `D&B Info` (HTTP Request)  \n- **Authentication:** Header Auth (recommended)  \n- **URL:**\n  ```\n  https://plus.dnb.com/v1/data/duns/{{ $json.duns }}?blockIDs=paymentinsight_L4_v1&tradeUp=hq&customerReference=customer%20reference%20text&orderReason=6332\n  ```\n- **Headers:**  \n  - `Accept = application/json`  \n  - If not using a stored Header Auth credential, set:  \n    `Authorization = Bearer {{$node[\"Get Bearer Token1\"].json[\"access_token\"]}}`\n\n&gt; `{{ $json.duns }}` is resolved from the current row provided by **Get Companies**.\n\n---\n\n### 4) Map Paydex and Upsert to Google Sheets\n- **Keep Score (Set)**  \n  - Field **`Paydex`** (Number):  \n    ```\n    {{$json.organization.businessTrading[0].summary[0].paydexScoreHistory[0].paydexScore}}\n    ```\n- **Append to g-sheets (Google Sheets)**  \n  - **Operation:** `Append or Update`  \n  - **Matching column:** `duns`  \n  - **Columns mapping:**  \n    - `duns = {{ $('Get Companies').item.json.duns }}`  \n    - `paydex = {{ $json.Paydex }}`  \n    - `Complete = Yes`\n\n---\n\n## üß™ Test checklist\n- Add a few test DUNS rows (leave `Complete` blank).  \n- Run the workflow and confirm **Only New Rows** passes expected items.  \n- Check **D&B Info** returns payment insight data.  \n- Confirm **Paydex** is set and the row is updated with `Complete = Yes`.\n\n---\n\n## üîê Security & best practices\n- Store secrets in **Credentials** (HTTP Header Auth/Basic Auth).  \n- Avoid publishing real Sheet IDs or tokens in screenshots/notes.  \n- Consider rate limits and backoff for large sheets.  \n- Log/handle API errors (e.g., invalid DUNS or expired tokens).\n\n---\n\n## ü©π Troubleshooting\n- **401/403 from D&B:** Verify credentials/token; ensure correct environment and entitlements.  \n- **Missing Paydex path:** D&B responses vary by subscription/data availability‚Äîadd guards (IF node) before mapping.  \n- **Rows not updating:** Confirm **Append or Update** is used and **Matching column** exactly matches your sheet header `duns`.  \n- **Filtered out rows:** Ensure `Complete` is truly empty (no spaces) for new items.\n\n---\n\n## üßØ Customize further\n- Enrich additional fields (e.g., **viability score**, **portfolio comparison**, **credit limits**).  \n- Add retry logic, batching, or scheduled triggers.  \n- Push results to a **CRM/DB** or notify teams via **Slack/Email**.\n\n---\n\n## üì¨ Contact  \nNeed help customizing this (e.g., enriching more fields, normalizing responses, or bulk-processing large sheets)?\n\n- üìß **robert@ynteractive.com**  \n- üîó **https://www.linkedin.com/in/robert-breen-29429625/**  \n- üåê **https://ynteractive.com**",
  "featuredImage": "/data/workflows/8869/8869.webp",
  "author": {
    "id": 101,
    "slug": "rbreen",
    "name": "Robert Breen",
    "avatar": ""
  },
  "categories": [
    "Lead Generation"
  ],
  "complexityLevel": "intermediate",
  "price": 0,
  "visitors": 157,
  "downloads": 15,
  "createdAt": "2025-09-23T13:27:34.219Z",
  "updatedAt": "2026-01-16T08:58:05.311Z",
  "publishedAt": "2025-09-23T13:27:34.219Z",
  "nodes": 12,
  "version": "1.0.0",
  "sourceUrl": "https://n8n.io/workflows/8869"
}